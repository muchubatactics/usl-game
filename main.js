/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var t={256:(t,e,n)=>{n.d(e,{A:()=>a});var r=n(601),s=n.n(r),i=n(314),o=n.n(i)()(s());o.push([t.id,"@import url(https://fonts.googleapis.com/css2?family=Bevan:ital@0;1&family=BioRhyme+Expanded:wght@200;300;400;700;800&family=Holtwood+One+SC&family=Inter:wght@100;200;300;400;500;600;700;800;900&family=Luckiest+Guy&family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;0,800;0,900;1,400;1,500;1,600;1,700;1,800;1,900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Stint+Ultra+Expanded&display=swap);"]),o.push([t.id,"/*\nCOLORS\n\n#F66F00 ORANGE\n#F6E013 YELLOW\n#5A46DE BLUE\n#59F1EA LIGHTER BLUE\n#E12E8A PINK\n\n*/\n\n\nbody {\n  height: 100vh;\n  margin: 0px;\n  padding: 0px;\n  overflow-y: hidden;\n  user-select: none;\n\n}\n\nbody > picture > img {\n  position: relative;\n  /* height: 100vh; */\n  width: auto;\n  height: 100%\n\n}\n\n:root {\n  font-size: 24px;\n}\n\n.container {\n  display: flex;\n  justify-content: center;\n  position: absolute;\n  top: 0%;\n  left: 0%;\n  width: 100%;\n  height: 100%;\n}\n /*\n intro page\n */\n\n.intro-page {\n  padding-top: 30vh;\n  /* min-width: 620px; */\n  max-width: 55vw;\n}\n\n.heading {\n  display: grid;\n  /* grid-template-columns: 1fr 6fr; */\n  align-items: center;\n  color: white;\n}\n\n.heading > .title {\n  font-family: 'Bevan', sans-serif;\n  color: #F66F00;\n  font-size: 2.3rem;\n  text-align: center;\n}\n\n.heading > .logo > img {\n  height: 250px;\n}\n\nmain form {\n  margin-top: 5rem;\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  grid-template-rows: 1fr 1fr;\n  font-family: 'Bevan', serif;\n  column-gap: 10px;\n  row-gap: 20px;\n}\n\nform button {\n  grid-area: 2 / 1 / 3 / 3;\n  /* background-color: #F66F00; */\n  background-color: #F6E013;\n  color: black;\n  font-family: 'Holtwood One SC', sans-serif;\n  border: 0px;\n  font-size: 2rem;\n}\n\nform button.mousein {\n  transform: scale(0.95);\n  animation: hoverscale 0.5s ease-in-out  1  ;\n}\n\nform button.mouseout {\n  transform: scale(1);\n  animation: hoverscaleout 0.5s ease-in-out  1  ;\n}\n\n@keyframes hoverscaleout {\n  0% {\n    transform: scale(0.95);\n  }\n  100% {\n    transform: scale(1);\n  }\n}\n\n@keyframes hoverscale {\n  0% {\n    transform: scale(1);\n  }\n\n  100% {\n    transform: scale(0.95);\n  }\n}\n\nform label span {\n  display: block;\n  color: white;\n}\n\nform input {\n  box-sizing: border-box;\n  width: 100%;\n  font-size: 1.5rem;\n  padding: 5px;\n  font-family: 'Stint Ultra Expanded', serif;\n  background-color: #F66F00;\n  border: 0px;\n  color: white;\n}\n\n/*\n* game\n*/\n\n.game {\n  /* max-width: 1500px; */\n  padding: 10px;\n  box-sizing: border-box;\n  padding-top: 8vh;\n}\n\n.game .top {\n  display: flex;\n  font-family: 'BioRhyme Expanded';\n  font-size: 0.8rem;\n}\n\n.game .top .value {\n  height: 7rem;\n  width: 7rem;\n  background-color: #F66F00;\n  border-radius: 50%;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  font-family: 'Luckiest Guy', sans-serif;\n  font-size: 3rem;\n}\n\n.game .score, .game .level {\n  text-align: center;\n  font-size: 0.6rem;\n  font-family: 'BioRhyme Expanded';\n  margin-bottom: 10px;\n}\n\n.game .progress-bars-div {\n  min-width: 600px;\n  width: 100%;\n  color: white;\n  padding: 20px 0px;\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n  margin: 30px 0px;\n}\n\n.game .progress-bars-div div:nth-child(2n - 1) {\n  text-align: center;\n}\n\n.game .level-progress, .game .score-progress {\n  height: 0.6rem;\n  width: 100%;\n  border: 1px solid orange;\n  box-sizing: border-box;\n  margin-bottom: 10px;\n}\n\n.move {\n  animation: move 1s ease  1  ;\n}\n\n@keyframes move {\n  0% {\n    width: 0%;\n  }\n\n  100% {\n    width: 100%;\n  }\n  \n}\n\n.game .level-progress {\n  display: grid;\n}\n\n.game .level-div {\n  position: absolute;\n  left: 16%;\n  top: 7%;\n}\n\n.game .score-div {\n  position: absolute;\n  right: 6.5%;\n  top: 6.5%;\n}\n\n.game .score-progress {\n  border: 1px solid red;\n  display: grid;\n}\n\n\n.game main {\n  /* display: grid; */\n  /* grid-template-columns: 200px 1fr 200px; */\n  font-family: 'PlayFair Display';\n  margin-bottom: 40px;\n}\n\n.game .badges.one {\n  position: absolute;\n  left: 9%;\n  top: 30%;\n  max-width: 230px;\n}\n\n.game .badges.two {\n  position: absolute;\n  right: 9%;\n  top: 30%;\n  max-width: 230px;\n}\n\n.game .badges > div:nth-child(1) {\n  text-align: center;\n  color: white;\n  display: none;\n}\n\n.game .badges div:nth-child(2) {\n  display: flex;\n  justify-content: space-evenly;\n  flex-wrap: wrap;\n}\n\n.game .badges .award-icons div {\n  height: 150px;\n  width: 150px;\n  margin: 10px;\n  background-position: center center;\n  background-size: cover;\n  background-repeat: no-repeat;\n}\n\n.game main .gif {\n  background-color: black;\n  height: 400px;\n  margin-top: -20px;\n}\n\n.game .bottom {\n  font-family: 'Stint Ultra Expanded';\n}\n\n.game .bottom > div:nth-child(1) {\n  text-align: center;\n  color: white;\n  margin-bottom: 10px;\n}\n\n.game .bottom > div:nth-child(2) {\n  margin-top: 10px;\n  display: grid;\n  justify-items: center;\n  column-gap: 10px;\n}\n\n.game .bottom div div {\n  background-color: #F6E013;\n  height: 3rem;\n  width: 100%;\n  box-sizing: border-box;\n  border-radius: 5px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-family: 'Holtwood One SC';\n  font-size: 2rem;\n}\n\n.game .bottom div div:hover {\n  transform: scale(0.95);\n}\n\n.game .gif {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.game .gif img {\n  max-height: 400px;\n  width: auto;\n}\n\n.fail-animation {\n  box-sizing: border-box;\n  background-color: red;\n  animation: fail 1s ease 0s infinite;\n}\n\n.correct-animation {\n  box-sizing: border-box;\n  background-color: green;\n  animation: show-correct 1s ease 0s infinite;\n}\n\n@keyframes fail {\n  0% {\n    transform: translateX(0px);\n    background-color: red;\n  }\n\n  25% {\n    transform: translateX(-5px);\n    background-color: red;\n  }\n\n  50% {\n    transform: translateX(5px);\n    background-color: red;\n\n  }\n\n  75% {\n    transform: translateX(-5px);\n    background-color: red;\n\n  }\n\n  100% {\n    transform: translateX(0px);\n    background-color:#F6E013;\n  }\n}\n\n@keyframes show-correct {\n  0% {\n    transform: translateY(0px);\n    background-color: limegreen;\n  }\n\n  25% {\n    transform: translateY(-5px);\n    background-color: limegreen;\n  }\n\n  50% {\n    transform: translateY(5px);\n    background-color: limegreen;\n  }\n\n  75% {\n    transform: translateY(-5px);\n    background-color: limegreen;\n  }\n\n  100% {\n    transform: translateY(0px);\n    /* background-color: #F6E013; */\n  }\n}\n\n.small {\n  position: absolute;\n  font-size: 0.8rem;\n}\n\n/*\n  dialog\n*/\n\ndialog {\n  padding:  50px 100px;\n  border-radius: 25px;\n  border: 5px solid #5A46DE;\n  background-color: #59F1EA;\n  /* display: grid; */\n}\n\ndialog h1 {\n  font-family: 'Bevan';\n  text-align: center;\n  color: #5A46DE;\n  margin-top: 0px;\n}\n\ndialog h2 {\n  font-family: 'Bevan';\n  margin-top: -20px;\n  text-align: center;\n  color: #E12E8A;\n}\n\ndialog h3 {\n  font-family: 'BioRhyme Expanded';\n  text-align: center;\n  margin-top: -20px;\n  font-size: 0.9rem;\n}\n\ndialog .award {\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n}\n\ndialog .award img {\n  height: 300px;\n  width: auto;\n  align-self: center;\n  justify-self: center;\n}\n\ndialog button {\n  background-color: #F6E013;\n  border: 0px;\n  padding: 20px;\n  font-family: 'Bevan';\n  font-size: 1.5rem;\n  margin: 10px;\n  border-radius: 10px;\n}\n\ndialog button:hover {\n  transform: scale(0.95);\n}\n\n\ndialog::backdrop {\n  background-color: rgba(20, 57, 138, 0.25);\n  backdrop-filter: brightness(0.5);\n}\n\n/* media queries */\n@media screen and (max-width: 1280px) {\n  :root {\n    font-size: 20px;\n  }\n\n  .heading > .title {\n    font-size: 1.9rem;\n  }\n\n  .game .top .value {\n    height: 6rem;\n    width: 6rem;\n  }\n\n  .game .progress-bars-div {\n    min-width: 500px;\n  }\n\n  .game main .gif {\n    height: 300px;\n  }\n\n  .game .gif img {\n    max-height: 300px;\n    width: auto;\n  }\n\n}\n\n@media screen and (max-width: 1024px) {\n  :root {\n    font-size: 16px;\n  }\n\n  .intro-page {\n    max-width: 55vw;\n  }\n\n  .game .progress-bars-div {\n    min-width: 450px;\n  }\n\n  .game main .gif {\n    height: 200px;\n  }\n\n  .game .gif img {\n    max-height: 200px;\n    width: auto;\n  }\n}\n\n.alert {\n  position: absolute;\n  top: 0;\n  left: 50%;\n  transform: translateX(-50%) translateY(-100%);\n  background-color: #F6E013;\n  border-radius: 20px;\n  display: flex;\n  flex-direction: row;\n  padding: 10px;\n  align-items: center;\n}\n\n.alert svg {\n  width: 50px;\n  height: auto;\n  fill: #5A46DE;\n  margin-right: auto;\n}\n\n.alert.action {\n  animation: upanddown 3s ease-in-out 0s 1;\n} \n\n.alert .text {\n  margin-left: 10px;\n  font-family: 'Inter', sans-serif;\n  font-size: 20px;\n}\n\n@keyframes upanddown {\n  0% {\n    transform: translateX(-50%) translateY(-100%);\n  }\n  5% {\n    transform: translateX(-50%) translateY(150%);\n  }\n  95% {\n    transform: translateX(-50%) translateY(150%);\n  }\n  100% {\n    transform: translateX(-50%) translateY(-100%);\n  }\n}\n\n",""]);const a=o},314:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",r=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),r&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),r&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,r,s,i){"string"==typeof t&&(t=[[null,t,void 0]]);var o={};if(r)for(var a=0;a<this.length;a++){var c=this[a][0];null!=c&&(o[c]=!0)}for(var u=0;u<t.length;u++){var l=[].concat(t[u]);r&&o[l[0]]||(void 0!==i&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=i),n&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=n):l[2]=n),s&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=s):l[4]="".concat(s)),e.push(l))}},e}},601:t=>{t.exports=function(t){return t[1]}},72:t=>{var e=[];function n(t){for(var n=-1,r=0;r<e.length;r++)if(e[r].identifier===t){n=r;break}return n}function r(t,r){for(var i={},o=[],a=0;a<t.length;a++){var c=t[a],u=r.base?c[0]+r.base:c[0],l=i[u]||0,h="".concat(u," ").concat(l);i[u]=l+1;var d=n(h),f={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==d)e[d].references++,e[d].updater(f);else{var p=s(f,r);r.byIndex=a,e.splice(a,0,{identifier:h,updater:p,references:1})}o.push(h)}return o}function s(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,s){var i=r(t=t||[],s=s||{});return function(t){t=t||[];for(var o=0;o<i.length;o++){var a=n(i[o]);e[a].references--}for(var c=r(t,s),u=0;u<i.length;u++){var l=n(i[u]);0===e[l].references&&(e[l].updater(),e.splice(l,1))}i=c}}},659:t=>{var e={};t.exports=function(t,n){var r=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},540:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},56:(t,e,n)=>{t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},825:t=>{t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var s=void 0!==n.layer;s&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,s&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var i=n.sourceMap;i&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),e.styleTagTransform(r,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},113:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}},e={};function n(r){var s=e[r];if(void 0!==s)return s.exports;var i=e[r]={id:r,exports:{}};return t[r](i,i.exports,n),i.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.nc=void 0,(()=>{const t=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=63&s|128):55296==(64512&s)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(s=65536+((1023&s)<<10)+(1023&t.charCodeAt(++r)),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=63&s|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=63&s|128)}return e},e={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let e=0;e<t.length;e+=3){const s=t[e],i=e+1<t.length,o=i?t[e+1]:0,a=e+2<t.length,c=a?t[e+2]:0,u=s>>2,l=(3&s)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,i||(h=64)),r.push(n[u],n[l],n[h],n[d])}return r.join("")},encodeString(e,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(e):this.encodeByteArray(t(e),n)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((31&s)<<6|63&i)}else if(s>239&&s<365){const i=((7&s)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(i>>10)),e[r++]=String.fromCharCode(56320+(1023&i))}else{const i=t[n++],o=t[n++];e[r++]=String.fromCharCode((15&s)<<12|(63&i)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let e=0;e<t.length;){const i=n[t.charAt(e++)],o=e<t.length?n[t.charAt(e)]:0;++e;const a=e<t.length?n[t.charAt(e)]:64;++e;const c=e<t.length?n[t.charAt(e)]:64;if(++e,null==i||null==o||null==a||null==c)throw new r;const u=i<<2|o>>4;if(s.push(u),64!==a){const t=o<<4&240|a>>2;if(s.push(t),64!==c){const t=a<<6&192|c;s.push(t)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class r extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const s=function(n){return function(n){const r=t(n);return e.encodeByteArray(r,!0)}(n).replace(/\./g,"")},i=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const t=process.env.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const n=t&&function(t){try{return e.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}(t[1]);return n&&JSON.parse(n)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},o=()=>{var t;return null===(t=i())||void 0===t?void 0:t.config};class a{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function c(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function u(){try{return"object"==typeof indexedDB}catch(t){return!1}}class l extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,l.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,h.prototype.create)}}class h{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},r=`${this.service}/${t}`,s=this.errors[t],i=s?function(t,e){return t.replace(d,((t,n)=>{const r=e[n];return null!=r?String(r):`<${n}?>`}))}(s,n):"Error",o=`${this.serviceName}: ${i} (${r}).`;return new l(r,o,n)}}const d=/\{\$([^}]+)}/g;function f(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const n=t[s],i=e[s];if(p(n)&&p(i)){if(!f(n,i))return!1}else if(n!==i)return!1}for(const t of r)if(!n.includes(t))return!1;return!0}function p(t){return null!==t&&"object"==typeof t}function g(t){return t&&t._delegate?t._delegate:t}class m{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const y="[DEFAULT]";class v{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new a;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),r=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(r)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:y})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t=y){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=y){return this.instances.has(t)}getOptions(t=y){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(r);return r}onInit(t,e){var n;const r=this.normalizeInstanceIdentifier(e),s=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;s.add(t),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&t(i,r),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const r of n)try{r(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=t,r===y?void 0:r),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var r;return n||null}normalizeInstanceIdentifier(t=y){return this.component?this.component.multipleInstances?t:y:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class w{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new v(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const b=[];var E;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(E||(E={}));const _={debug:E.DEBUG,verbose:E.VERBOSE,info:E.INFO,warn:E.WARN,error:E.ERROR,silent:E.SILENT},T=E.INFO,S={[E.DEBUG]:"log",[E.VERBOSE]:"log",[E.INFO]:"info",[E.WARN]:"warn",[E.ERROR]:"error"},I=(t,e,...n)=>{if(e<t.logLevel)return;const r=(new Date).toISOString(),s=S[e];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[s](`[${r}]  ${t.name}:`,...n)};class C{constructor(t){this.name=t,this._logLevel=T,this._logHandler=I,this._userLogHandler=null,b.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in E))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?_[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,E.DEBUG,...t),this._logHandler(this,E.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,E.VERBOSE,...t),this._logHandler(this,E.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,E.INFO,...t),this._logHandler(this,E.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,E.WARN,...t),this._logHandler(this,E.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,E.ERROR,...t),this._logHandler(this,E.ERROR,...t)}}const A=(t,e)=>e.some((e=>t instanceof e));let D,x;const k=new WeakMap,N=new WeakMap,R=new WeakMap,L=new WeakMap,O=new WeakMap;let M={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return N.get(t);if("objectStoreNames"===e)return t.objectStoreNames||R.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return F(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function P(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(x||(x=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(V(this),t),F(k.get(this))}:function(...t){return F(e.apply(V(this),t))}:function(t,...n){const r=e.call(V(this),t,...n);return R.set(r,t.sort?t.sort():[t]),F(r)}:(t instanceof IDBTransaction&&function(t){if(N.has(t))return;const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",i),t.removeEventListener("abort",i)},s=()=>{e(),r()},i=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",s),t.addEventListener("error",i),t.addEventListener("abort",i)}));N.set(t,e)}(t),A(t,D||(D=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,M):t);var e}function F(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("success",s),t.removeEventListener("error",i)},s=()=>{e(F(t.result)),r()},i=()=>{n(t.error),r()};t.addEventListener("success",s),t.addEventListener("error",i)}));return e.then((e=>{e instanceof IDBCursor&&k.set(e,t)})).catch((()=>{})),O.set(e,t),e}(t);if(L.has(t))return L.get(t);const e=P(t);return e!==t&&(L.set(t,e),O.set(e,t)),e}const V=t=>O.get(t),U=["get","getKey","getAll","getAllKeys","count"],B=["put","add","delete","clear"],q=new Map;function j(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(q.get(e))return q.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=B.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!s&&!U.includes(n))return;const i=async function(t,...e){const i=this.transaction(t,s?"readwrite":"readonly");let o=i.store;return r&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),s&&i.done]))[0]};return q.set(e,i),i}var $;$=M,M={...$,get:(t,e,n)=>j(t,e)||$.get(t,e,n),has:(t,e)=>!!j(t,e)||$.has(t,e)};class z{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const K="@firebase/app",G="0.10.0",H=new C("@firebase/app"),Q="@firebase/app-compat",W="@firebase/analytics-compat",Y="@firebase/analytics",X="@firebase/app-check-compat",J="@firebase/app-check",Z="@firebase/auth",tt="@firebase/auth-compat",et="@firebase/database",nt="@firebase/database-compat",rt="@firebase/functions",st="@firebase/functions-compat",it="@firebase/installations",ot="@firebase/installations-compat",at="@firebase/messaging",ct="@firebase/messaging-compat",ut="@firebase/performance",lt="@firebase/performance-compat",ht="@firebase/remote-config",dt="@firebase/remote-config-compat",ft="@firebase/storage",pt="@firebase/storage-compat",gt="@firebase/firestore",mt="@firebase/firestore-compat",yt="firebase",vt="[DEFAULT]",wt={[K]:"fire-core",[Q]:"fire-core-compat",[Y]:"fire-analytics",[W]:"fire-analytics-compat",[J]:"fire-app-check",[X]:"fire-app-check-compat",[Z]:"fire-auth",[tt]:"fire-auth-compat",[et]:"fire-rtdb",[nt]:"fire-rtdb-compat",[rt]:"fire-fn",[st]:"fire-fn-compat",[it]:"fire-iid",[ot]:"fire-iid-compat",[at]:"fire-fcm",[ct]:"fire-fcm-compat",[ut]:"fire-perf",[lt]:"fire-perf-compat",[ht]:"fire-rc",[dt]:"fire-rc-compat",[ft]:"fire-gcs",[pt]:"fire-gcs-compat",[gt]:"fire-fst",[mt]:"fire-fst-compat","fire-js":"fire-js",[yt]:"fire-js-all"},bt=new Map,Et=new Map,_t=new Map;function Tt(t,e){try{t.container.addComponent(e)}catch(n){H.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function St(t){const e=t.name;if(_t.has(e))return H.debug(`There were multiple attempts to register component ${e}.`),!1;_t.set(e,t);for(const e of bt.values())Tt(e,t);for(const e of Et.values())Tt(e,t);return!0}const It=new h("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class Ct{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new m("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw It.create("app-deleted",{appName:this._name})}}function At(t,e={}){let n=t;"object"!=typeof e&&(e={name:e});const r=Object.assign({name:vt,automaticDataCollectionEnabled:!1},e),s=r.name;if("string"!=typeof s||!s)throw It.create("bad-app-name",{appName:String(s)});if(n||(n=o()),!n)throw It.create("no-options");const i=bt.get(s);if(i){if(f(n,i.options)&&f(r,i.config))return i;throw It.create("duplicate-app",{appName:s})}const a=new w(s);for(const t of _t.values())a.addComponent(t);const c=new Ct(n,r,a);return bt.set(s,c),c}function Dt(t,e,n){var r;let s=null!==(r=wt[t])&&void 0!==r?r:t;n&&(s+=`-${n}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const t=[`Unable to register library "${s}" with version "${e}":`];return i&&t.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void H.warn(t.join(" "))}St(new m(`${s}-version`,(()=>({library:s,version:e})),"VERSION"))}const xt="firebase-heartbeat-database",kt=1,Nt="firebase-heartbeat-store";let Rt=null;function Lt(){return Rt||(Rt=function(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(t,e),a=F(o);return r&&o.addEventListener("upgradeneeded",(t=>{r(F(o.result),t.oldVersion,t.newVersion,F(o.transaction),t)})),n&&o.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),a.then((t=>{i&&t.addEventListener("close",(()=>i())),s&&t.addEventListener("versionchange",(t=>s(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}(xt,kt,{upgrade:(t,e)=>{if(0===e)try{t.createObjectStore(Nt)}catch(t){console.warn(t)}}}).catch((t=>{throw It.create("idb-open",{originalErrorMessage:t.message})}))),Rt}async function Ot(t,e){try{const n=(await Lt()).transaction(Nt,"readwrite"),r=n.objectStore(Nt);await r.put(e,Mt(t)),await n.done}catch(t){if(t instanceof l)H.warn(t.message);else{const e=It.create("idb-set",{originalErrorMessage:null==t?void 0:t.message});H.warn(e.message)}}}function Mt(t){return`${t.name}!${t.options.appId}`}class Pt{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new Vt(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){var t,e;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Ft();if((null!=(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||(this._heartbeatsCache=await this._heartbeatsCachePromise,null!=(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)))&&this._heartbeatsCache.lastSentHeartbeatDate!==r&&!this._heartbeatsCache.heartbeats.some((t=>t.date===r)))return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var t;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const e=Ft(),{heartbeatsToSend:n,unsentEntries:r}=function(t,e=1024){const n=[];let r=t.slice();for(const s of t){const t=n.find((t=>t.agent===s.agent));if(t){if(t.dates.push(s.date),Ut(n)>e){t.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),Ut(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=s(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function Ft(){return(new Date).toISOString().substring(0,10)}class Vt{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!u()&&new Promise(((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var t;e((null===(t=s.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=(await Lt()).transaction(Nt),n=await e.objectStore(Nt).get(Mt(t));return await e.done,n}catch(t){if(t instanceof l)H.warn(t.message);else{const e=It.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});H.warn(e.message)}}}(this.app);return(null==t?void 0:t.heartbeats)?t:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return Ot(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return Ot(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function Ut(t){return s(JSON.stringify({version:2,heartbeats:t})).length}St(new m("platform-logger",(t=>new z(t)),"PRIVATE")),St(new m("heartbeat",(t=>new Pt(t)),"PRIVATE")),Dt(K,G,""),Dt(K,G,"esm2017"),Dt("fire-js","");var Bt,qt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},jt={},$t=$t||{},zt=qt||self;function Kt(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function Gt(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var Ht="closure_uid_"+(1e9*Math.random()>>>0),Qt=0;function Wt(t,e,n){return t.call.apply(t.bind,arguments)}function Yt(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function Xt(t,e,n){return(Xt=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Wt:Yt).apply(null,arguments)}function Jt(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function Zt(t,e){function n(){}n.prototype=e.prototype,t.$=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.ac=function(t,n,r){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return e.prototype[n].apply(t,s)}}function te(){this.s=this.s,this.o=this.o}te.prototype.s=!1,te.prototype.sa=function(){var t;!this.s&&(this.s=!0,this.N(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,Ht)&&t[Ht]||(t[Ht]=++Qt))},te.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const ee=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function ne(t){const e=t.length;if(0<e){const n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function re(t,e){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(Kt(n)){const e=t.length||0,r=n.length||0;t.length=e+r;for(let s=0;s<r;s++)t[e+s]=n[s]}else t.push(n)}}function se(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}se.prototype.h=function(){this.defaultPrevented=!0};var ie=function(){if(!zt.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{const t=()=>{};zt.addEventListener("test",t,e),zt.removeEventListener("test",t,e)}catch(t){}return t}();function oe(t){return/^[\s\xa0]*$/.test(t)}function ae(){var t=zt.navigator;return t&&(t=t.userAgent)?t:""}function ce(t){return-1!=ae().indexOf(t)}function ue(t){return ue[" "](t),t}ue[" "]=function(){};var le,he,de,fe=ce("Opera"),pe=ce("Trident")||ce("MSIE"),ge=ce("Edge"),me=ge||pe,ye=ce("Gecko")&&!(-1!=ae().toLowerCase().indexOf("webkit")&&!ce("Edge"))&&!(ce("Trident")||ce("MSIE"))&&!ce("Edge"),ve=-1!=ae().toLowerCase().indexOf("webkit")&&!ce("Edge");function we(){var t=zt.document;return t?t.documentMode:void 0}t:{var be="",Ee=(he=ae(),ye?/rv:([^\);]+)(\)|;)/.exec(he):ge?/Edge\/([\d\.]+)/.exec(he):pe?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(he):ve?/WebKit\/(\S+)/.exec(he):fe?/(?:Version)[ \/]?(\S+)/.exec(he):void 0);if(Ee&&(be=Ee?Ee[1]:""),pe){var _e=we();if(null!=_e&&_e>parseFloat(be)){le=String(_e);break t}}le=be}zt.document&&pe?de=we()||parseInt(le,10)||void 0:de=void 0;var Te=de;function Se(t,e){if(se.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(ye){t:{try{ue(e.nodeName);var s=!0;break t}catch(t){}s=!1}s||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Ie[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&Se.$.h.call(this)}}Zt(Se,se);var Ie={2:"touch",3:"pen",4:"mouse"};Se.prototype.h=function(){Se.$.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var Ce="closure_listenable_"+(1e6*Math.random()|0),Ae=0;function De(t,e,n,r,s){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.la=s,this.key=++Ae,this.fa=this.ia=!1}function xe(t){t.fa=!0,t.listener=null,t.proxy=null,t.src=null,t.la=null}function ke(t,e,n){for(const r in t)e.call(n,t[r],r,t)}function Ne(t){const e={};for(const n in t)e[n]=t[n];return e}const Re="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Le(t,e){let n,r;for(let e=1;e<arguments.length;e++){for(n in r=arguments[e],r)t[n]=r[n];for(let e=0;e<Re.length;e++)n=Re[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function Oe(t){this.src=t,this.g={},this.h=0}function Me(t,e){var n=e.type;if(n in t.g){var r,s=t.g[n],i=ee(s,e);(r=0<=i)&&Array.prototype.splice.call(s,i,1),r&&(xe(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function Pe(t,e,n,r){for(var s=0;s<t.length;++s){var i=t[s];if(!i.fa&&i.listener==e&&i.capture==!!n&&i.la==r)return s}return-1}Oe.prototype.add=function(t,e,n,r,s){var i=t.toString();(t=this.g[i])||(t=this.g[i]=[],this.h++);var o=Pe(t,e,r,s);return-1<o?(e=t[o],n||(e.ia=!1)):((e=new De(e,this.src,i,!!r,s)).ia=n,t.push(e)),e};var Fe="closure_lm_"+(1e6*Math.random()|0),Ve={};function Ue(t,e,n,r,s){if(r&&r.once)return qe(t,e,n,r,s);if(Array.isArray(e)){for(var i=0;i<e.length;i++)Ue(t,e[i],n,r,s);return null}return n=Qe(n),t&&t[Ce]?t.O(e,n,Gt(r)?!!r.capture:!!r,s):Be(t,e,n,!1,r,s)}function Be(t,e,n,r,s,i){if(!e)throw Error("Invalid event type");var o=Gt(s)?!!s.capture:!!s,a=Ge(t);if(a||(t[Fe]=a=new Oe(t)),(n=a.add(e,n,r,o,i)).proxy)return n;if(r=function(){const t=Ke;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)ie||(s=o),void 0===s&&(s=!1),t.addEventListener(e.toString(),r,s);else if(t.attachEvent)t.attachEvent(ze(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function qe(t,e,n,r,s){if(Array.isArray(e)){for(var i=0;i<e.length;i++)qe(t,e[i],n,r,s);return null}return n=Qe(n),t&&t[Ce]?t.P(e,n,Gt(r)?!!r.capture:!!r,s):Be(t,e,n,!0,r,s)}function je(t,e,n,r,s){if(Array.isArray(e))for(var i=0;i<e.length;i++)je(t,e[i],n,r,s);else r=Gt(r)?!!r.capture:!!r,n=Qe(n),t&&t[Ce]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=Pe(i=t.g[e],n,r,s))&&(xe(i[n]),Array.prototype.splice.call(i,n,1),0==i.length&&(delete t.g[e],t.h--))):t&&(t=Ge(t))&&(e=t.g[e.toString()],t=-1,e&&(t=Pe(e,n,r,s)),(n=-1<t?e[t]:null)&&$e(n))}function $e(t){if("number"!=typeof t&&t&&!t.fa){var e=t.src;if(e&&e[Ce])Me(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(ze(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ge(e))?(Me(n,t),0==n.h&&(n.src=null,e[Fe]=null)):xe(t)}}}function ze(t){return t in Ve?Ve[t]:Ve[t]="on"+t}function Ke(t,e){if(t.fa)t=!0;else{e=new Se(e,this);var n=t.listener,r=t.la||t.src;t.ia&&$e(t),t=n.call(r,e)}return t}function Ge(t){return(t=t[Fe])instanceof Oe?t:null}var He="__closure_events_fn_"+(1e9*Math.random()>>>0);function Qe(t){return"function"==typeof t?t:(t[He]||(t[He]=function(e){return t.handleEvent(e)}),t[He])}function We(){te.call(this),this.i=new Oe(this),this.S=this,this.J=null}function Ye(t,e){var n,r=t.J;if(r)for(n=[];r;r=r.J)n.push(r);if(t=t.S,r=e.type||e,"string"==typeof e)e=new se(e,t);else if(e instanceof se)e.target=e.target||t;else{var s=e;Le(e=new se(r,t),s)}if(s=!0,n)for(var i=n.length-1;0<=i;i--){var o=e.g=n[i];s=Xe(o,r,!0,e)&&s}if(s=Xe(o=e.g=t,r,!0,e)&&s,s=Xe(o,r,!1,e)&&s,n)for(i=0;i<n.length;i++)s=Xe(o=e.g=n[i],r,!1,e)&&s}function Xe(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var s=!0,i=0;i<e.length;++i){var o=e[i];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&Me(t.i,o),s=!1!==a.call(c,r)&&s}}return s&&!r.defaultPrevented}Zt(We,te),We.prototype[Ce]=!0,We.prototype.removeEventListener=function(t,e,n,r){je(this,t,e,n,r)},We.prototype.N=function(){if(We.$.N.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)xe(n[r]);delete e.g[t],e.h--}}this.J=null},We.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},We.prototype.P=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var Je=zt.JSON.stringify;function Ze(){var t=an;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var tn=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new en),(t=>t.reset()));class en{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function nn(t){var e=1;t=t.split(":");const n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function rn(t){zt.setTimeout((()=>{throw t}),0)}let sn,on=!1,an=new class{constructor(){this.h=this.g=null}add(t,e){const n=tn.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},cn=()=>{const t=zt.Promise.resolve(void 0);sn=()=>{t.then(un)}};var un=()=>{for(var t;t=Ze();){try{t.h.call(t.g)}catch(t){rn(t)}var e=tn;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}on=!1};function ln(t,e){We.call(this),this.h=t||1,this.g=e||zt,this.j=Xt(this.qb,this),this.l=Date.now()}function hn(t){t.ga=!1,t.T&&(t.g.clearTimeout(t.T),t.T=null)}function dn(t,e,n){if("function"==typeof t)n&&(t=Xt(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=Xt(t.handleEvent,t)}return 2147483647<Number(e)?-1:zt.setTimeout(t,e||0)}function fn(t){t.g=dn((()=>{t.g=null,t.i&&(t.i=!1,fn(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}Zt(ln,We),(Bt=ln.prototype).ga=!1,Bt.T=null,Bt.qb=function(){if(this.ga){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-t):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Ye(this,"tick"),this.ga&&(hn(this),this.start()))}},Bt.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},Bt.N=function(){ln.$.N.call(this),hn(this),delete this.g};class pn extends te{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:fn(this)}N(){super.N(),this.g&&(zt.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function gn(t){te.call(this),this.h=t,this.g={}}Zt(gn,te);var mn=[];function yn(t,e,n,r){Array.isArray(n)||(n&&(mn[0]=n.toString()),n=mn);for(var s=0;s<n.length;s++){var i=Ue(e,n[s],r||t.handleEvent,!1,t.h||t);if(!i)break;t.g[i.key]=i}}function vn(t){ke(t.g,(function(t,e){this.g.hasOwnProperty(e)&&$e(t)}),t),t.g={}}function wn(){this.g=!0}function bn(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var s=r[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return Je(n)}catch(t){return e}}(t,n)+(r?" "+r:"")}))}gn.prototype.N=function(){gn.$.N.call(this),vn(this)},gn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},wn.prototype.Ea=function(){this.g=!1},wn.prototype.info=function(){};var En={},_n=null;function Tn(){return _n=_n||new We}function Sn(t){se.call(this,En.Ta,t)}function In(t){const e=Tn();Ye(e,new Sn(e))}function Cn(t,e){se.call(this,En.STAT_EVENT,t),this.stat=e}function An(t){const e=Tn();Ye(e,new Cn(e,t))}function Dn(t,e){se.call(this,En.Ua,t),this.size=e}function xn(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return zt.setTimeout((function(){t()}),e)}En.Ta="serverreachability",Zt(Sn,se),En.STAT_EVENT="statevent",Zt(Cn,se),En.Ua="timingevent",Zt(Dn,se);var kn={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Nn={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Rn(){}function Ln(t){return t.h||(t.h=t.i())}function On(){}Rn.prototype.h=null;var Mn,Pn={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Fn(){se.call(this,"d")}function Vn(){se.call(this,"c")}function Un(){}function Bn(t,e,n,r){this.l=t,this.j=e,this.m=n,this.W=r||1,this.U=new gn(this),this.P=jn,t=me?125:void 0,this.V=new ln(t),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new qn}function qn(){this.i=null,this.g="",this.h=!1}Zt(Fn,se),Zt(Vn,se),Zt(Un,Rn),Un.prototype.g=function(){return new XMLHttpRequest},Un.prototype.i=function(){return{}},Mn=new Un;var jn=45e3,$n={},zn={};function Kn(t,e,n){t.L=1,t.A=lr(ir(e)),t.u=n,t.S=!0,Gn(t,null)}function Gn(t,e){t.G=Date.now(),Yn(t),t.B=ir(t.A);var n=t.B,r=t.W;Array.isArray(r)||(r=[String(r)]),Tr(n.i,"t",r),t.o=0,n=t.l.J,t.h=new qn,t.g=Ts(t.l,n?e:null,!t.u),0<t.O&&(t.M=new pn(Xt(t.Pa,t,t.g),t.O)),yn(t.U,t.g,"readystatechange",t.nb),e=t.I?Ne(t.I):{},t.u?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ha(t.B,t.v,t.u,e)):(t.v="GET",t.g.ha(t.B,t.v,null,e)),In(),function(t,e,n,r,s,i){t.info((function(){if(t.g)if(i)for(var o="",a=i.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+u+"&":o+(l+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+e+"\n"+n+"\n"+o}))}(t.j,t.v,t.B,t.m,t.W,t.u)}function Hn(t){return!!t.g&&"GET"==t.v&&2!=t.L&&t.l.Ha}function Qn(t,e,n){let r,s=!0;for(;!t.J&&t.o<n.length;){if(r=Wn(t,n),r==zn){4==e&&(t.s=4,An(14),s=!1),bn(t.j,t.m,null,"[Incomplete Response]");break}if(r==$n){t.s=4,An(15),bn(t.j,t.m,n,"[Invalid Chunk]"),s=!1;break}bn(t.j,t.m,r,null),er(t,r)}Hn(t)&&0!=t.o&&(t.h.g=t.h.g.slice(t.o),t.o=0),4!=e||0!=n.length||t.h.h||(t.s=1,An(16),s=!1),t.i=t.i&&s,s?0<n.length&&!t.ba&&(t.ba=!0,(e=t.l).g==t&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),gs(e),e.M=!0,An(11))):(bn(t.j,t.m,n,"[Invalid Chunked Response]"),tr(t),Zn(t))}function Wn(t,e){var n=t.o,r=e.indexOf("\n",n);return-1==r?zn:(n=Number(e.substring(n,r)),isNaN(n)?$n:(r+=1)+n>e.length?zn:(e=e.slice(r,r+n),t.o=r+n,e))}function Yn(t){t.Y=Date.now()+t.P,Xn(t,t.P)}function Xn(t,e){if(null!=t.C)throw Error("WatchDog timer not null");t.C=xn(Xt(t.lb,t),e)}function Jn(t){t.C&&(zt.clearTimeout(t.C),t.C=null)}function Zn(t){0==t.l.H||t.J||vs(t.l,t)}function tr(t){Jn(t);var e=t.M;e&&"function"==typeof e.sa&&e.sa(),t.M=null,hn(t.V),vn(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.sa())}function er(t,e){try{var n=t.l;if(0!=n.H&&(n.g==t||kr(n.i,t)))if(!t.K&&kr(n.i,t)&&3==n.H){try{var r=n.Ja.g.parse(e)}catch(t){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){t:if(!n.u){if(n.g){if(!(n.g.G+3e3<t.G))break t;ys(n),as(n)}ps(n),An(18)}}else n.Fa=s[1],0<n.Fa-n.V&&37500>s[2]&&n.G&&0==n.A&&!n.v&&(n.v=xn(Xt(n.ib,n),6e3));if(1>=xr(n.i)&&n.oa){try{n.oa()}catch(t){}n.oa=void 0}}else bs(n,11)}else if((t.K||n.g==t)&&ys(n),!oe(e))for(s=n.Ja.g.parse(e),e=0;e<s.length;e++){let u=s[e];if(n.V=u[0],u=u[1],2==n.H)if("c"==u[0]){n.K=u[1],n.pa=u[2];const e=u[3];null!=e&&(n.ra=e,n.l.info("VER="+n.ra));const s=u[4];null!=s&&(n.Ga=s,n.l.info("SVER="+n.Ga));const l=u[5];null!=l&&"number"==typeof l&&0<l&&(r=1.5*l,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=t.g;if(h){const t=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var i=r.i;i.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(Nr(i,i.h),i.h=null))}if(r.F){const t=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(r.Da=t,ur(r.I,r.F,t))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-t.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=t;if((r=n).wa=_s(r,r.J?r.pa:null,r.Y),o.K){Rr(r.i,o);var a=o,c=r.L;c&&a.setTimeout(c),a.C&&(Jn(a),Yn(a)),r.g=o}else fs(r);0<n.j.length&&us(n)}else"stop"!=u[0]&&"close"!=u[0]||bs(n,7);else 3==n.H&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?bs(n,7):os(n):"noop"!=u[0]&&n.h&&n.h.Aa(u),n.A=0)}In()}catch(t){}}function nr(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(Kt(t)||"string"==typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var n=function(t){if(t.ta&&"function"==typeof t.ta)return t.ta();if(!t.Z||"function"!=typeof t.Z){if("undefined"!=typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!=typeof Set&&t instanceof Set)){if(Kt(t)||"string"==typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const r in t)e[n++]=r;return e}}}(t),r=function(t){if(t.Z&&"function"==typeof t.Z)return t.Z();if("undefined"!=typeof Map&&t instanceof Map||"undefined"!=typeof Set&&t instanceof Set)return Array.from(t.values());if("string"==typeof t)return t.split("");if(Kt(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t),s=r.length,i=0;i<s;i++)e.call(void 0,r[i],n&&n[i],t)}(Bt=Bn.prototype).setTimeout=function(t){this.P=t},Bt.nb=function(t){t=t.target;const e=this.M;e&&3==ts(t)?e.l():this.Pa(t)},Bt.Pa=function(t){try{if(t==this.g)t:{const l=ts(this.g);var e=this.g.Ia();if(this.g.da(),!(3>l)&&(3!=l||me||this.g&&(this.h.h||this.g.ja()||es(this.g)))){this.J||4!=l||7==e||In(),Jn(this);var n=this.g.da();this.ca=n;e:if(Hn(this)){var r=es(this.g);t="";var s=r.length,i=4==ts(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){tr(this),Zn(this);var o="";break e}this.h.i=new zt.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:i&&e==s-1});r.length=0,this.h.g+=t,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(t,e,n,r,s,i,o){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+e+"\n"+n+"\n"+i+" "+o}))}(this.j,this.v,this.B,this.m,this.W,l,n),this.i){if(this.aa&&!this.K){e:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!oe(a)){var u=a;break e}}u=null}if(!(n=u)){this.i=!1,this.s=3,An(12),tr(this),Zn(this);break t}bn(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,er(this,n)}this.S?(Qn(this,l,o),me&&this.i&&3==l&&(yn(this.U,this.V,"tick",this.mb),this.V.start())):(bn(this.j,this.m,o,null),er(this,o)),4==l&&tr(this),this.i&&!this.J&&(4==l?vs(this.l,this):(this.i=!1,Yn(this)))}else(function(t){const e={};t=(t.g&&2<=ts(t)&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<t.length;r++){if(oe(t[r]))continue;var n=nn(t[r]);const s=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const i=e[s]||[];e[s]=i,i.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,(function(t){return t.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.s=3,An(12)):(this.s=0,An(13)),tr(this),Zn(this)}}}catch(t){}},Bt.mb=function(){if(this.g){var t=ts(this.g),e=this.g.ja();this.o<e.length&&(Jn(this),Qn(this,t,e),this.i&&4!=t&&Yn(this))}},Bt.cancel=function(){this.J=!0,tr(this)},Bt.lb=function(){this.C=null;const t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.B),2!=this.L&&(In(),An(17)),tr(this),this.s=2,Zn(this)):Xn(this,this.Y-t)};var rr=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function sr(t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof sr){this.h=t.h,or(this,t.j),this.s=t.s,this.g=t.g,ar(this,t.m),this.l=t.l;var e=t.i,n=new wr;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),cr(this,n),this.o=t.o}else t&&(e=String(t).match(rr))?(this.h=!1,or(this,e[1]||"",!0),this.s=hr(e[2]||""),this.g=hr(e[3]||"",!0),ar(this,e[4]),this.l=hr(e[5]||"",!0),cr(this,e[6]||"",!0),this.o=hr(e[7]||"")):(this.h=!1,this.i=new wr(null,this.h))}function ir(t){return new sr(t)}function or(t,e,n){t.j=n?hr(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function ar(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function cr(t,e,n){e instanceof wr?(t.i=e,function(t,e){e&&!t.j&&(br(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Er(this,e),Tr(this,n,t))}),t)),t.j=e}(t.i,t.h)):(n||(e=dr(e,yr)),t.i=new wr(e,t.h))}function ur(t,e,n){t.i.set(e,n)}function lr(t){return ur(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function hr(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function dr(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,fr),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function fr(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}sr.prototype.toString=function(){var t=[],e=this.j;e&&t.push(dr(e,pr,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(dr(e,pr,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(dr(n,"/"==n.charAt(0)?mr:gr,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",dr(n,vr)),t.join("")};var pr=/[#\/\?@]/g,gr=/[#\?:]/g,mr=/[#\?]/g,yr=/[#\?@]/g,vr=/#/g;function wr(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function br(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),s=null;if(0<=r){var i=t[n].substring(0,r);s=t[n].substring(r+1)}else i=t[n];e(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Er(t,e){br(t),e=Sr(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function _r(t,e){return br(t),e=Sr(t,e),t.g.has(e)}function Tr(t,e,n){Er(t,e),0<n.length&&(t.i=null,t.g.set(Sr(t,e),ne(n)),t.h+=n.length)}function Sr(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(Bt=wr.prototype).add=function(t,e){br(this),this.i=null,t=Sr(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},Bt.forEach=function(t,e){br(this),this.g.forEach((function(n,r){n.forEach((function(n){t.call(e,n,r,this)}),this)}),this)},Bt.ta=function(){br(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let r=0;r<e.length;r++){const s=t[r];for(let t=0;t<s.length;t++)n.push(e[r])}return n},Bt.Z=function(t){br(this);let e=[];if("string"==typeof t)_r(this,t)&&(e=e.concat(this.g.get(Sr(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e},Bt.set=function(t,e){return br(this),this.i=null,_r(this,t=Sr(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},Bt.get=function(t,e){return t&&0<(t=this.Z(t)).length?String(t[0]):e},Bt.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var r=e[n];const i=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var s=i;""!==o[r]&&(s+="="+encodeURIComponent(String(o[r]))),t.push(s)}}return this.i=t.join("&")};var Ir=class{constructor(t,e){this.g=t,this.map=e}};function Cr(t){this.l=t||Ar,t=zt.PerformanceNavigationTiming?0<(t=zt.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(zt.g&&zt.g.Ka&&zt.g.Ka()&&zt.g.Ka().dc),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Ar=10;function Dr(t){return!!t.h||!!t.g&&t.g.size>=t.j}function xr(t){return t.h?1:t.g?t.g.size:0}function kr(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function Nr(t,e){t.g?t.g.add(e):t.h=e}function Rr(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function Lr(t){if(null!=t.h)return t.i.concat(t.h.F);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.F);return e}return ne(t.i)}Cr.prototype.cancel=function(){if(this.i=Lr(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var Or=class{stringify(t){return zt.JSON.stringify(t,void 0)}parse(t){return zt.JSON.parse(t,void 0)}};function Mr(){this.g=new Or}function Pr(t,e,n){const r=n||"";try{nr(t,(function(t,n){let s=t;Gt(t)&&(s=Je(t)),e.push(r+n+"="+encodeURIComponent(s))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function Fr(t,e,n,r,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(r)}catch(t){}}function Vr(t){this.l=t.ec||null,this.j=t.ob||!1}function Ur(t,e){We.call(this),this.F=t,this.u=e,this.m=void 0,this.readyState=Br,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Zt(Vr,Rn),Vr.prototype.g=function(){return new Ur(this.l,this.j)},Vr.prototype.i=function(t){return function(){return t}}({}),Zt(Ur,We);var Br=0;function qr(t){t.j.read().then(t.Xa.bind(t)).catch(t.ka.bind(t))}function jr(t){t.readyState=4,t.l=null,t.j=null,t.A=null,$r(t)}function $r(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(Bt=Ur.prototype).open=function(t,e){if(this.readyState!=Br)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,$r(this)},Bt.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.F||zt).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},Bt.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,jr(this)),this.readyState=Br},Bt.$a=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,$r(this)),this.g&&(this.readyState=3,$r(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==zt.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;qr(this)}else t.text().then(this.Za.bind(this),this.ka.bind(this))},Bt.Xa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?jr(this):$r(this),3==this.readyState&&qr(this)}},Bt.Za=function(t){this.g&&(this.response=this.responseText=t,jr(this))},Bt.Ya=function(t){this.g&&(this.response=t,jr(this))},Bt.ka=function(){this.g&&jr(this)},Bt.setRequestHeader=function(t,e){this.v.append(t,e)},Bt.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},Bt.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(Ur.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var zr=zt.JSON.parse;function Kr(t){We.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Gr,this.L=this.M=!1}Zt(Kr,We);var Gr="",Hr=/^https?$/i,Qr=["POST","PUT"];function Wr(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Yr(t),Jr(t)}function Yr(t){t.F||(t.F=!0,Ye(t,"complete"),Ye(t,"error"))}function Xr(t){if(t.h&&void 0!==$t&&(!t.C[1]||4!=ts(t)||2!=t.da()))if(t.v&&4==ts(t))dn(t.La,0,t);else if(Ye(t,"readystatechange"),4==ts(t)){t.h=!1;try{const o=t.da();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var r;if(r=0===o){var s=String(t.I).match(rr)[1]||null;!s&&zt.self&&zt.self.location&&(s=zt.self.location.protocol.slice(0,-1)),r=!Hr.test(s?s.toLowerCase():"")}n=r}if(n)Ye(t,"complete"),Ye(t,"success");else{t.m=6;try{var i=2<ts(t)?t.g.statusText:""}catch(t){i=""}t.j=i+" ["+t.da()+"]",Yr(t)}}finally{Jr(t)}}}function Jr(t,e){if(t.g){Zr(t);const n=t.g,r=t.C[0]?()=>{}:null;t.g=null,t.C=null,e||Ye(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function Zr(t){t.g&&t.L&&(t.g.ontimeout=null),t.A&&(zt.clearTimeout(t.A),t.A=null)}function ts(t){return t.g?t.g.readyState:0}function es(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.K){case Gr:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function ns(t){let e="";return ke(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function rs(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=ns(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):ur(t,e,n))}function ss(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function is(t){this.Ga=0,this.j=[],this.l=new wn,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=ss("failFast",!1,t),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=ss("baseRetryDelayMs",5e3,t),this.hb=ss("retryDelaySeedMs",1e4,t),this.eb=ss("forwardChannelMaxRetries",2,t),this.xa=ss("forwardChannelRequestTimeoutMs",2e4,t),this.va=t&&t.xmlHttpFactory||void 0,this.Ha=t&&t.useFetchStreams||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.i=new Cr(t&&t.concurrentRequestLimit),this.Ja=new Mr,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=t&&t.bc||!1,t&&t.Ea&&this.l.Ea(),t&&t.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&t&&t.detectBufferingProxy||!1,this.qa=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.qa=t.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function os(t){if(cs(t),3==t.H){var e=t.W++,n=ir(t.I);if(ur(n,"SID",t.K),ur(n,"RID",e),ur(n,"TYPE","terminate"),hs(t,n),(e=new Bn(t,t.l,e)).L=2,e.A=lr(ir(n)),n=!1,zt.navigator&&zt.navigator.sendBeacon)try{n=zt.navigator.sendBeacon(e.A.toString(),"")}catch(t){}!n&&zt.Image&&((new Image).src=e.A,n=!0),n||(e.g=Ts(e.l,null),e.g.ha(e.A)),e.G=Date.now(),Yn(e)}Es(t)}function as(t){t.g&&(gs(t),t.g.cancel(),t.g=null)}function cs(t){as(t),t.u&&(zt.clearTimeout(t.u),t.u=null),ys(t),t.i.cancel(),t.m&&("number"==typeof t.m&&zt.clearTimeout(t.m),t.m=null)}function us(t){if(!Dr(t.i)&&!t.m){t.m=!0;var e=t.Na;sn||cn(),on||(sn(),on=!0),an.add(e,t),t.C=0}}function ls(t,e){var n;n=e?e.m:t.W++;const r=ir(t.I);ur(r,"SID",t.K),ur(r,"RID",n),ur(r,"AID",t.V),hs(t,r),t.o&&t.s&&rs(r,t.o,t.s),n=new Bn(t,t.l,n,t.C+1),null===t.o&&(n.I=t.s),e&&(t.j=e.F.concat(t.j)),e=ds(t,n,1e3),n.setTimeout(Math.round(.5*t.xa)+Math.round(.5*t.xa*Math.random())),Nr(t.i,n),Kn(n,r,e)}function hs(t,e){t.na&&ke(t.na,(function(t,n){ur(e,n,t)})),t.h&&nr({},(function(t,n){ur(e,n,t)}))}function ds(t,e,n){n=Math.min(t.j.length,n);var r=t.h?Xt(t.h.Va,t.h,t):null;t:{var s=t.j;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=s[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let i=!0;for(let o=0;o<n;o++){let n=s[o].g;const a=s[o].map;if(n-=e,0>n)e=Math.max(0,s[o].g-100),i=!1;else try{Pr(a,t,"req"+n+"_")}catch(t){r&&r(a)}}if(i){r=t.join("&");break t}}}return t=t.j.splice(0,n),e.F=t,r}function fs(t){if(!t.g&&!t.u){t.ba=1;var e=t.Ma;sn||cn(),on||(sn(),on=!0),an.add(e,t),t.A=0}}function ps(t){return!(t.g||t.u||3<=t.A||(t.ba++,t.u=xn(Xt(t.Ma,t),ws(t,t.A)),t.A++,0))}function gs(t){null!=t.B&&(zt.clearTimeout(t.B),t.B=null)}function ms(t){t.g=new Bn(t,t.l,"rpc",t.ba),null===t.o&&(t.g.I=t.s),t.g.O=0;var e=ir(t.wa);ur(e,"RID","rpc"),ur(e,"SID",t.K),ur(e,"AID",t.V),ur(e,"CI",t.G?"0":"1"),!t.G&&t.qa&&ur(e,"TO",t.qa),ur(e,"TYPE","xmlhttp"),hs(t,e),t.o&&t.s&&rs(e,t.o,t.s),t.L&&t.g.setTimeout(t.L);var n=t.g;t=t.pa,n.L=1,n.A=lr(ir(e)),n.u=null,n.S=!0,Gn(n,t)}function ys(t){null!=t.v&&(zt.clearTimeout(t.v),t.v=null)}function vs(t,e){var n=null;if(t.g==e){ys(t),gs(t),t.g=null;var r=2}else{if(!kr(t.i,e))return;n=e.F,Rr(t.i,e),r=1}if(0!=t.H)if(e.i)if(1==r){n=e.u?e.u.length:0,e=Date.now()-e.G;var s=t.C;Ye(r=Tn(),new Dn(r,n)),us(t)}else fs(t);else if(3==(s=e.s)||0==s&&0<e.ca||!(1==r&&function(t,e){return!(xr(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.j=e.F.concat(t.j),0):1==t.H||2==t.H||t.C>=(t.cb?0:t.eb)||(t.m=xn(Xt(t.Na,t,e),ws(t,t.C)),t.C++,0)))}(t,e)||2==r&&ps(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),s){case 1:bs(t,5);break;case 4:bs(t,10);break;case 3:bs(t,6);break;default:bs(t,2)}}function ws(t,e){let n=t.ab+Math.floor(Math.random()*t.hb);return t.isActive()||(n*=2),n*e}function bs(t,e){if(t.l.info("Error code "+e),2==e){var n=null;t.h&&(n=null);var r=Xt(t.pb,t);n||(n=new sr("//www.google.com/images/cleardot.gif"),zt.location&&"http"==zt.location.protocol||or(n,"https"),lr(n)),function(t,e){const n=new wn;if(zt.Image){const r=new Image;r.onload=Jt(Fr,n,r,"TestLoadImage: loaded",!0,e),r.onerror=Jt(Fr,n,r,"TestLoadImage: error",!1,e),r.onabort=Jt(Fr,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=Jt(Fr,n,r,"TestLoadImage: timeout",!1,e),zt.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else An(2);t.H=0,t.h&&t.h.za(e),Es(t),cs(t)}function Es(t){if(t.H=0,t.ma=[],t.h){const e=Lr(t.i);0==e.length&&0==t.j.length||(re(t.ma,e),re(t.ma,t.j),t.i.i.length=0,ne(t.j),t.j.length=0),t.h.ya()}}function _s(t,e,n){var r=n instanceof sr?ir(n):new sr(n);if(""!=r.g)e&&(r.g=e+"."+r.g),ar(r,r.m);else{var s=zt.location;r=s.protocol,e=e?e+"."+s.hostname:s.hostname,s=+s.port;var i=new sr(null);r&&or(i,r),e&&(i.g=e),s&&ar(i,s),n&&(i.l=n),r=i}return n=t.F,e=t.Da,n&&e&&ur(r,n,e),ur(r,"VER",t.ra),hs(t,r),r}function Ts(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=t.Ha&&!t.va?new Kr(new Vr({ob:n})):new Kr(t.va)).Oa(t.J),e}function Ss(){}function Is(){if(pe&&!(10<=Number(Te)))throw Error("Environmental error: no available transport.")}function Cs(t,e){We.call(this),this.g=new is(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(t?t["X-WebChannel-Client-Profile"]=e.Ca:t={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=t,(t=e&&e.cc)&&!oe(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!oe(e)&&(this.g.F=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new xs(this)}function As(t){Fn.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Ds(){Vn.call(this),this.status=1}function xs(t){this.g=t}function ks(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function Ns(t,e,n){n||(n=0);var r=Array(16);if("string"==typeof e)for(var s=0;16>s;++s)r[s]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(s=0;16>s;++s)r[s]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],s=t.g[2];var i=t.g[3],o=e+(i^n&(s^i))+r[0]+3614090360&4294967295;o=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=n+(o<<7&4294967295|o>>>25))+((o=i+(s^e&(n^s))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(e^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(i^e))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^n&(s^i))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^e&(n^s))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(e^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(i^e))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^n&(s^i))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^e&(n^s))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(e^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(i^e))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^n&(s^i))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^e&(n^s))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(e^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(i^e))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^i&(n^s))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(e^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(i^e))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(s^i))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^i&(n^s))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(e^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(i^e))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(s^i))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^i&(n^s))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(e^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(i^e))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(s^i))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^i&(n^s))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(e^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(i^e))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(s^i))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(n^s^i)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^s)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^e)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^s^i)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^s)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^e)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^s^i)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^s)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^e)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^s^i)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^s)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^e)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(s^(n|~i))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~s))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(i|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~e))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(s^(n|~i))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~s))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(i|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~e))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(s^(n|~i))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~s))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(i|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~e))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((i=(e=n+((o=e+(s^(n|~i))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~s))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((s=i+((o=s+(e^(i|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+r[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(s+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+s&4294967295,t.g[3]=t.g[3]+i&4294967295}function Rs(t,e){this.h=e;for(var n=[],r=!0,s=t.length-1;0<=s;s--){var i=0|t[s];r&&i==e||(n[s]=i,r=!1)}this.g=n}(Bt=Kr.prototype).Oa=function(t){this.M=t},Bt.ha=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+t);e=e?e.toUpperCase():"GET",this.I=t,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Mn.g(),this.C=this.u?Ln(this.u):Ln(Mn),this.g.onreadystatechange=Xt(this.La,this);try{this.G=!0,this.g.open(e,String(t),!0),this.G=!1}catch(t){return void Wr(this,t)}if(t=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const t of r.keys())n.set(t,r.get(t))}r=Array.from(n.keys()).find((t=>"content-type"==t.toLowerCase())),s=zt.FormData&&t instanceof zt.FormData,!(0<=ee(Qr,e))||r||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of n)this.g.setRequestHeader(t,e);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Zr(this),0<this.B&&((this.L=function(t){return pe&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Xt(this.ua,this)):this.A=dn(this.ua,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){Wr(this,t)}},Bt.ua=function(){void 0!==$t&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ye(this,"timeout"),this.abort(8))},Bt.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Ye(this,"complete"),Ye(this,"abort"),Jr(this))},Bt.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Jr(this,!0)),Kr.$.N.call(this)},Bt.La=function(){this.s||(this.G||this.v||this.l?Xr(this):this.kb())},Bt.kb=function(){Xr(this)},Bt.isActive=function(){return!!this.g},Bt.da=function(){try{return 2<ts(this)?this.g.status:-1}catch(t){return-1}},Bt.ja=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},Bt.Wa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),zr(e)}},Bt.Ia=function(){return this.m},Bt.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(Bt=is.prototype).ra=8,Bt.H=1,Bt.Na=function(t){if(this.m)if(this.m=null,1==this.H){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;const s=new Bn(this,this.l,t);let i=this.s;if(this.U&&(i?(i=Ne(i),Le(i,this.U)):i=this.U),null!==this.o||this.O||(s.I=i,i=null),this.P)t:{for(var e=0,n=0;n<this.j.length;n++){var r=this.j[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=n;break t}if(4096===e||n===this.j.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=ds(this,s,e),ur(n=ir(this.I),"RID",t),ur(n,"CVER",22),this.F&&ur(n,"X-HTTP-Session-Id",this.F),hs(this,n),i&&(this.O?e="headers="+encodeURIComponent(String(ns(i)))+"&"+e:this.o&&rs(n,this.o,i)),Nr(this.i,s),this.bb&&ur(n,"TYPE","init"),this.P?(ur(n,"$req",e),ur(n,"SID","null"),s.aa=!0,Kn(s,n,null)):Kn(s,n,e),this.H=2}}else 3==this.H&&(t?ls(this,t):0==this.j.length||Dr(this.i)||ls(this))},Bt.Ma=function(){if(this.u=null,ms(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var t=2*this.S;this.l.info("BP detection timer enabled: "+t),this.B=xn(Xt(this.jb,this),t)}},Bt.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,An(10),as(this),ms(this))},Bt.ib=function(){null!=this.v&&(this.v=null,as(this),ps(this),An(19))},Bt.pb=function(t){t?(this.l.info("Successfully pinged google.com"),An(2)):(this.l.info("Failed to ping google.com"),An(1))},Bt.isActive=function(){return!!this.h&&this.h.isActive(this)},(Bt=Ss.prototype).Ba=function(){},Bt.Aa=function(){},Bt.za=function(){},Bt.ya=function(){},Bt.isActive=function(){return!0},Bt.Va=function(){},Is.prototype.g=function(t,e){return new Cs(t,e)},Zt(Cs,We),Cs.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var t=this.g,e=this.l,n=this.h||void 0;An(0),t.Y=e,t.na=n||{},t.G=t.aa,t.I=_s(t,null,t.Y),us(t)},Cs.prototype.close=function(){os(this.g)},Cs.prototype.u=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.v&&((n={}).__data__=Je(t),t=n);e.j.push(new Ir(e.fb++,t)),3==e.H&&us(e)},Cs.prototype.N=function(){this.g.h=null,delete this.j,os(this.g),delete this.g,Cs.$.N.call(this)},Zt(As,Fn),Zt(Ds,Vn),Zt(xs,Ss),xs.prototype.Ba=function(){Ye(this.g,"a")},xs.prototype.Aa=function(t){Ye(this.g,new As(t))},xs.prototype.za=function(t){Ye(this.g,new Ds)},xs.prototype.ya=function(){Ye(this.g,"b")},Zt(ks,(function(){this.blockSize=-1})),ks.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},ks.prototype.j=function(t,e){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=this.m,s=this.h,i=0;i<e;){if(0==s)for(;i<=n;)Ns(this,t,i),i+=this.blockSize;if("string"==typeof t){for(;i<e;)if(r[s++]=t.charCodeAt(i++),s==this.blockSize){Ns(this,r),s=0;break}}else for(;i<e;)if(r[s++]=t[i++],s==this.blockSize){Ns(this,r),s=0;break}}this.h=s,this.i+=e},ks.prototype.l=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.i;for(e=t.length-8;e<t.length;++e)t[e]=255&n,n/=256;for(this.j(t),t=Array(16),e=n=0;4>e;++e)for(var r=0;32>r;r+=8)t[n++]=this.g[e]>>>r&255;return t};var Ls={};function Os(t){return-128<=t&&128>t?function(t,e){var n=Ls;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=function(t){return new Rs([0|t],0>t?-1:0)}(t)}(t):new Rs([0|t],0>t?-1:0)}function Ms(t){if(isNaN(t)||!isFinite(t))return Fs;if(0>t)return js(Ms(-t));for(var e=[],n=1,r=0;t>=n;r++)e[r]=t/n|0,n*=Ps;return new Rs(e,0)}var Ps=4294967296,Fs=Os(0),Vs=Os(1),Us=Os(16777216);function Bs(t){if(0!=t.h)return!1;for(var e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function qs(t){return-1==t.h}function js(t){for(var e=t.g.length,n=[],r=0;r<e;r++)n[r]=~t.g[r];return new Rs(n,~t.h).add(Vs)}function $s(t,e){return t.add(js(e))}function zs(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function Ks(t,e){this.g=t,this.h=e}function Gs(t,e){if(Bs(e))throw Error("division by zero");if(Bs(t))return new Ks(Fs,Fs);if(qs(t))return e=Gs(js(t),e),new Ks(js(e.g),js(e.h));if(qs(e))return e=Gs(t,js(e)),new Ks(js(e.g),e.h);if(30<t.g.length){if(qs(t)||qs(e))throw Error("slowDivide_ only works with positive integers.");for(var n=Vs,r=e;0>=r.X(t);)n=Hs(n),r=Hs(r);var s=Qs(n,1),i=Qs(r,1);for(r=Qs(r,2),n=Qs(n,2);!Bs(r);){var o=i.add(r);0>=o.X(t)&&(s=s.add(n),i=o),r=Qs(r,1),n=Qs(n,1)}return e=$s(t,s.R(e)),new Ks(s,e)}for(s=Fs;0<=t.X(e);){for(n=Math.max(1,Math.floor(t.ea()/e.ea())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),o=(i=Ms(n)).R(e);qs(o)||0<o.X(t);)o=(i=Ms(n-=r)).R(e);Bs(i)&&(i=Vs),s=s.add(i),t=$s(t,o)}return new Ks(s,t)}function Hs(t){for(var e=t.g.length+1,n=[],r=0;r<e;r++)n[r]=t.D(r)<<1|t.D(r-1)>>>31;return new Rs(n,t.h)}function Qs(t,e){var n=e>>5;e%=32;for(var r=t.g.length-n,s=[],i=0;i<r;i++)s[i]=0<e?t.D(i+n)>>>e|t.D(i+n+1)<<32-e:t.D(i+n);return new Rs(s,t.h)}(Bt=Rs.prototype).ea=function(){if(qs(this))return-js(this).ea();for(var t=0,e=1,n=0;n<this.g.length;n++){var r=this.D(n);t+=(0<=r?r:Ps+r)*e,e*=Ps}return t},Bt.toString=function(t){if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if(Bs(this))return"0";if(qs(this))return"-"+js(this).toString(t);for(var e=Ms(Math.pow(t,6)),n=this,r="";;){var s=Gs(n,e).g,i=((0<(n=$s(n,s.R(e))).g.length?n.g[0]:n.h)>>>0).toString(t);if(Bs(n=s))return i+r;for(;6>i.length;)i="0"+i;r=i+r}},Bt.D=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h},Bt.X=function(t){return qs(t=$s(this,t))?-1:Bs(t)?0:1},Bt.abs=function(){return qs(this)?js(this):this},Bt.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0,s=0;s<=e;s++){var i=r+(65535&this.D(s))+(65535&t.D(s)),o=(i>>>16)+(this.D(s)>>>16)+(t.D(s)>>>16);r=o>>>16,i&=65535,o&=65535,n[s]=o<<16|i}return new Rs(n,-2147483648&n[n.length-1]?-1:0)},Bt.R=function(t){if(Bs(this)||Bs(t))return Fs;if(qs(this))return qs(t)?js(this).R(js(t)):js(js(this).R(t));if(qs(t))return js(this.R(js(t)));if(0>this.X(Us)&&0>t.X(Us))return Ms(this.ea()*t.ea());for(var e=this.g.length+t.g.length,n=[],r=0;r<2*e;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var s=0;s<t.g.length;s++){var i=this.D(r)>>>16,o=65535&this.D(r),a=t.D(s)>>>16,c=65535&t.D(s);n[2*r+2*s]+=o*c,zs(n,2*r+2*s),n[2*r+2*s+1]+=i*c,zs(n,2*r+2*s+1),n[2*r+2*s+1]+=o*a,zs(n,2*r+2*s+1),n[2*r+2*s+2]+=i*a,zs(n,2*r+2*s+2)}for(r=0;r<e;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=e;r<2*e;r++)n[r]=0;return new Rs(n,0)},Bt.gb=function(t){return Gs(this,t).h},Bt.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)&t.D(r);return new Rs(n,this.h&t.h)},Bt.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)|t.D(r);return new Rs(n,this.h|t.h)},Bt.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)^t.D(r);return new Rs(n,this.h^t.h)},Is.prototype.createWebChannel=Is.prototype.g,Cs.prototype.send=Cs.prototype.u,Cs.prototype.open=Cs.prototype.m,Cs.prototype.close=Cs.prototype.close,kn.NO_ERROR=0,kn.TIMEOUT=8,kn.HTTP_ERROR=6,Nn.COMPLETE="complete",On.EventType=Pn,Pn.OPEN="a",Pn.CLOSE="b",Pn.ERROR="c",Pn.MESSAGE="d",We.prototype.listen=We.prototype.O,Kr.prototype.listenOnce=Kr.prototype.P,Kr.prototype.getLastError=Kr.prototype.Sa,Kr.prototype.getLastErrorCode=Kr.prototype.Ia,Kr.prototype.getStatus=Kr.prototype.da,Kr.prototype.getResponseJson=Kr.prototype.Wa,Kr.prototype.getResponseText=Kr.prototype.ja,Kr.prototype.send=Kr.prototype.ha,Kr.prototype.setWithCredentials=Kr.prototype.Oa,ks.prototype.digest=ks.prototype.l,ks.prototype.reset=ks.prototype.reset,ks.prototype.update=ks.prototype.j,Rs.prototype.add=Rs.prototype.add,Rs.prototype.multiply=Rs.prototype.R,Rs.prototype.modulo=Rs.prototype.gb,Rs.prototype.compare=Rs.prototype.X,Rs.prototype.toNumber=Rs.prototype.ea,Rs.prototype.toString=Rs.prototype.toString,Rs.prototype.getBits=Rs.prototype.D,Rs.fromNumber=Ms,Rs.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return js(t(e.substring(1),n));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=Ms(Math.pow(n,8)),s=Fs,i=0;i<e.length;i+=8){var o=Math.min(8,e.length-i),a=parseInt(e.substring(i,i+o),n);8>o?(o=Ms(Math.pow(n,o)),s=s.R(o).add(Ms(a))):s=(s=s.R(r)).add(Ms(a))}return s};var Ws=jt.createWebChannelTransport=function(){return new Is},Ys=jt.getStatEventTarget=function(){return Tn()},Xs=jt.ErrorCode=kn,Js=jt.EventType=Nn,Zs=jt.Event=En,ti=jt.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},ei=(jt.FetchXmlHttpFactory=Vr,jt.WebChannel=On),ni=jt.XhrIo=Kr,ri=jt.Md5=ks,si=jt.Integer=Rs;const ii="@firebase/firestore";class oi{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}oi.UNAUTHENTICATED=new oi(null),oi.GOOGLE_CREDENTIALS=new oi("google-credentials-uid"),oi.FIRST_PARTY=new oi("first-party-uid"),oi.MOCK_USER=new oi("mock-user");let ai="10.10.0";const ci=new C("@firebase/firestore");function ui(){return ci.logLevel}function li(t,...e){if(ci.logLevel<=E.DEBUG){const n=e.map(fi);ci.debug(`Firestore (${ai}): ${t}`,...n)}}function hi(t,...e){if(ci.logLevel<=E.ERROR){const n=e.map(fi);ci.error(`Firestore (${ai}): ${t}`,...n)}}function di(t,...e){if(ci.logLevel<=E.WARN){const n=e.map(fi);ci.warn(`Firestore (${ai}): ${t}`,...n)}}function fi(t){if("string"==typeof t)return t;try{return function(t){return JSON.stringify(t)}(t)}catch(e){return t}}function pi(t="Unexpected state"){const e=`FIRESTORE (${ai}) INTERNAL ASSERTION FAILED: `+t;throw hi(e),new Error(e)}function gi(t,e){t||pi()}function mi(t,e){return t}const yi={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class vi extends l{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class wi{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class bi{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class Ei{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(oi.UNAUTHENTICATED)))}shutdown(){}}class _i{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class Ti{constructor(t){this.t=t,this.currentUser=oi.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const r=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let s=new wi;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new wi,t.enqueueRetryable((()=>r(this.currentUser)))};const i=()=>{const e=s;t.enqueueRetryable((async()=>{await e.promise,await r(this.currentUser)}))},o=t=>{li("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),i()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(li("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new wi)}}),0),i()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(li("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(gi("string"==typeof e.accessToken),new bi(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return gi(null===t||"string"==typeof t),new oi(t)}}class Si{constructor(t,e,n){this.l=t,this.h=e,this.P=n,this.type="FirstParty",this.user=oi.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Ii{constructor(t,e,n){this.l=t,this.h=e,this.P=n}getToken(){return Promise.resolve(new Si(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable((()=>e(oi.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Ci{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Ai{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){const n=t=>{null!=t.error&&li("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.R;return this.R=t.token,li("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const r=t=>{li("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.A.onInit((t=>r(t))),setTimeout((()=>{if(!this.appCheck){const t=this.A.getImmediate({optional:!0});t?r(t):li("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(gi("string"==typeof t.token),this.R=t.token,new Ci(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Di(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class xi{static newId(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const n=Di(40);for(let r=0;r<n.length;++r)e.length<20&&n[r]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return e}}function ki(t,e){return t<e?-1:t>e?1:0}function Ni(t,e,n){return t.length===e.length&&t.every(((t,r)=>n(t,e[r])))}class Ri{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new vi(yi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new vi(yi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new vi(yi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new vi(yi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return Ri.fromMillis(Date.now())}static fromDate(t){return Ri.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new Ri(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?ki(this.nanoseconds,t.nanoseconds):ki(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Li{constructor(t){this.timestamp=t}static fromTimestamp(t){return new Li(t)}static min(){return new Li(new Ri(0,0))}static max(){return new Li(new Ri(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Oi{constructor(t,e,n){void 0===e?e=0:e>t.length&&pi(),void 0===n?n=t.length-e:n>t.length-e&&pi(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===Oi.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Oi?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=t.get(r),s=e.get(r);if(n<s)return-1;if(n>s)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class Mi extends Oi{construct(t,e,n){return new Mi(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new vi(yi.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new Mi(e)}static emptyPath(){return new Mi([])}}const Pi=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Fi extends Oi{construct(t,e,n){return new Fi(t,e,n)}static isValidIdentifier(t){return Pi.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Fi.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Fi(["__name__"])}static fromServerFormat(t){const e=[];let n="",r=0;const s=()=>{if(0===n.length)throw new vi(yi.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let i=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new vi(yi.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new vi(yi.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(i=!i,r++):"."!==e||i?(n+=e,r++):(s(),r++)}if(s(),i)throw new vi(yi.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Fi(e)}static emptyPath(){return new Fi([])}}class Vi{constructor(t){this.path=t}static fromPath(t){return new Vi(Mi.fromString(t))}static fromName(t){return new Vi(Mi.fromString(t).popFirst(5))}static empty(){return new Vi(Mi.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===Mi.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return Mi.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new Vi(new Mi(t.slice()))}}function Ui(t){return new Bi(t.readTime,t.key,-1)}class Bi{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new Bi(Li.min(),Vi.empty(),-1)}static max(){return new Bi(Li.max(),Vi.empty(),-1)}}function qi(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=Vi.comparator(t.documentKey,e.documentKey),0!==n?n:ki(t.largestBatchId,e.largestBatchId))}const ji="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class $i{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function zi(t){if(t.code!==yi.FAILED_PRECONDITION||t.message!==ji)throw t;li("LocalStore","Unexpectedly lost primary lease")}class Ki{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&pi(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new Ki(((n,r)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,r)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,r)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof Ki?e:Ki.resolve(e)}catch(t){return Ki.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):Ki.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):Ki.reject(e)}static resolve(t){return new Ki(((e,n)=>{e(t)}))}static reject(t){return new Ki(((e,n)=>{n(t)}))}static waitFor(t){return new Ki(((e,n)=>{let r=0,s=0,i=!1;t.forEach((t=>{++r,t.next((()=>{++s,i&&s===r&&e()}),(t=>n(t)))})),i=!0,s===r&&e()}))}static or(t){let e=Ki.resolve(!1);for(const n of t)e=e.next((t=>t?Ki.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,r)=>{n.push(e.call(this,t,r))})),this.waitFor(n)}static mapArray(t,e){return new Ki(((n,r)=>{const s=t.length,i=new Array(s);let o=0;for(let a=0;a<s;a++){const c=a;e(t[c]).next((t=>{i[c]=t,++o,o===s&&n(i)}),(t=>r(t)))}}))}static doWhile(t,e){return new Ki(((n,r)=>{const s=()=>{!0===t()?e().next((()=>{s()}),r):n()};s()}))}}class Gi{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.V=new wi,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{e.error?this.V.reject(new Wi(t,e.error)):this.V.resolve()},this.transaction.onerror=e=>{const n=to(e.target.error);this.V.reject(new Wi(t,n))}}static open(t,e,n,r){try{return new Gi(e,t.transaction(r,n))}catch(t){throw new Wi(e,t)}}get m(){return this.V.promise}abort(t){t&&this.V.reject(t),this.aborted||(li("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const t=this.transaction;this.aborted||"function"!=typeof t.commit||t.commit()}store(t){const e=this.transaction.objectStore(t);return new Xi(e)}}class Hi{constructor(t,e,n){this.name=t,this.version=e,this.p=n,12.2===Hi.S(c())&&hi("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return li("SimpleDb","Removing database:",t),Ji(window.indexedDB.deleteDatabase(t)).toPromise()}static D(){if(!u())return!1;if(Hi.C())return!0;const t=c(),e=Hi.S(t),n=0<e&&e<10,r=Hi.v(t),s=0<r&&r<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||s)}static C(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.__PRIVATE_env)||void 0===t?void 0:t.F)}static M(t,e){return t.store(e)}static S(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static v(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async O(t){return this.db||(li("SimpleDb","Opening database:",this.name),this.db=await new Promise(((e,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=t=>{const n=t.target.result;e(n)},r.onblocked=()=>{n(new Wi(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=e=>{const r=e.target.error;"VersionError"===r.name?n(new vi(yi.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new vi(yi.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new Wi(t,r))},r.onupgradeneeded=t=>{li("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);const e=t.target.result;this.p.N(e,r.transaction,t.oldVersion,this.version).next((()=>{li("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.L&&(this.db.onversionchange=t=>this.L(t)),this.db}B(t){this.L=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(t,e,n,r){const s="readonly"===e;let i=0;for(;;){++i;try{this.db=await this.O(t);const e=Gi.open(this.db,t,s?"readonly":"readwrite",n),i=r(e).next((t=>(e.g(),t))).catch((t=>(e.abort(t),Ki.reject(t)))).toPromise();return i.catch((()=>{})),await e.m,i}catch(t){const e=t,n="FirebaseError"!==e.name&&i<3;if(li("SimpleDb","Transaction failed with error:",e.message,"Retrying:",n),this.close(),!n)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}class Qi{constructor(t){this.k=t,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(t){this.k=t}done(){this.q=!0}U(t){this.K=t}delete(){return Ji(this.k.delete())}}class Wi extends vi{constructor(t,e){super(yi.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function Yi(t){return"IndexedDbTransactionError"===t.name}class Xi{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(li("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(li("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Ji(n)}add(t){return li("SimpleDb","ADD",this.store.name,t,t),Ji(this.store.add(t))}get(t){return Ji(this.store.get(t)).next((e=>(void 0===e&&(e=null),li("SimpleDb","GET",this.store.name,t,e),e)))}delete(t){return li("SimpleDb","DELETE",this.store.name,t),Ji(this.store.delete(t))}count(){return li("SimpleDb","COUNT",this.store.name),Ji(this.store.count())}W(t,e){const n=this.options(t,e),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){const t=r.getAll(n.range);return new Ki(((e,n)=>{t.onerror=t=>{n(t.target.error)},t.onsuccess=t=>{e(t.target.result)}}))}{const t=this.cursor(n),e=[];return this.G(t,((t,n)=>{e.push(n)})).next((()=>e))}}j(t,e){const n=this.store.getAll(t,null===e?void 0:e);return new Ki(((t,e)=>{n.onerror=t=>{e(t.target.error)},n.onsuccess=e=>{t(e.target.result)}}))}H(t,e){li("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.J=!1;const r=this.cursor(n);return this.G(r,((t,e,n)=>n.delete()))}Y(t,e){let n;e?n=t:(n={},e=t);const r=this.cursor(n);return this.G(r,e)}Z(t){const e=this.cursor({});return new Ki(((n,r)=>{e.onerror=t=>{const e=to(t.target.error);r(e)},e.onsuccess=e=>{const r=e.target.result;r?t(r.primaryKey,r.value).next((t=>{t?r.continue():n()})):n()}}))}G(t,e){const n=[];return new Ki(((r,s)=>{t.onerror=t=>{s(t.target.error)},t.onsuccess=t=>{const s=t.target.result;if(!s)return void r();const i=new Qi(s),o=e(s.primaryKey,s.value,i);if(o instanceof Ki){const t=o.catch((t=>(i.done(),Ki.reject(t))));n.push(t)}i.isDone?r():null===i.$?s.continue():s.continue(i.$)}})).next((()=>Ki.waitFor(n)))}options(t,e){let n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.J?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function Ji(t){return new Ki(((e,n)=>{t.onsuccess=t=>{const n=t.target.result;e(n)},t.onerror=t=>{const e=to(t.target.error);n(e)}}))}let Zi=!1;function to(t){const e=Hi.S(c());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new vi("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Zi||(Zi=!0,setTimeout((()=>{throw t}),0)),t}}return t}class eo{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.se(t),this.oe=t=>e.writeSequenceNumber(t))}se(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.oe&&this.oe(t),t}}function no(t){return null==t}function ro(t){return 0===t&&1/t==-1/0}eo._e=-1;function so(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function io(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function oo(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class ao{constructor(t,e){this.comparator=t,this.root=e||uo.EMPTY}insert(t,e){return new ao(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,uo.BLACK,null,null))}remove(t){return new ao(this.comparator,this.root.remove(t,this.comparator).copy(null,null,uo.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new co(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new co(this.root,t,this.comparator,!1)}getReverseIterator(){return new co(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new co(this.root,t,this.comparator,!0)}}class co{constructor(t,e,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,e&&r&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(0===s){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class uo{constructor(t,e,n,r,s){this.key=t,this.value=e,this.color=null!=n?n:uo.RED,this.left=null!=r?r:uo.EMPTY,this.right=null!=s?s:uo.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,s){return new uo(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;const s=n(t,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===s?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return uo.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return uo.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,uo.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,uo.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw pi();if(this.right.isRed())throw pi();const t=this.left.check();if(t!==this.right.check())throw pi();return t+(this.isRed()?0:1)}}uo.EMPTY=null,uo.RED=!0,uo.BLACK=!1,uo.EMPTY=new class{constructor(){this.size=0}get key(){throw pi()}get value(){throw pi()}get color(){throw pi()}get left(){throw pi()}get right(){throw pi()}copy(t,e,n,r,s){return this}insert(t,e,n){return new uo(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class lo{constructor(t){this.comparator=t,this.data=new ao(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new ho(this.data.getIterator())}getIteratorFrom(t){return new ho(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof lo))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(0!==this.comparator(t,r))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new lo(this.comparator);return e.data=t,e}}class ho{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class fo{constructor(t){this.fields=t,t.sort(Fi.comparator)}static empty(){return new fo([])}unionWith(t){let e=new lo(Fi.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new fo(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Ni(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class po extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class go{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new po("Invalid base64 string: "+t):t}}(t);return new go(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new go(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return ki(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}go.EMPTY_BYTE_STRING=new go("");const mo=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function yo(t){if(gi(!!t),"string"==typeof t){let e=0;const n=mo.exec(t);if(gi(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:vo(t.seconds),nanos:vo(t.nanos)}}function vo(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function wo(t){return"string"==typeof t?go.fromBase64String(t):go.fromUint8Array(t)}function bo(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Eo(t){const e=t.mapValue.fields.__previous_value__;return bo(e)?Eo(e):e}function _o(t){const e=yo(t.mapValue.fields.__local_write_time__.timestampValue);return new Ri(e.seconds,e.nanos)}class To{constructor(t,e,n,r,s,i,o,a,c){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class So{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new So("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof So&&t.projectId===this.projectId&&t.database===this.database}}const Io={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Co(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?bo(t)?4:Bo(t)?9007199254740991:10:pi()}function Ao(t,e){if(t===e)return!0;const n=Co(t);if(n!==Co(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return _o(t).isEqual(_o(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=yo(t.timestampValue),r=yo(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return wo(t.bytesValue).isEqual(wo(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return vo(t.geoPointValue.latitude)===vo(e.geoPointValue.latitude)&&vo(t.geoPointValue.longitude)===vo(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return vo(t.integerValue)===vo(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=vo(t.doubleValue),r=vo(e.doubleValue);return n===r?ro(n)===ro(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return Ni(t.arrayValue.values||[],e.arrayValue.values||[],Ao);case 10:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(so(n)!==so(r))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===r[t]||!Ao(n[t],r[t])))return!1;return!0}(t,e);default:return pi()}}function Do(t,e){return void 0!==(t.values||[]).find((t=>Ao(t,e)))}function xo(t,e){if(t===e)return 0;const n=Co(t),r=Co(e);if(n!==r)return ki(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return ki(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=vo(t.integerValue||t.doubleValue),r=vo(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return ko(t.timestampValue,e.timestampValue);case 4:return ko(_o(t),_o(e));case 5:return ki(t.stringValue,e.stringValue);case 6:return function(t,e){const n=wo(t),r=wo(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let t=0;t<n.length&&t<r.length;t++){const e=ki(n[t],r[t]);if(0!==e)return e}return ki(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=ki(vo(t.latitude),vo(e.latitude));return 0!==n?n:ki(vo(t.longitude),vo(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],r=e.values||[];for(let t=0;t<n.length&&t<r.length;++t){const e=xo(n[t],r[t]);if(e)return e}return ki(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===Io.mapValue&&e===Io.mapValue)return 0;if(t===Io.mapValue)return 1;if(e===Io.mapValue)return-1;const n=t.fields||{},r=Object.keys(n),s=e.fields||{},i=Object.keys(s);r.sort(),i.sort();for(let t=0;t<r.length&&t<i.length;++t){const e=ki(r[t],i[t]);if(0!==e)return e;const o=xo(n[r[t]],s[i[t]]);if(0!==o)return o}return ki(r.length,i.length)}(t.mapValue,e.mapValue);default:throw pi()}}function ko(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return ki(t,e);const n=yo(t),r=yo(e),s=ki(n.seconds,r.seconds);return 0!==s?s:ki(n.nanos,r.nanos)}function No(t){return Ro(t)}function Ro(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=yo(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(t){return wo(t).toBase64()}(t.bytesValue):"referenceValue"in t?function(t){return Vi.fromName(t).toString()}(t.referenceValue):"geoPointValue"in t?function(t){return`geo(${t.latitude},${t.longitude})`}(t.geoPointValue):"arrayValue"in t?function(t){let e="[",n=!0;for(const r of t.values||[])n?n=!1:e+=",",e+=Ro(r);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",r=!0;for(const s of e)r?r=!1:n+=",",n+=`${s}:${Ro(t.fields[s])}`;return n+"}"}(t.mapValue):pi()}function Lo(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Oo(t){return!!t&&"integerValue"in t}function Mo(t){return!!t&&"arrayValue"in t}function Po(t){return!!t&&"nullValue"in t}function Fo(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Vo(t){return!!t&&"mapValue"in t}function Uo(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return io(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=Uo(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Uo(t.arrayValue.values[n]);return e}return Object.assign({},t)}function Bo(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}class qo{constructor(t){this.value=t}static empty(){return new qo({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Vo(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Uo(e)}setAll(t){let e=Fi.emptyPath(),n={},r=[];t.forEach(((t,s)=>{if(!e.isImmediateParentOf(s)){const t=this.getFieldsMap(e);this.applyChanges(t,n,r),n={},r=[],e=s.popLast()}t?n[s.lastSegment()]=Uo(t):r.push(s.lastSegment())}));const s=this.getFieldsMap(e);this.applyChanges(s,n,r)}delete(t){const e=this.field(t.popLast());Vo(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Ao(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let r=e.mapValue.fields[t.get(n)];Vo(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,n){io(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new qo(Uo(this.value))}}function jo(t){const e=[];return io(t.fields,((t,n)=>{const r=new Fi([t]);if(Vo(n)){const t=jo(n.mapValue).fields;if(0===t.length)e.push(r);else for(const n of t)e.push(r.child(n))}else e.push(r)})),new fo(e)}class $o{constructor(t,e,n,r,s,i,o){this.key=t,this.documentType=e,this.version=n,this.readTime=r,this.createTime=s,this.data=i,this.documentState=o}static newInvalidDocument(t){return new $o(t,0,Li.min(),Li.min(),Li.min(),qo.empty(),0)}static newFoundDocument(t,e,n,r){return new $o(t,1,e,Li.min(),n,r,0)}static newNoDocument(t,e){return new $o(t,2,e,Li.min(),Li.min(),qo.empty(),0)}static newUnknownDocument(t,e){return new $o(t,3,e,Li.min(),Li.min(),qo.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(Li.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=qo.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=qo.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Li.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof $o&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new $o(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class zo{constructor(t,e){this.position=t,this.inclusive=e}}function Ko(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const i=e[s],o=t.position[s];if(r=i.field.isKeyField()?Vi.comparator(Vi.fromName(o.referenceValue),n.key):xo(o,n.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return r}function Go(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Ao(t.position[n],e.position[n]))return!1;return!0}class Ho{constructor(t,e="asc"){this.field=t,this.dir=e}}function Qo(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class Wo{}class Yo extends Wo{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new ra(t,e,n):"array-contains"===e?new aa(t,n):"in"===e?new ca(t,n):"not-in"===e?new ua(t,n):"array-contains-any"===e?new la(t,n):new Yo(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new sa(t,n):new ia(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(xo(e,this.value)):null!==e&&Co(this.value)===Co(e)&&this.matchesComparison(xo(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return pi()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Xo extends Wo{constructor(t,e){super(),this.filters=t,this.op=e,this.ue=null}static create(t,e){return new Xo(t,e)}matches(t){return Jo(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.ue||(this.ue=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function Jo(t){return"and"===t.op}function Zo(t){return function(t){for(const e of t.filters)if(e instanceof Xo)return!1;return!0}(t)&&Jo(t)}function ta(t){if(t instanceof Yo)return t.field.canonicalString()+t.op.toString()+No(t.value);if(Zo(t))return t.filters.map((t=>ta(t))).join(",");{const e=t.filters.map((t=>ta(t))).join(",");return`${t.op}(${e})`}}function ea(t,e){return t instanceof Yo?function(t,e){return e instanceof Yo&&t.op===e.op&&t.field.isEqual(e.field)&&Ao(t.value,e.value)}(t,e):t instanceof Xo?function(t,e){return e instanceof Xo&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,n,r)=>t&&ea(n,e.filters[r])),!0)}(t,e):void pi()}function na(t){return t instanceof Yo?function(t){return`${t.field.canonicalString()} ${t.op} ${No(t.value)}`}(t):t instanceof Xo?function(t){return t.op.toString()+" {"+t.getFilters().map(na).join(" ,")+"}"}(t):"Filter"}class ra extends Yo{constructor(t,e,n){super(t,e,n),this.key=Vi.fromName(n.referenceValue)}matches(t){const e=Vi.comparator(t.key,this.key);return this.matchesComparison(e)}}class sa extends Yo{constructor(t,e){super(t,"in",e),this.keys=oa(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class ia extends Yo{constructor(t,e){super(t,"not-in",e),this.keys=oa(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function oa(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>Vi.fromName(t.referenceValue)))}class aa extends Yo{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Mo(e)&&Do(e.arrayValue,this.value)}}class ca extends Yo{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Do(this.value.arrayValue,e)}}class ua extends Yo{constructor(t,e){super(t,"not-in",e)}matches(t){if(Do(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!Do(this.value.arrayValue,e)}}class la extends Yo{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Mo(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>Do(this.value.arrayValue,t)))}}class ha{constructor(t,e=null,n=[],r=[],s=null,i=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=i,this.endAt=o,this.ce=null}}function da(t,e=null,n=[],r=[],s=null,i=null,o=null){return new ha(t,e,n,r,s,i,o)}function fa(t){const e=mi(t);if(null===e.ce){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>ta(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),no(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>No(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>No(t))).join(",")),e.ce=t}return e.ce}function pa(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!Qo(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!ea(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Go(t.startAt,e.startAt)&&Go(t.endAt,e.endAt)}function ga(t){return Vi.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class ma{constructor(t,e=null,n=[],r=[],s=null,i="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=i,this.startAt=o,this.endAt=a,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}}function ya(t){return new ma(t)}function va(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function wa(t){return null!==t.collectionGroup}function ba(t){const e=mi(t);if(null===e.le){e.le=[];const t=new Set;for(const n of e.explicitOrderBy)e.le.push(n),t.add(n.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",r=function(t){let e=new lo(Fi.comparator);return t.filters.forEach((t=>{t.getFlattenedFilters().forEach((t=>{t.isInequality()&&(e=e.add(t.field))}))})),e}(e);r.forEach((r=>{t.has(r.canonicalString())||r.isKeyField()||e.le.push(new Ho(r,n))})),t.has(Fi.keyField().canonicalString())||e.le.push(new Ho(Fi.keyField(),n))}return e.le}function Ea(t){const e=mi(t);return e.he||(e.he=function(t,e){if("F"===t.limitType)return da(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((t=>{const e="desc"===t.dir?"asc":"desc";return new Ho(t.field,e)}));const n=t.endAt?new zo(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new zo(t.startAt.position,t.startAt.inclusive):null;return da(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}(e,ba(t))),e.he}function _a(t,e){const n=t.filters.concat([e]);return new ma(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function Ta(t,e,n){return new ma(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Sa(t,e){return pa(Ea(t),Ea(e))&&t.limitType===e.limitType}function Ia(t){return`${fa(Ea(t))}|lt:${t.limitType}`}function Ca(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>na(t))).join(", ")}]`),no(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>No(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>No(t))).join(",")),`Target(${e})`}(Ea(t))}; limitType=${t.limitType})`}function Aa(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):Vi.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of ba(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const r=Ko(t,e,n);return t.inclusive?r<=0:r<0}(t.startAt,ba(t),e)||t.endAt&&!function(t,e,n){const r=Ko(t,e,n);return t.inclusive?r>=0:r>0}(t.endAt,ba(t),e))}(t,e)}function Da(t){return(e,n)=>{let r=!1;for(const s of ba(t)){const t=xa(s,e,n);if(0!==t)return t;r=r||s.field.isKeyField()}return 0}}function xa(t,e,n){const r=t.field.isKeyField()?Vi.comparator(e.key,n.key):function(t,e,n){const r=e.data.field(t),s=n.data.field(t);return null!==r&&null!==s?xo(r,s):pi()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return pi()}}class ka{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,r]of n)if(this.equalsFn(e,t))return r}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],t))return void(r[n]=[t,e]);r.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(t){io(this.inner,((e,n)=>{for(const[e,r]of n)t(e,r)}))}isEmpty(){return oo(this.inner)}size(){return this.innerSize}}const Na=new ao(Vi.comparator);function Ra(){return Na}const La=new ao(Vi.comparator);function Oa(...t){let e=La;for(const n of t)e=e.insert(n.key,n);return e}function Ma(t){let e=La;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function Pa(){return Va()}function Fa(){return Va()}function Va(){return new ka((t=>t.toString()),((t,e)=>t.isEqual(e)))}const Ua=new ao(Vi.comparator),Ba=new lo(Vi.comparator);function qa(...t){let e=Ba;for(const n of t)e=e.add(n);return e}const ja=new lo(ki);function $a(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ro(e)?"-0":e}}function za(t){return{integerValue:""+t}}function Ka(t,e){return function(t){return"number"==typeof t&&Number.isInteger(t)&&!ro(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}(e)?za(e):$a(t,e)}class Ga{constructor(){this._=void 0}}function Ha(t,e,n){return t instanceof Ya?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&bo(e)&&(e=Eo(e)),e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Xa?Ja(t,e):t instanceof Za?tc(t,e):function(t,e){const n=Wa(t,e),r=nc(n)+nc(t.Ie);return Oo(n)&&Oo(t.Ie)?za(r):$a(t.serializer,r)}(t,e)}function Qa(t,e,n){return t instanceof Xa?Ja(t,e):t instanceof Za?tc(t,e):n}function Wa(t,e){return t instanceof ec?function(t){return Oo(t)||function(t){return!!t&&"doubleValue"in t}(t)}(e)?e:{integerValue:0}:null}class Ya extends Ga{}class Xa extends Ga{constructor(t){super(),this.elements=t}}function Ja(t,e){const n=rc(e);for(const e of t.elements)n.some((t=>Ao(t,e)))||n.push(e);return{arrayValue:{values:n}}}class Za extends Ga{constructor(t){super(),this.elements=t}}function tc(t,e){let n=rc(e);for(const e of t.elements)n=n.filter((t=>!Ao(t,e)));return{arrayValue:{values:n}}}class ec extends Ga{constructor(t,e){super(),this.serializer=t,this.Ie=e}}function nc(t){return vo(t.integerValue||t.doubleValue)}function rc(t){return Mo(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class sc{constructor(t,e){this.version=t,this.transformResults=e}}class ic{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new ic}static exists(t){return new ic(void 0,t)}static updateTime(t){return new ic(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function oc(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class ac{}function cc(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new vc(t.key,ic.none()):new fc(t.key,t.data,ic.none());{const n=t.data,r=qo.empty();let s=new lo(Fi.comparator);for(let t of e.fields)if(!s.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?r.delete(t):r.set(t,e),s=s.add(t)}return new pc(t.key,r,new fo(s.toArray()),ic.none())}}function uc(t,e,n){t instanceof fc?function(t,e,n){const r=t.value.clone(),s=mc(t.fieldTransforms,e,n.transformResults);r.setAll(s),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof pc?function(t,e,n){if(!oc(t.precondition,e))return void e.convertToUnknownDocument(n.version);const r=mc(t.fieldTransforms,e,n.transformResults),s=e.data;s.setAll(gc(t)),s.setAll(r),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function lc(t,e,n,r){return t instanceof fc?function(t,e,n,r){if(!oc(t.precondition,e))return n;const s=t.value.clone(),i=yc(t.fieldTransforms,r,e);return s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null}(t,e,n,r):t instanceof pc?function(t,e,n,r){if(!oc(t.precondition,e))return n;const s=yc(t.fieldTransforms,r,e),i=e.data;return i.setAll(gc(t)),i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,r):function(t,e,n){return oc(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function hc(t,e){let n=null;for(const r of t.fieldTransforms){const t=e.data.field(r.field),s=Wa(r.transform,t||null);null!=s&&(null===n&&(n=qo.empty()),n.set(r.field,s))}return n||null}function dc(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Ni(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Xa&&e instanceof Xa||t instanceof Za&&e instanceof Za?Ni(t.elements,e.elements,Ao):t instanceof ec&&e instanceof ec?Ao(t.Ie,e.Ie):t instanceof Ya&&e instanceof Ya}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class fc extends ac{constructor(t,e,n,r=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class pc extends ac{constructor(t,e,n,r,s=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function gc(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function mc(t,e,n){const r=new Map;gi(t.length===n.length);for(let s=0;s<n.length;s++){const i=t[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,Qa(o,a,n[s]))}return r}function yc(t,e,n){const r=new Map;for(const s of t){const t=s.transform,i=n.data.field(s.field);r.set(s.field,Ha(t,i,e))}return r}class vc extends ac{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class wc extends ac{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class bc{constructor(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const r=this.mutations[e];r.key.isEqual(t.key)&&uc(r,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=lc(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=lc(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=Fa();return this.mutations.forEach((r=>{const s=t.get(r.key),i=s.overlayedDocument;let o=this.applyToLocalView(i,s.mutatedFields);o=e.has(r.key)?null:o;const a=cc(i,o);null!==a&&n.set(r.key,a),i.isValidDocument()||i.convertToNoDocument(Li.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),qa())}isEqual(t){return this.batchId===t.batchId&&Ni(this.mutations,t.mutations,((t,e)=>dc(t,e)))&&Ni(this.baseMutations,t.baseMutations,((t,e)=>dc(t,e)))}}class Ec{constructor(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}static from(t,e,n){gi(t.mutations.length===n.length);let r=Ua;const s=t.mutations;for(let t=0;t<s.length;t++)r=r.insert(s[t].key,n[t].version);return new Ec(t,e,n,r)}}class _c{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Tc{constructor(t,e){this.count=t,this.unchangedNames=e}}var Sc,Ic;function Cc(t){if(void 0===t)return hi("GRPC error has no .code"),yi.UNKNOWN;switch(t){case Sc.OK:return yi.OK;case Sc.CANCELLED:return yi.CANCELLED;case Sc.UNKNOWN:return yi.UNKNOWN;case Sc.DEADLINE_EXCEEDED:return yi.DEADLINE_EXCEEDED;case Sc.RESOURCE_EXHAUSTED:return yi.RESOURCE_EXHAUSTED;case Sc.INTERNAL:return yi.INTERNAL;case Sc.UNAVAILABLE:return yi.UNAVAILABLE;case Sc.UNAUTHENTICATED:return yi.UNAUTHENTICATED;case Sc.INVALID_ARGUMENT:return yi.INVALID_ARGUMENT;case Sc.NOT_FOUND:return yi.NOT_FOUND;case Sc.ALREADY_EXISTS:return yi.ALREADY_EXISTS;case Sc.PERMISSION_DENIED:return yi.PERMISSION_DENIED;case Sc.FAILED_PRECONDITION:return yi.FAILED_PRECONDITION;case Sc.ABORTED:return yi.ABORTED;case Sc.OUT_OF_RANGE:return yi.OUT_OF_RANGE;case Sc.UNIMPLEMENTED:return yi.UNIMPLEMENTED;case Sc.DATA_LOSS:return yi.DATA_LOSS;default:return pi()}}(Ic=Sc||(Sc={}))[Ic.OK=0]="OK",Ic[Ic.CANCELLED=1]="CANCELLED",Ic[Ic.UNKNOWN=2]="UNKNOWN",Ic[Ic.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ic[Ic.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ic[Ic.NOT_FOUND=5]="NOT_FOUND",Ic[Ic.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ic[Ic.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ic[Ic.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ic[Ic.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ic[Ic.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ic[Ic.ABORTED=10]="ABORTED",Ic[Ic.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ic[Ic.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ic[Ic.INTERNAL=13]="INTERNAL",Ic[Ic.UNAVAILABLE=14]="UNAVAILABLE",Ic[Ic.DATA_LOSS=15]="DATA_LOSS";const Ac=new si([4294967295,4294967295],0);function Dc(t){const e=(new TextEncoder).encode(t),n=new ri;return n.update(e),new Uint8Array(n.digest())}function xc(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new si([n,r],0),new si([s,i],0)]}class kc{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new Nc(`Invalid padding: ${e}`);if(n<0)throw new Nc(`Invalid hash count: ${n}`);if(t.length>0&&0===this.hashCount)throw new Nc(`Invalid hash count: ${n}`);if(0===t.length&&0!==e)throw new Nc(`Invalid padding when bitmap length is 0: ${e}`);this.Te=8*t.length-e,this.Ee=si.fromNumber(this.Te)}de(t,e,n){let r=t.add(e.multiply(si.fromNumber(n)));return 1===r.compare(Ac)&&(r=new si([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Ee).toNumber()}Ae(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(0===this.Te)return!1;const e=Dc(t),[n,r]=xc(e);for(let t=0;t<this.hashCount;t++){const e=this.de(n,r,t);if(!this.Ae(e))return!1}return!0}static create(t,e,n){const r=t%8==0?0:8-t%8,s=new Uint8Array(Math.ceil(t/8)),i=new kc(s,r,e);return n.forEach((t=>i.insert(t))),i}insert(t){if(0===this.Te)return;const e=Dc(t),[n,r]=xc(e);for(let t=0;t<this.hashCount;t++){const e=this.de(n,r,t);this.Re(e)}}Re(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class Nc extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Rc{constructor(t,e,n,r,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const r=new Map;return r.set(t,Lc.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new Rc(Li.min(),r,new ao(ki),Ra(),qa())}}class Lc{constructor(t,e,n,r,s){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new Lc(n,e,qa(),qa(),qa())}}class Oc{constructor(t,e,n,r){this.Ve=t,this.removedTargetIds=e,this.key=n,this.me=r}}class Mc{constructor(t,e){this.targetId=t,this.fe=e}}class Pc{constructor(t,e,n=go.EMPTY_BYTE_STRING,r=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}class Fc{constructor(){this.ge=0,this.pe=Bc(),this.ye=go.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return 0!==this.ge}get De(){return this.Se}Ce(t){t.approximateByteSize()>0&&(this.Se=!0,this.ye=t)}ve(){let t=qa(),e=qa(),n=qa();return this.pe.forEach(((r,s)=>{switch(s){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:pi()}})),new Lc(this.ye,this.we,t,e,n)}Fe(){this.Se=!1,this.pe=Bc()}Me(t,e){this.Se=!0,this.pe=this.pe.insert(t,e)}xe(t){this.Se=!0,this.pe=this.pe.remove(t)}Oe(){this.ge+=1}Ne(){this.ge-=1,gi(this.ge>=0)}Le(){this.Se=!0,this.we=!0}}class Vc{constructor(t){this.Be=t,this.ke=new Map,this.qe=Ra(),this.Qe=Uc(),this.Ke=new ao(ki)}$e(t){for(const e of t.Ve)t.me&&t.me.isFoundDocument()?this.Ue(e,t.me):this.We(e,t.key,t.me);for(const e of t.removedTargetIds)this.We(e,t.key,t.me)}Ge(t){this.forEachTarget(t,(e=>{const n=this.ze(e);switch(t.state){case 0:this.je(e)&&n.Ce(t.resumeToken);break;case 1:n.Ne(),n.be||n.Fe(),n.Ce(t.resumeToken);break;case 2:n.Ne(),n.be||this.removeTarget(e);break;case 3:this.je(e)&&(n.Le(),n.Ce(t.resumeToken));break;case 4:this.je(e)&&(this.He(e),n.Ce(t.resumeToken));break;default:pi()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ke.forEach(((t,n)=>{this.je(n)&&e(n)}))}Je(t){const e=t.targetId,n=t.fe.count,r=this.Ye(e);if(r){const s=r.target;if(ga(s))if(0===n){const t=new Vi(s.path);this.We(e,t,$o.newNoDocument(t,Li.min()))}else gi(1===n);else{const r=this.Ze(e);if(r!==n){const n=this.Xe(t),s=n?this.et(n,t,r):1;if(0!==s){this.He(e);const t=2===s?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(e,t)}}}}}Xe(t){const e=t.fe.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:s=0}=e;let i,o;try{i=wo(n).toUint8Array()}catch(t){if(t instanceof po)return di("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw t}try{o=new kc(i,r,s)}catch(t){return di(t instanceof Nc?"BloomFilter error: ":"Applying bloom filter failed: ",t),null}return 0===o.Te?null:o}et(t,e,n){return e.fe.count===n-this.rt(t,e.targetId)?0:2}rt(t,e){const n=this.Be.getRemoteKeysForTarget(e);let r=0;return n.forEach((n=>{const s=this.Be.nt(),i=`projects/${s.projectId}/databases/${s.database}/documents/${n.path.canonicalString()}`;t.mightContain(i)||(this.We(e,n,null),r++)})),r}it(t){const e=new Map;this.ke.forEach(((n,r)=>{const s=this.Ye(r);if(s){if(n.current&&ga(s.target)){const e=new Vi(s.target.path);null!==this.qe.get(e)||this.st(r,e)||this.We(r,e,$o.newNoDocument(e,t))}n.De&&(e.set(r,n.ve()),n.Fe())}}));let n=qa();this.Qe.forEach(((t,e)=>{let r=!0;e.forEachWhile((t=>{const e=this.Ye(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(r=!1,!1)})),r&&(n=n.add(t))})),this.qe.forEach(((e,n)=>n.setReadTime(t)));const r=new Rc(t,e,this.Ke,this.qe,n);return this.qe=Ra(),this.Qe=Uc(),this.Ke=new ao(ki),r}Ue(t,e){if(!this.je(t))return;const n=this.st(t,e.key)?2:0;this.ze(t).Me(e.key,n),this.qe=this.qe.insert(e.key,e),this.Qe=this.Qe.insert(e.key,this.ot(e.key).add(t))}We(t,e,n){if(!this.je(t))return;const r=this.ze(t);this.st(t,e)?r.Me(e,1):r.xe(e),this.Qe=this.Qe.insert(e,this.ot(e).delete(t)),n&&(this.qe=this.qe.insert(e,n))}removeTarget(t){this.ke.delete(t)}Ze(t){const e=this.ze(t).ve();return this.Be.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Oe(t){this.ze(t).Oe()}ze(t){let e=this.ke.get(t);return e||(e=new Fc,this.ke.set(t,e)),e}ot(t){let e=this.Qe.get(t);return e||(e=new lo(ki),this.Qe=this.Qe.insert(t,e)),e}je(t){const e=null!==this.Ye(t);return e||li("WatchChangeAggregator","Detected inactive target",t),e}Ye(t){const e=this.ke.get(t);return e&&e.be?null:this.Be._t(t)}He(t){this.ke.set(t,new Fc),this.Be.getRemoteKeysForTarget(t).forEach((e=>{this.We(t,e,null)}))}st(t,e){return this.Be.getRemoteKeysForTarget(t).has(e)}}function Uc(){return new ao(Vi.comparator)}function Bc(){return new ao(Vi.comparator)}const qc={asc:"ASCENDING",desc:"DESCENDING"},jc={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},$c={and:"AND",or:"OR"};class zc{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function Kc(t,e){return t.useProto3Json||no(e)?e:{value:e}}function Gc(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Hc(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function Qc(t,e){return Gc(t,e.toTimestamp())}function Wc(t){return gi(!!t),Li.fromTimestamp(function(t){const e=yo(t);return new Ri(e.seconds,e.nanos)}(t))}function Yc(t,e){return Xc(t,e).canonicalString()}function Xc(t,e){const n=function(t){return new Mi(["projects",t.projectId,"databases",t.database])}(t).child("documents");return void 0===e?n:n.child(e)}function Jc(t){const e=Mi.fromString(t);return gi(mu(e)),e}function Zc(t,e){return Yc(t.databaseId,e.path)}function tu(t,e){const n=Jc(e);if(n.get(1)!==t.databaseId.projectId)throw new vi(yi.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new vi(yi.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Vi(ru(n))}function eu(t,e){return Yc(t.databaseId,e)}function nu(t){return new Mi(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function ru(t){return gi(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function su(t,e,n){return{name:Zc(t,e),fields:n.value.mapValue.fields}}function iu(t,e){return{documents:[eu(t,e.path)]}}function ou(t,e){const n={structuredQuery:{}},r=e.path;let s;null!==e.collectionGroup?(s=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=eu(t,s);const i=function(t){if(0!==t.length)return pu(Xo.create(t,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const o=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:du(t.field),direction:uu(t.dir)}}(t)))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const a=Kc(t,e.limit);return null!==a&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(t){return{before:t.inclusive,values:t.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),{ut:n,parent:s}}function au(t){let e=function(t){const e=Jc(t);return 4===e.length?Mi.emptyPath():ru(e)}(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){gi(1===r);const t=n.from[0];t.allDescendants?s=t.collectionId:e=e.child(t.collectionId)}let i=[];n.where&&(i=function(t){const e=cu(t);return e instanceof Xo&&Zo(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=function(t){return t.map((t=>function(t){return new Ho(fu(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)))}(n.orderBy));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,no(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new zo(n,e)}(n.startAt));let u=null;return n.endAt&&(u=function(t){const e=!t.before,n=t.values||[];return new zo(n,e)}(n.endAt)),function(t,e,n,r,s,i,o,a){return new ma(t,e,n,r,s,i,o,a)}(e,s,o,i,a,"F",c,u)}function cu(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=fu(t.unaryFilter.field);return Yo.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=fu(t.unaryFilter.field);return Yo.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=fu(t.unaryFilter.field);return Yo.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=fu(t.unaryFilter.field);return Yo.create(s,"!=",{nullValue:"NULL_VALUE"});default:return pi()}}(t):void 0!==t.fieldFilter?function(t){return Yo.create(fu(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return pi()}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return Xo.create(t.compositeFilter.filters.map((t=>cu(t))),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return pi()}}(t.compositeFilter.op))}(t):pi()}function uu(t){return qc[t]}function lu(t){return jc[t]}function hu(t){return $c[t]}function du(t){return{fieldPath:t.canonicalString()}}function fu(t){return Fi.fromServerFormat(t.fieldPath)}function pu(t){return t instanceof Yo?function(t){if("=="===t.op){if(Fo(t.value))return{unaryFilter:{field:du(t.field),op:"IS_NAN"}};if(Po(t.value))return{unaryFilter:{field:du(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Fo(t.value))return{unaryFilter:{field:du(t.field),op:"IS_NOT_NAN"}};if(Po(t.value))return{unaryFilter:{field:du(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:du(t.field),op:lu(t.op),value:t.value}}}(t):t instanceof Xo?function(t){const e=t.getFilters().map((t=>pu(t)));return 1===e.length?e[0]:{compositeFilter:{op:hu(t.op),filters:e}}}(t):pi()}function gu(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function mu(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class yu{constructor(t,e,n,r,s=Li.min(),i=Li.min(),o=go.EMPTY_BYTE_STRING,a=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(t){return new yu(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new yu(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new yu(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new yu(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class vu{constructor(t){this.ct=t}}function wu(t){const e=au({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Ta(e,e.limit,"L"):e}class bu{constructor(){}Pt(t,e){this.It(t,e),e.Tt()}It(t,e){if("nullValue"in t)this.Et(e,5);else if("booleanValue"in t)this.Et(e,10),e.dt(t.booleanValue?1:0);else if("integerValue"in t)this.Et(e,15),e.dt(vo(t.integerValue));else if("doubleValue"in t){const n=vo(t.doubleValue);isNaN(n)?this.Et(e,13):(this.Et(e,15),ro(n)?e.dt(0):e.dt(n))}else if("timestampValue"in t){const n=t.timestampValue;this.Et(e,20),"string"==typeof n?e.At(n):(e.At(`${n.seconds||""}`),e.dt(n.nanos||0))}else if("stringValue"in t)this.Rt(t.stringValue,e),this.Vt(e);else if("bytesValue"in t)this.Et(e,30),e.ft(wo(t.bytesValue)),this.Vt(e);else if("referenceValue"in t)this.gt(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.Et(e,45),e.dt(n.latitude||0),e.dt(n.longitude||0)}else"mapValue"in t?Bo(t)?this.Et(e,Number.MAX_SAFE_INTEGER):(this.yt(t.mapValue,e),this.Vt(e)):"arrayValue"in t?(this.wt(t.arrayValue,e),this.Vt(e)):pi()}Rt(t,e){this.Et(e,25),this.St(t,e)}St(t,e){e.At(t)}yt(t,e){const n=t.fields||{};this.Et(e,55);for(const t of Object.keys(n))this.Rt(t,e),this.It(n[t],e)}wt(t,e){const n=t.values||[];this.Et(e,50);for(const t of n)this.It(t,e)}gt(t,e){this.Et(e,37),Vi.fromName(t).path.forEach((t=>{this.Et(e,60),this.St(t,e)}))}Et(t,e){t.dt(e)}Vt(t){t.dt(2)}}bu.bt=new bu;class Eu{constructor(){this._n=new _u}addToCollectionParentIndex(t,e){return this._n.add(e),Ki.resolve()}getCollectionParents(t,e){return Ki.resolve(this._n.getEntries(e))}addFieldIndex(t,e){return Ki.resolve()}deleteFieldIndex(t,e){return Ki.resolve()}deleteAllFieldIndexes(t){return Ki.resolve()}createTargetIndexes(t,e){return Ki.resolve()}getDocumentsMatchingTarget(t,e){return Ki.resolve(null)}getIndexType(t,e){return Ki.resolve(0)}getFieldIndexes(t,e){return Ki.resolve([])}getNextCollectionGroupToUpdate(t){return Ki.resolve(null)}getMinOffset(t,e){return Ki.resolve(Bi.min())}getMinOffsetFromCollectionGroup(t,e){return Ki.resolve(Bi.min())}updateCollectionGroup(t,e,n){return Ki.resolve()}updateIndexEntries(t,e){return Ki.resolve()}}class _u{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new lo(Mi.comparator),s=!r.has(n);return this.index[e]=r.add(n),s}has(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)}getEntries(t){return(this.index[t]||new lo(Mi.comparator)).toArray()}}new Uint8Array(0);class Tu{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new Tu(t,Tu.DEFAULT_COLLECTION_PERCENTILE,Tu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}Tu.DEFAULT_COLLECTION_PERCENTILE=10,Tu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Tu.DEFAULT=new Tu(41943040,Tu.DEFAULT_COLLECTION_PERCENTILE,Tu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Tu.DISABLED=new Tu(-1,0,0);class Su{constructor(t){this.On=t}next(){return this.On+=2,this.On}static Nn(){return new Su(0)}static Ln(){return new Su(-1)}}class Iu{constructor(){this.changes=new ka((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,$o.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?Ki.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class Cu{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class Au{constructor(t,e,n,r){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((r=>(n=r,this.remoteDocumentCache.getEntry(t,e)))).next((t=>(null!==n&&lc(n.mutation,t,fo.empty(),Ri.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,qa()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=qa()){const r=Pa();return this.populateOverlays(t,r,e).next((()=>this.computeViews(t,e,r,n).next((t=>{let e=Oa();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=Pa();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,qa())))}populateOverlays(t,e,n){const r=[];return n.forEach((t=>{e.has(t)||r.push(t)})),this.documentOverlayCache.getOverlays(t,r).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,r){let s=Ra();const i=Va(),o=Va();return e.forEach(((t,e)=>{const o=n.get(e.key);r.has(e.key)&&(void 0===o||o.mutation instanceof pc)?s=s.insert(e.key,e):void 0!==o?(i.set(e.key,o.mutation.getFieldMask()),lc(o.mutation,e,o.mutation.getFieldMask(),Ri.now())):i.set(e.key,fo.empty())})),this.recalculateAndSaveOverlays(t,s).next((t=>(t.forEach(((t,e)=>i.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new Cu(e,null!==(n=i.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=Va();let r=new ao(((t,e)=>t-e)),s=qa();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const s of t)s.keys().forEach((t=>{const i=e.get(t);if(null===i)return;let o=n.get(t)||fo.empty();o=s.applyToLocalView(i,o),n.set(t,o);const a=(r.get(s.batchId)||qa()).add(t);r=r.insert(s.batchId,a)}))})).next((()=>{const i=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=Fa();c.forEach((t=>{if(!s.has(t)){const r=cc(e.get(t),n.get(t));null!==r&&u.set(t,r),s=s.add(t)}})),i.push(this.documentOverlayCache.saveOverlays(t,a,u))}return Ki.waitFor(i)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n,r){return function(t){return Vi.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):wa(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,r):this.getDocumentsMatchingCollectionQuery(t,e,n,r)}getNextDocuments(t,e,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,r).next((s=>{const i=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,r-s.size):Ki.resolve(Pa());let o=-1,a=s;return i.next((e=>Ki.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),s.get(e)?Ki.resolve():this.remoteDocumentCache.getEntry(t,e).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,s))).next((()=>this.computeViews(t,a,e,qa()))).next((t=>({batchId:o,changes:Ma(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new Vi(e)).next((t=>{let e=Oa();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n,r){const s=e.collectionGroup;let i=Oa();return this.indexManager.getCollectionParents(t,s).next((o=>Ki.forEach(o,(o=>{const a=function(t,e){return new ma(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,o.child(s));return this.getDocumentsMatchingCollectionQuery(t,a,n,r).next((t=>{t.forEach(((t,e)=>{i=i.insert(t,e)}))}))})).next((()=>i))))}getDocumentsMatchingCollectionQuery(t,e,n,r){let s;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((i=>(s=i,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,s,r)))).next((t=>{s.forEach(((e,n)=>{const r=n.getKey();null===t.get(r)&&(t=t.insert(r,$o.newInvalidDocument(r)))}));let n=Oa();return t.forEach(((t,r)=>{const i=s.get(t);void 0!==i&&lc(i.mutation,r,fo.empty(),Ri.now()),Aa(e,r)&&(n=n.insert(t,r))})),n}))}}class Du{constructor(t){this.serializer=t,this.cr=new Map,this.lr=new Map}getBundleMetadata(t,e){return Ki.resolve(this.cr.get(e))}saveBundleMetadata(t,e){return this.cr.set(e.id,function(t){return{id:t.id,version:t.version,createTime:Wc(t.createTime)}}(e)),Ki.resolve()}getNamedQuery(t,e){return Ki.resolve(this.lr.get(e))}saveNamedQuery(t,e){return this.lr.set(e.name,function(t){return{name:t.name,query:wu(t.bundledQuery),readTime:Wc(t.readTime)}}(e)),Ki.resolve()}}class xu{constructor(){this.overlays=new ao(Vi.comparator),this.hr=new Map}getOverlay(t,e){return Ki.resolve(this.overlays.get(e))}getOverlays(t,e){const n=Pa();return Ki.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,r)=>{this.ht(t,e,r)})),Ki.resolve()}removeOverlaysForBatchId(t,e,n){const r=this.hr.get(n);return void 0!==r&&(r.forEach((t=>this.overlays=this.overlays.remove(t))),this.hr.delete(n)),Ki.resolve()}getOverlaysForCollection(t,e,n){const r=Pa(),s=e.length+1,i=new Vi(e.child("")),o=this.overlays.getIteratorFrom(i);for(;o.hasNext();){const t=o.getNext().value,i=t.getKey();if(!e.isPrefixOf(i.path))break;i.path.length===s&&t.largestBatchId>n&&r.set(t.getKey(),t)}return Ki.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let s=new ao(((t,e)=>t-e));const i=this.overlays.getIterator();for(;i.hasNext();){const t=i.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=s.get(t.largestBatchId);null===e&&(e=Pa(),s=s.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=Pa(),a=s.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=r)););return Ki.resolve(o)}ht(t,e,n){const r=this.overlays.get(n.key);if(null!==r){const t=this.hr.get(r.largestBatchId).delete(n.key);this.hr.set(r.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new _c(e,n));let s=this.hr.get(e);void 0===s&&(s=qa(),this.hr.set(e,s)),this.hr.set(e,s.add(n.key))}}class ku{constructor(){this.Pr=new lo(Nu.Ir),this.Tr=new lo(Nu.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(t,e){const n=new Nu(t,e);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}dr(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.Ar(new Nu(t,e))}Rr(t,e){t.forEach((t=>this.removeReference(t,e)))}Vr(t){const e=new Vi(new Mi([])),n=new Nu(e,t),r=new Nu(e,t+1),s=[];return this.Tr.forEachInRange([n,r],(t=>{this.Ar(t),s.push(t.key)})),s}mr(){this.Pr.forEach((t=>this.Ar(t)))}Ar(t){this.Pr=this.Pr.delete(t),this.Tr=this.Tr.delete(t)}gr(t){const e=new Vi(new Mi([])),n=new Nu(e,t),r=new Nu(e,t+1);let s=qa();return this.Tr.forEachInRange([n,r],(t=>{s=s.add(t.key)})),s}containsKey(t){const e=new Nu(t,0),n=this.Pr.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class Nu{constructor(t,e){this.key=t,this.pr=e}static Ir(t,e){return Vi.comparator(t.key,e.key)||ki(t.pr,e.pr)}static Er(t,e){return ki(t.pr,e.pr)||Vi.comparator(t.key,e.key)}}class Ru{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.yr=1,this.wr=new lo(Nu.Ir)}checkEmpty(t){return Ki.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,r){const s=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new bc(s,e,n,r);this.mutationQueue.push(i);for(const e of r)this.wr=this.wr.add(new Nu(e.key,s)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return Ki.resolve(i)}lookupMutationBatch(t,e){return Ki.resolve(this.Sr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=this.br(n),s=r<0?0:r;return Ki.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return Ki.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(t){return Ki.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new Nu(e,0),r=new Nu(e,Number.POSITIVE_INFINITY),s=[];return this.wr.forEachInRange([n,r],(t=>{const e=this.Sr(t.pr);s.push(e)})),Ki.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new lo(ki);return e.forEach((t=>{const e=new Nu(t,0),r=new Nu(t,Number.POSITIVE_INFINITY);this.wr.forEachInRange([e,r],(t=>{n=n.add(t.pr)}))})),Ki.resolve(this.Dr(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1;let s=n;Vi.isDocumentKey(s)||(s=s.child(""));const i=new Nu(new Vi(s),0);let o=new lo(ki);return this.wr.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(o=o.add(t.pr)),!0)}),i),Ki.resolve(this.Dr(o))}Dr(t){const e=[];return t.forEach((t=>{const n=this.Sr(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){gi(0===this.Cr(e.batchId,"removed")),this.mutationQueue.shift();let n=this.wr;return Ki.forEach(e.mutations,(r=>{const s=new Nu(r.key,e.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)})).next((()=>{this.wr=n}))}Mn(t){}containsKey(t,e){const n=new Nu(e,0),r=this.wr.firstAfterOrEqual(n);return Ki.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this.mutationQueue.length,Ki.resolve()}Cr(t,e){return this.br(t)}br(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}Sr(t){const e=this.br(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class Lu{constructor(t){this.vr=t,this.docs=new ao(Vi.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,r=this.docs.get(n),s=r?r.size:0,i=this.vr(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:i}),this.size+=i-s,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return Ki.resolve(n?n.document.mutableCopy():$o.newInvalidDocument(e))}getEntries(t,e){let n=Ra();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():$o.newInvalidDocument(t))})),Ki.resolve(n)}getDocumentsMatchingQuery(t,e,n,r){let s=Ra();const i=e.path,o=new Vi(i.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!i.isPrefixOf(t.path))break;t.path.length>i.length+1||qi(Ui(o),n)<=0||(r.has(o.key)||Aa(e,o))&&(s=s.insert(o.key,o.mutableCopy()))}return Ki.resolve(s)}getAllFromCollectionGroup(t,e,n,r){pi()}Fr(t,e){return Ki.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new Ou(this)}getSize(t){return Ki.resolve(this.size)}}class Ou extends Iu{constructor(t){super(),this.ar=t}applyChanges(t){const e=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?e.push(this.ar.addEntry(t,r)):this.ar.removeEntry(n)})),Ki.waitFor(e)}getFromCache(t,e){return this.ar.getEntry(t,e)}getAllFromCache(t,e){return this.ar.getEntries(t,e)}}class Mu{constructor(t){this.persistence=t,this.Mr=new ka((t=>fa(t)),pa),this.lastRemoteSnapshotVersion=Li.min(),this.highestTargetId=0,this.Or=0,this.Nr=new ku,this.targetCount=0,this.Lr=Su.Nn()}forEachTarget(t,e){return this.Mr.forEach(((t,n)=>e(n))),Ki.resolve()}getLastRemoteSnapshotVersion(t){return Ki.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Ki.resolve(this.Or)}allocateTargetId(t){return this.highestTargetId=this.Lr.next(),Ki.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Or&&(this.Or=e),Ki.resolve()}qn(t){this.Mr.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Lr=new Su(e),this.highestTargetId=e),t.sequenceNumber>this.Or&&(this.Or=t.sequenceNumber)}addTargetData(t,e){return this.qn(e),this.targetCount+=1,Ki.resolve()}updateTargetData(t,e){return this.qn(e),Ki.resolve()}removeTargetData(t,e){return this.Mr.delete(e.target),this.Nr.Vr(e.targetId),this.targetCount-=1,Ki.resolve()}removeTargets(t,e,n){let r=0;const s=[];return this.Mr.forEach(((i,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Mr.delete(i),s.push(this.removeMatchingKeysForTargetId(t,o.targetId)),r++)})),Ki.waitFor(s).next((()=>r))}getTargetCount(t){return Ki.resolve(this.targetCount)}getTargetData(t,e){const n=this.Mr.get(e)||null;return Ki.resolve(n)}addMatchingKeys(t,e,n){return this.Nr.dr(e,n),Ki.resolve()}removeMatchingKeys(t,e,n){this.Nr.Rr(e,n);const r=this.persistence.referenceDelegate,s=[];return r&&e.forEach((e=>{s.push(r.markPotentiallyOrphaned(t,e))})),Ki.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.Nr.Vr(e),Ki.resolve()}getMatchingKeysForTargetId(t,e){const n=this.Nr.gr(e);return Ki.resolve(n)}containsKey(t,e){return Ki.resolve(this.Nr.containsKey(e))}}class Pu{constructor(t,e){this.Br={},this.overlays={},this.kr=new eo(0),this.qr=!1,this.qr=!0,this.referenceDelegate=t(this),this.Qr=new Mu(this),this.indexManager=new Eu,this.remoteDocumentCache=function(t){return new Lu(t)}((t=>this.referenceDelegate.Kr(t))),this.serializer=new vu(e),this.$r=new Du(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new xu,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.Br[t.toKey()];return n||(n=new Ru(e,this.referenceDelegate),this.Br[t.toKey()]=n),n}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(t,e,n){li("MemoryPersistence","Starting transaction:",t);const r=new Fu(this.kr.next());return this.referenceDelegate.Ur(),n(r).next((t=>this.referenceDelegate.Wr(r).next((()=>t)))).toPromise().then((t=>(r.raiseOnCommittedEvent(),t)))}Gr(t,e){return Ki.or(Object.values(this.Br).map((n=>()=>n.containsKey(t,e))))}}class Fu extends $i{constructor(t){super(),this.currentSequenceNumber=t}}class Vu{constructor(t){this.persistence=t,this.zr=new ku,this.jr=null}static Hr(t){return new Vu(t)}get Jr(){if(this.jr)return this.jr;throw pi()}addReference(t,e,n){return this.zr.addReference(n,e),this.Jr.delete(n.toString()),Ki.resolve()}removeReference(t,e,n){return this.zr.removeReference(n,e),this.Jr.add(n.toString()),Ki.resolve()}markPotentiallyOrphaned(t,e){return this.Jr.add(e.toString()),Ki.resolve()}removeTarget(t,e){this.zr.Vr(e.targetId).forEach((t=>this.Jr.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.Jr.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Ur(){this.jr=new Set}Wr(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ki.forEach(this.Jr,(n=>{const r=Vi.fromPath(n);return this.Yr(t,r).next((t=>{t||e.removeEntry(r,Li.min())}))})).next((()=>(this.jr=null,e.apply(t))))}updateLimboDocument(t,e){return this.Yr(t,e).next((t=>{t?this.Jr.delete(e.toString()):this.Jr.add(e.toString())}))}Kr(t){return 0}Yr(t,e){return Ki.or([()=>Ki.resolve(this.zr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Gr(t,e)])}}class Uu{constructor(t,e,n,r){this.targetId=t,this.fromCache=e,this.qi=n,this.Qi=r}static Ki(t,e){let n=qa(),r=qa();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:r=r.add(t.doc.key)}return new Uu(t,e.fromCache,n,r)}}class Bu{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class qu{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=!function(){var t;const e=null===(t=i())||void 0===t?void 0:t.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(t){return!1}}()&&navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")?8:Hi.v(c())>0?6:4}initialize(t,e){this.zi=t,this.indexManager=e,this.$i=!0}getDocumentsMatchingQuery(t,e,n,r){const s={result:null};return this.ji(t,e).next((t=>{s.result=t})).next((()=>{if(!s.result)return this.Hi(t,e,r,n).next((t=>{s.result=t}))})).next((()=>{if(s.result)return;const n=new Bu;return this.Ji(t,e,n).next((r=>{if(s.result=r,this.Ui)return this.Yi(t,e,n,r.size)}))})).next((()=>s.result))}Yi(t,e,n,r){return n.documentReadCount<this.Wi?(ui()<=E.DEBUG&&li("QueryEngine","SDK will not create cache indexes for query:",Ca(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),Ki.resolve()):(ui()<=E.DEBUG&&li("QueryEngine","Query:",Ca(e),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Gi*r?(ui()<=E.DEBUG&&li("QueryEngine","The SDK decides to create cache indexes for query:",Ca(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Ea(e))):Ki.resolve())}ji(t,e){if(va(e))return Ki.resolve(null);let n=Ea(e);return this.indexManager.getIndexType(t,n).next((r=>0===r?null:(null!==e.limit&&1===r&&(e=Ta(e,null,"F"),n=Ea(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((r=>{const s=qa(...r);return this.zi.getDocuments(t,s).next((r=>this.indexManager.getMinOffset(t,n).next((n=>{const i=this.Zi(e,r);return this.Xi(e,i,s,n.readTime)?this.ji(t,Ta(e,null,"F")):this.es(t,i,e,n)}))))})))))}Hi(t,e,n,r){return va(e)||r.isEqual(Li.min())?Ki.resolve(null):this.zi.getDocuments(t,n).next((s=>{const i=this.Zi(e,s);return this.Xi(e,i,n,r)?Ki.resolve(null):(ui()<=E.DEBUG&&li("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Ca(e)),this.es(t,i,e,function(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=Li.fromTimestamp(1e9===r?new Ri(n+1,0):new Ri(n,r));return new Bi(s,Vi.empty(),e)}(r,-1)).next((t=>t)))}))}Zi(t,e){let n=new lo(Da(t));return e.forEach(((e,r)=>{Aa(t,r)&&(n=n.add(r))})),n}Xi(t,e,n,r){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const s="F"===t.limitType?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Ji(t,e,n){return ui()<=E.DEBUG&&li("QueryEngine","Using full collection scan to execute query:",Ca(e)),this.zi.getDocumentsMatchingQuery(t,e,Bi.min(),n)}es(t,e,n,r){return this.zi.getDocumentsMatchingQuery(t,n,r).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class ju{constructor(t,e,n,r){this.persistence=t,this.ts=e,this.serializer=r,this.ns=new ao(ki),this.rs=new ka((t=>fa(t)),pa),this.ss=new Map,this.os=t.getRemoteDocumentCache(),this.Qr=t.getTargetCache(),this.$r=t.getBundleCache(),this._s(n)}_s(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Au(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.ns)))}}async function $u(t,e){const n=mi(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let r;return n.mutationQueue.getAllMutationBatches(t).next((s=>(r=s,n._s(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const s=[],i=[];let o=qa();for(const t of r){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({us:t,removedBatchIds:s,addedBatchIds:i})))}))}))}function zu(t){const e=mi(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Qr.getLastRemoteSnapshotVersion(t)))}function Ku(t,e){const n=mi(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e))))}async function Gu(t,e,n){const r=mi(t),s=r.ns.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,(t=>r.persistence.referenceDelegate.removeTarget(t,s)))}catch(t){if(!Yi(t))throw t;li("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}r.ns=r.ns.remove(e),r.rs.delete(s.target)}function Hu(t,e,n){const r=mi(t);let s=Li.min(),i=qa();return r.persistence.runTransaction("Execute query","readwrite",(t=>function(t,e,n){const r=mi(t),s=r.rs.get(n);return void 0!==s?Ki.resolve(r.ns.get(s)):r.Qr.getTargetData(e,n)}(r,t,Ea(e)).next((e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(t,e.targetId).next((t=>{i=t}))})).next((()=>r.ts.getDocumentsMatchingQuery(t,e,n?s:Li.min(),n?i:qa()))).next((t=>(function(t,e,n){let r=t.ss.get(e)||Li.min();n.forEach(((t,e)=>{e.readTime.compareTo(r)>0&&(r=e.readTime)})),t.ss.set(e,r)}(r,function(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}(e),t),{documents:t,hs:i})))))}class Qu{constructor(){this.activeTargetIds=ja}As(t){this.activeTargetIds=this.activeTargetIds.add(t)}Rs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}ds(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Wu{constructor(){this.no=new Qu,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.no.As(t),this.ro[t]||"not-current"}updateQueryState(t,e,n){this.ro[t]=e}removeLocalQueryTarget(t){this.no.Rs(t)}isLocalQueryTarget(t){return this.no.activeTargetIds.has(t)}clearQueryState(t){delete this.ro[t]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(t){return this.no.activeTargetIds.has(t)}start(){return this.no=new Qu,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class Yu{io(t){}shutdown(){}}class Xu{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(t){this.uo.push(t)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){li("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.uo)t(0)}ao(){li("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.uo)t(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Ju=null;function Zu(){return null===Ju?Ju=268435456+Math.round(2147483648*Math.random()):Ju++,"0x"+Ju.toString(16)}const tl={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class el{constructor(t){this.lo=t.lo,this.ho=t.ho}Po(t){this.Io=t}To(t){this.Eo=t}onMessage(t){this.Ao=t}close(){this.ho()}send(t){this.lo(t)}Ro(){this.Io()}Vo(t){this.Eo(t)}mo(t){this.Ao(t)}}const nl="WebChannelConnection";class rl extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.fo=e+"://"+t.host,this.po=`projects/${n}/databases/${r}`,this.yo="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${r}`}get wo(){return!1}So(t,e,n,r,s){const i=Zu(),o=this.bo(t,e.toUriEncodedString());li("RestConnection",`Sending RPC '${t}' ${i}:`,o,n);const a={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(a,r,s),this.Co(t,o,a,n).then((e=>(li("RestConnection",`Received RPC '${t}' ${i}: `,e),e)),(e=>{throw di("RestConnection",`RPC '${t}' ${i} failed with error: `,e,"url: ",o,"request:",n),e}))}vo(t,e,n,r,s,i){return this.So(t,e,n,r,s)}Do(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+ai,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}bo(t,e){const n=tl[t];return`${this.fo}/v1/${e}:${n}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Co(t,e,n,r){const s=Zu();return new Promise(((i,o)=>{const a=new ni;a.setWithCredentials(!0),a.listenOnce(Js.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case Xs.NO_ERROR:const e=a.getResponseJson();li(nl,`XHR for RPC '${t}' ${s} received:`,JSON.stringify(e)),i(e);break;case Xs.TIMEOUT:li(nl,`RPC '${t}' ${s} timed out`),o(new vi(yi.DEADLINE_EXCEEDED,"Request time out"));break;case Xs.HTTP_ERROR:const n=a.getStatus();if(li(nl,`RPC '${t}' ${s} failed with status:`,n,"response text:",a.getResponseText()),n>0){let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=null==t?void 0:t.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(yi).indexOf(e)>=0?e:yi.UNKNOWN}(e.status);o(new vi(t,e.message))}else o(new vi(yi.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new vi(yi.UNAVAILABLE,"Connection failed."));break;default:pi()}}finally{li(nl,`RPC '${t}' ${s} completed.`)}}));const c=JSON.stringify(r);li(nl,`RPC '${t}' ${s} sending request:`,r),a.send(e,"POST",c,n,15)}))}Fo(t,e,n){const r=Zu(),s=[this.fo,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=Ws(),o=Ys(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Do(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const u=s.join("");li(nl,`Creating RPC '${t}' stream ${r}: ${u}`,a);const l=i.createWebChannel(u,a);let h=!1,d=!1;const f=new el({lo:e=>{d?li(nl,`Not sending because RPC '${t}' stream ${r} is closed:`,e):(h||(li(nl,`Opening RPC '${t}' stream ${r} transport.`),l.open(),h=!0),li(nl,`RPC '${t}' stream ${r} sending:`,e),l.send(e))},ho:()=>l.close()}),p=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return p(l,ei.EventType.OPEN,(()=>{d||li(nl,`RPC '${t}' stream ${r} transport opened.`)})),p(l,ei.EventType.CLOSE,(()=>{d||(d=!0,li(nl,`RPC '${t}' stream ${r} transport closed`),f.Vo())})),p(l,ei.EventType.ERROR,(e=>{d||(d=!0,di(nl,`RPC '${t}' stream ${r} transport errored:`,e),f.Vo(new vi(yi.UNAVAILABLE,"The operation could not be completed")))})),p(l,ei.EventType.MESSAGE,(e=>{var n;if(!d){const s=e.data[0];gi(!!s);const i=s,o=i.error||(null===(n=i[0])||void 0===n?void 0:n.error);if(o){li(nl,`RPC '${t}' stream ${r} received error:`,o);const e=o.status;let n=function(t){const e=Sc[t];if(void 0!==e)return Cc(e)}(e),s=o.message;void 0===n&&(n=yi.INTERNAL,s="Unknown error status: "+e+" with message "+o.message),d=!0,f.Vo(new vi(n,s)),l.close()}else li(nl,`RPC '${t}' stream ${r} received:`,s),f.mo(s)}})),p(o,Zs.STAT_EVENT,(e=>{e.stat===ti.PROXY?li(nl,`RPC '${t}' stream ${r} detected buffering proxy`):e.stat===ti.NOPROXY&&li(nl,`RPC '${t}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{f.Ro()}),0),f}}function sl(){return"undefined"!=typeof document?document:null}function il(t){return new zc(t,!0)}class ol{constructor(t,e,n=1e3,r=1.5,s=6e4){this.oi=t,this.timerId=e,this.Mo=n,this.xo=r,this.Oo=s,this.No=0,this.Lo=null,this.Bo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(t){this.cancel();const e=Math.floor(this.No+this.Qo()),n=Math.max(0,Date.now()-this.Bo),r=Math.max(0,e-n);r>0&&li("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.No} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Lo=this.oi.enqueueAfterDelay(this.timerId,r,(()=>(this.Bo=Date.now(),t()))),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){null!==this.Lo&&(this.Lo.skipDelay(),this.Lo=null)}cancel(){null!==this.Lo&&(this.Lo.cancel(),this.Lo=null)}Qo(){return(Math.random()-.5)*this.No}}class al{constructor(t,e,n,r,s,i,o,a){this.oi=t,this.$o=n,this.Uo=r,this.connection=s,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new ol(t,e)}Ho(){return 1===this.state||5===this.state||this.Jo()}Jo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Yo()}async stop(){this.Ho()&&await this.close(0)}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&null===this.Go&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,(()=>this.e_())))}t_(t){this.n_(),this.stream.send(t)}async e_(){if(this.Jo())return this.close(0)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}async close(t,e){this.n_(),this.r_(),this.jo.cancel(),this.Wo++,4!==t?this.jo.reset():e&&e.code===yi.RESOURCE_EXHAUSTED?(hi(e.toString()),hi("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):e&&e.code===yi.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.i_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.To(e)}i_(){}auth(){this.state=1;const t=this.s_(this.Wo),e=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.Wo===e&&this.o_(t,n)}),(e=>{t((()=>{const t=new vi(yi.UNKNOWN,"Fetching auth token failed: "+e.message);return this.__(t)}))}))}o_(t,e){const n=this.s_(this.Wo);this.stream=this.a_(t,e),this.stream.Po((()=>{n((()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,(()=>(this.Jo()&&(this.state=3),Promise.resolve()))),this.listener.Po())))})),this.stream.To((t=>{n((()=>this.__(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}Yo(){this.state=5,this.jo.qo((async()=>{this.state=0,this.start()}))}__(t){return li("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}s_(t){return e=>{this.oi.enqueueAndForget((()=>this.Wo===t?e():(li("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class cl extends al{constructor(t,e,n,r,s,i){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,r,i),this.serializer=s}a_(t,e){return this.connection.Fo("Listen",t,e)}onMessage(t){this.jo.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:pi()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(t,e){return t.useProto3Json?(gi(void 0===e||"string"==typeof e),go.fromBase64String(e||"")):(gi(void 0===e||e instanceof Uint8Array),go.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?yi.UNKNOWN:Cc(t.code);return new vi(e,t.message||"")}(o);n=new Pc(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=tu(t,r.document.name),i=Wc(r.document.updateTime),o=r.document.createTime?Wc(r.document.createTime):Li.min(),a=new qo({mapValue:{fields:r.document.fields}}),c=$o.newFoundDocument(s,i,o,a),u=r.targetIds||[],l=r.removedTargetIds||[];n=new Oc(u,l,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=tu(t,r.document),i=r.readTime?Wc(r.readTime):Li.min(),o=$o.newNoDocument(s,i),a=r.removedTargetIds||[];n=new Oc([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=tu(t,r.document),i=r.removedTargetIds||[];n=new Oc([],i,s,null)}else{if(!("filter"in e))return pi();{e.filter;const t=e.filter;t.targetId;const{count:r=0,unchangedNames:s}=t,i=new Tc(r,s),o=t.targetId;n=new Mc(o,i)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return Li.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?Li.min():e.readTime?Wc(e.readTime):Li.min()}(t);return this.listener.u_(e,n)}c_(t){const e={};e.database=nu(this.serializer),e.addTarget=function(t,e){let n;const r=e.target;if(n=ga(r)?{documents:iu(t,r)}:{query:ou(t,r).ut},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=Hc(t,e.resumeToken);const r=Kc(t,e.expectedCount);null!==r&&(n.expectedCount=r)}else if(e.snapshotVersion.compareTo(Li.min())>0){n.readTime=Gc(t,e.snapshotVersion.toTimestamp());const r=Kc(t,e.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return pi()}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.t_(e)}l_(t){const e={};e.database=nu(this.serializer),e.removeTarget=t,this.t_(e)}}class ul extends al{constructor(t,e,n,r,s,i){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,r,i),this.serializer=s,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(t,e){return this.connection.Fo("Write",t,e)}onMessage(t){if(gi(!!t.streamToken),this.lastStreamToken=t.streamToken,this.h_){this.jo.reset();const e=function(t,e){return t&&t.length>0?(gi(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?Wc(t.updateTime):Wc(e);return n.isEqual(Li.min())&&(n=Wc(e)),new sc(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=Wc(t.commitTime);return this.listener.T_(n,e)}return gi(!t.writeResults||0===t.writeResults.length),this.h_=!0,this.listener.E_()}d_(){const t={};t.database=nu(this.serializer),this.t_(t)}I_(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>function(t,e){let n;if(e instanceof fc)n={update:su(t,e.key,e.value)};else if(e instanceof vc)n={delete:Zc(t,e.key)};else if(e instanceof pc)n={update:su(t,e.key,e.data),updateMask:gu(e.fieldMask)};else{if(!(e instanceof wc))return pi();n={verify:Zc(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof Ya)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Xa)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Za)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof ec)return{fieldPath:e.field.canonicalString(),increment:n.Ie};throw pi()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Qc(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:pi()}(t,e.precondition)),n}(this.serializer,t)))};this.t_(e)}}class ll extends class{}{constructor(t,e,n,r){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=r,this.A_=!1}R_(){if(this.A_)throw new vi(yi.FAILED_PRECONDITION,"The client has already been terminated.")}So(t,e,n,r){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,i])=>this.connection.So(t,Xc(e,n),r,s,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===yi.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new vi(yi.UNKNOWN,t.toString())}))}vo(t,e,n,r,s){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,o])=>this.connection.vo(t,Xc(e,n),r,i,o,s))).catch((t=>{throw"FirebaseError"===t.name?(t.code===yi.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new vi(yi.UNKNOWN,t.toString())}))}terminate(){this.A_=!0,this.connection.terminate()}}class hl{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){0===this.m_&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve()))))}S_(t){"Online"===this.state?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.y_("Offline")))}set(t){this.b_(),this.m_=0,"Online"===t&&(this.g_=!1),this.y_(t)}y_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}w_(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(hi(e),this.g_=!1):li("OnlineStateTracker",e)}b_(){null!==this.f_&&(this.f_.cancel(),this.f_=null)}}class dl{constructor(t,e,n,r,s){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=s,this.M_.io((t=>{n.enqueueAndForget((async()=>{El(this)&&(li("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=mi(t);e.v_.add(4),await pl(e),e.x_.set("Unknown"),e.v_.delete(4),await fl(e)}(this))}))})),this.x_=new hl(n,r)}}async function fl(t){if(El(t))for(const e of t.F_)await e(!0)}async function pl(t){for(const e of t.F_)await e(!1)}function gl(t,e){const n=mi(t);n.C_.has(e.targetId)||(n.C_.set(e.targetId,e),bl(n)?wl(n):Vl(n).Jo()&&yl(n,e))}function ml(t,e){const n=mi(t),r=Vl(n);n.C_.delete(e),r.Jo()&&vl(n,e),0===n.C_.size&&(r.Jo()?r.Xo():El(n)&&n.x_.set("Unknown"))}function yl(t,e){if(t.O_.Oe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Li.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Vl(t).c_(e)}function vl(t,e){t.O_.Oe(e),Vl(t).l_(e)}function wl(t){t.O_=new Vc({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),_t:e=>t.C_.get(e)||null,nt:()=>t.datastore.serializer.databaseId}),Vl(t).start(),t.x_.p_()}function bl(t){return El(t)&&!Vl(t).Ho()&&t.C_.size>0}function El(t){return 0===mi(t).v_.size}function _l(t){t.O_=void 0}async function Tl(t){t.C_.forEach(((e,n)=>{yl(t,e)}))}async function Sl(t,e){_l(t),bl(t)?(t.x_.S_(e),wl(t)):t.x_.set("Unknown")}async function Il(t,e,n){if(t.x_.set("Online"),e instanceof Pc&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const r of e.targetIds)t.C_.has(r)&&(await t.remoteSyncer.rejectListen(r,n),t.C_.delete(r),t.O_.removeTarget(r))}(t,e)}catch(n){li("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Cl(t,n)}else if(e instanceof Oc?t.O_.$e(e):e instanceof Mc?t.O_.Je(e):t.O_.Ge(e),!n.isEqual(Li.min()))try{const e=await zu(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.O_.it(e);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const s=t.C_.get(r);s&&t.C_.set(r,s.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach(((e,n)=>{const r=t.C_.get(e);if(!r)return;t.C_.set(e,r.withResumeToken(go.EMPTY_BYTE_STRING,r.snapshotVersion)),vl(t,e);const s=new yu(r.target,e,n,r.sequenceNumber);yl(t,s)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){li("RemoteStore","Failed to raise snapshot:",e),await Cl(t,e)}}async function Cl(t,e,n){if(!Yi(e))throw e;t.v_.add(1),await pl(t),t.x_.set("Offline"),n||(n=()=>zu(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{li("RemoteStore","Retrying IndexedDB access"),await n(),t.v_.delete(1),await fl(t)}))}function Al(t,e){return e().catch((n=>Cl(t,n,e)))}async function Dl(t){const e=mi(t),n=Ul(e);let r=e.D_.length>0?e.D_[e.D_.length-1].batchId:-1;for(;xl(e);)try{const t=await Ku(e.localStore,r);if(null===t){0===e.D_.length&&n.Xo();break}r=t.batchId,kl(e,t)}catch(t){await Cl(e,t)}Nl(e)&&Rl(e)}function xl(t){return El(t)&&t.D_.length<10}function kl(t,e){t.D_.push(e);const n=Ul(t);n.Jo()&&n.P_&&n.I_(e.mutations)}function Nl(t){return El(t)&&!Ul(t).Ho()&&t.D_.length>0}function Rl(t){Ul(t).start()}async function Ll(t){Ul(t).d_()}async function Ol(t){const e=Ul(t);for(const n of t.D_)e.I_(n.mutations)}async function Ml(t,e,n){const r=t.D_.shift(),s=Ec.from(r,e,n);await Al(t,(()=>t.remoteSyncer.applySuccessfulWrite(s))),await Dl(t)}async function Pl(t,e){e&&Ul(t).P_&&await async function(t,e){if(function(t){return function(t){switch(t){default:return pi();case yi.CANCELLED:case yi.UNKNOWN:case yi.DEADLINE_EXCEEDED:case yi.RESOURCE_EXHAUSTED:case yi.INTERNAL:case yi.UNAVAILABLE:case yi.UNAUTHENTICATED:return!1;case yi.INVALID_ARGUMENT:case yi.NOT_FOUND:case yi.ALREADY_EXISTS:case yi.PERMISSION_DENIED:case yi.FAILED_PRECONDITION:case yi.ABORTED:case yi.OUT_OF_RANGE:case yi.UNIMPLEMENTED:case yi.DATA_LOSS:return!0}}(t)&&t!==yi.ABORTED}(e.code)){const n=t.D_.shift();Ul(t).Zo(),await Al(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await Dl(t)}}(t,e),Nl(t)&&Rl(t)}async function Fl(t,e){const n=mi(t);n.asyncQueue.verifyOperationInProgress(),li("RemoteStore","RemoteStore received new credentials");const r=El(n);n.v_.add(3),await pl(n),r&&n.x_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.v_.delete(3),await fl(n)}function Vl(t){return t.N_||(t.N_=function(t,e,n){const r=mi(t);return r.R_(),new cl(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{Po:Tl.bind(null,t),To:Sl.bind(null,t),u_:Il.bind(null,t)}),t.F_.push((async e=>{e?(t.N_.Zo(),bl(t)?wl(t):t.x_.set("Unknown")):(await t.N_.stop(),_l(t))}))),t.N_}function Ul(t){return t.L_||(t.L_=function(t,e,n){const r=mi(t);return r.R_(),new ul(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{Po:Ll.bind(null,t),To:Pl.bind(null,t),E_:Ol.bind(null,t),T_:Ml.bind(null,t)}),t.F_.push((async e=>{e?(t.L_.Zo(),await Dl(t)):(await t.L_.stop(),t.D_.length>0&&(li("RemoteStore",`Stopping write stream with ${t.D_.length} pending writes`),t.D_=[]))}))),t.L_}class Bl{constructor(t,e,n,r,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new wi,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,r,s){const i=Date.now()+n,o=new Bl(t,e,i,r,s);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new vi(yi.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ql(t,e){if(hi("AsyncQueue",`${e}: ${t}`),Yi(t))return new vi(yi.UNAVAILABLE,`${e}: ${t}`);throw t}class jl{constructor(t){this.comparator=t?(e,n)=>t(e,n)||Vi.comparator(e.key,n.key):(t,e)=>Vi.comparator(t.key,e.key),this.keyedMap=Oa(),this.sortedSet=new ao(this.comparator)}static emptySet(t){return new jl(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof jl))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(!t.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new jl;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class $l{constructor(){this.B_=new ao(Vi.comparator)}track(t){const e=t.doc.key,n=this.B_.get(e);n?0!==t.type&&3===n.type?this.B_=this.B_.insert(e,t):3===t.type&&1!==n.type?this.B_=this.B_.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.B_=this.B_.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.B_=this.B_.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.B_=this.B_.remove(e):1===t.type&&2===n.type?this.B_=this.B_.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.B_=this.B_.insert(e,{type:2,doc:t.doc}):pi():this.B_=this.B_.insert(e,t)}k_(){const t=[];return this.B_.inorderTraversal(((e,n)=>{t.push(n)})),t}}class zl{constructor(t,e,n,r,s,i,o,a,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(t,e,n,r,s){const i=[];return e.forEach((t=>{i.push({type:0,doc:t})})),new zl(t,e,jl.emptySet(e),i,n,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Sa(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class Kl{constructor(){this.q_=void 0,this.Q_=[]}K_(){return this.Q_.some((t=>t.U_()))}}class Gl{constructor(){this.queries=new ka((t=>Ia(t)),Sa),this.onlineState="Unknown",this.W_=new Set}}function Hl(t,e){const n=mi(t);let r=!1;for(const t of e){const e=t.query,s=n.queries.get(e);if(s){for(const e of s.Q_)e.z_(t)&&(r=!0);s.q_=t}}r&&Wl(n)}function Ql(t,e,n){const r=mi(t),s=r.queries.get(e);if(s)for(const t of s.Q_)t.onError(n);r.queries.delete(e)}function Wl(t){t.W_.forEach((t=>{t.next()}))}var Yl,Xl;(Xl=Yl||(Yl={})).j_="default",Xl.Cache="cache";class Jl{constructor(t,e,n){this.query=t,this.H_=e,this.J_=!1,this.Y_=null,this.onlineState="Unknown",this.options=n||{}}z_(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new zl(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.J_?this.Z_(t)&&(this.H_.next(t),e=!0):this.X_(t,this.onlineState)&&(this.ea(t),e=!0),this.Y_=t,e}onError(t){this.H_.error(t)}G_(t){this.onlineState=t;let e=!1;return this.Y_&&!this.J_&&this.X_(this.Y_,t)&&(this.ea(this.Y_),e=!0),e}X_(t,e){if(!t.fromCache)return!0;if(!this.U_())return!0;const n="Offline"!==e;return(!this.options.ta||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}Z_(t){if(t.docChanges.length>0)return!0;const e=this.Y_&&this.Y_.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}ea(t){t=zl.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.J_=!0,this.H_.next(t)}U_(){return this.options.source!==Yl.Cache}}class Zl{constructor(t){this.key=t}}class th{constructor(t){this.key=t}}class eh{constructor(t,e){this.query=t,this.ua=e,this.ca=null,this.hasCachedResults=!1,this.current=!1,this.la=qa(),this.mutatedKeys=qa(),this.ha=Da(t),this.Pa=new jl(this.ha)}get Ia(){return this.ua}Ta(t,e){const n=e?e.Ea:new $l,r=e?e.Pa:this.Pa;let s=e?e.mutatedKeys:this.mutatedKeys,i=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal(((t,e)=>{const u=r.get(t),l=Aa(this.query,e)?e:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.da(u,l)||(n.track({type:2,doc:l}),f=!0,(a&&this.ha(l,a)>0||c&&this.ha(l,c)<0)&&(o=!0)):!u&&l?(n.track({type:0,doc:l}),f=!0):u&&!l&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(l?(i=i.add(l),s=d?s.add(t):s.delete(t)):(i=i.delete(t),s=s.delete(t)))})),null!==this.query.limit)for(;i.size>this.query.limit;){const t="F"===this.query.limitType?i.last():i.first();i=i.delete(t.key),s=s.delete(t.key),n.track({type:1,doc:t})}return{Pa:i,Ea:n,Xi:o,mutatedKeys:s}}da(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,r){const s=this.Pa;this.Pa=t.Pa,this.mutatedKeys=t.mutatedKeys;const i=t.Ea.k_();i.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return pi()}};return n(t)-n(e)}(t.type,e.type)||this.ha(t.doc,e.doc))),this.Aa(n),r=null!=r&&r;const o=e&&!r?this.Ra():[],a=0===this.la.size&&this.current&&!r?1:0,c=a!==this.ca;return this.ca=a,0!==i.length||c?{snapshot:new zl(this.query,t.Pa,s,i,t.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),Va:o}:{Va:o}}G_(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Pa:this.Pa,Ea:new $l,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{Va:[]}}ma(t){return!this.ua.has(t)&&!!this.Pa.has(t)&&!this.Pa.get(t).hasLocalMutations}Aa(t){t&&(t.addedDocuments.forEach((t=>this.ua=this.ua.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.ua=this.ua.delete(t))),this.current=t.current)}Ra(){if(!this.current)return[];const t=this.la;this.la=qa(),this.Pa.forEach((t=>{this.ma(t.key)&&(this.la=this.la.add(t.key))}));const e=[];return t.forEach((t=>{this.la.has(t)||e.push(new th(t))})),this.la.forEach((n=>{t.has(n)||e.push(new Zl(n))})),e}fa(t){this.ua=t.hs,this.la=qa();const e=this.Ta(t.documents);return this.applyChanges(e,!0)}ga(){return zl.fromInitialDocuments(this.query,this.Pa,this.mutatedKeys,0===this.ca,this.hasCachedResults)}}class nh{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class rh{constructor(t){this.key=t,this.pa=!1}}class sh{constructor(t,e,n,r,s,i){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.ya={},this.wa=new ka((t=>Ia(t)),Sa),this.Sa=new Map,this.ba=new Set,this.Da=new ao(Vi.comparator),this.Ca=new Map,this.va=new ku,this.Fa={},this.Ma=new Map,this.xa=Su.Ln(),this.onlineState="Unknown",this.Oa=void 0}get isPrimaryClient(){return!0===this.Oa}}async function ih(t,e,n=!0){const r=Ih(t);let s;const i=r.wa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.ga()):s=await ah(r,e,n,!0),s}async function oh(t,e){const n=Ih(t);await ah(n,e,!0,!1)}async function ah(t,e,n,r){const s=await function(t,e){const n=mi(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let r;return n.Qr.getTargetData(t,e).next((s=>s?(r=s,Ki.resolve(r)):n.Qr.allocateTargetId(t).next((s=>(r=new yu(e,s,"TargetPurposeListen",t.currentSequenceNumber),n.Qr.addTargetData(t,r).next((()=>r)))))))})).then((t=>{const r=n.ns.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.ns=n.ns.insert(t.targetId,t),n.rs.set(e,t.targetId)),t}))}(t.localStore,Ea(e)),i=s.targetId,o=n?t.sharedClientState.addLocalQueryTarget(i):"not-current";let a;return r&&(a=await async function(t,e,n,r,s){t.Na=(e,n,r)=>async function(t,e,n,r){let s=e.view.Ta(n);s.Xi&&(s=await Hu(t.localStore,e.query,!1).then((({documents:t})=>e.view.Ta(t,s))));const i=r&&r.targetChanges.get(e.targetId),o=r&&null!=r.targetMismatches.get(e.targetId),a=e.view.applyChanges(s,t.isPrimaryClient,i,o);return wh(t,e.targetId,a.Va),a.snapshot}(t,e,n,r);const i=await Hu(t.localStore,e,!0),o=new eh(e,i.hs),a=o.Ta(i.documents),c=Lc.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState,s),u=o.applyChanges(a,t.isPrimaryClient,c);wh(t,n,u.Va);const l=new nh(e,n,o);return t.wa.set(e,l),t.Sa.has(n)?t.Sa.get(n).push(e):t.Sa.set(n,[e]),u.snapshot}(t,e,i,"current"===o,s.resumeToken)),t.isPrimaryClient&&n&&gl(t.remoteStore,s),a}async function ch(t,e,n){const r=mi(t),s=r.wa.get(e),i=r.Sa.get(s.targetId);if(i.length>1)return r.Sa.set(s.targetId,i.filter((t=>!Sa(t,e)))),void r.wa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Gu(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),n&&ml(r.remoteStore,s.targetId),yh(r,s.targetId)})).catch(zi)):(yh(r,s.targetId),await Gu(r.localStore,s.targetId,!0))}async function uh(t,e){const n=mi(t),r=n.wa.get(e),s=n.Sa.get(r.targetId);n.isPrimaryClient&&1===s.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),ml(n.remoteStore,r.targetId))}async function lh(t,e){const n=mi(t);try{const t=await function(t,e){const n=mi(t),r=e.snapshotVersion;let s=n.ns;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const i=n.os.newChangeBuffer({trackRemovals:!0});s=n.ns;const o=[];e.targetChanges.forEach(((i,a)=>{const c=s.get(a);if(!c)return;o.push(n.Qr.removeMatchingKeys(t,i.removedDocuments,a).next((()=>n.Qr.addMatchingKeys(t,i.addedDocuments,a))));let u=c.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(a)?u=u.withResumeToken(go.EMPTY_BYTE_STRING,Li.min()).withLastLimboFreeSnapshotVersion(Li.min()):i.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(i.resumeToken,r)),s=s.insert(a,u),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,i)&&o.push(n.Qr.updateTargetData(t,u))}));let a=Ra(),c=qa();if(e.documentUpdates.forEach((r=>{e.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),o.push(function(t,e,n){let r=qa(),s=qa();return n.forEach((t=>r=r.add(t))),e.getEntries(t,r).next((t=>{let r=Ra();return n.forEach(((n,i)=>{const o=t.get(n);i.isFoundDocument()!==o.isFoundDocument()&&(s=s.add(n)),i.isNoDocument()&&i.version.isEqual(Li.min())?(e.removeEntry(n,i.readTime),r=r.insert(n,i)):!o.isValidDocument()||i.version.compareTo(o.version)>0||0===i.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(i),r=r.insert(n,i)):li("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",i.version)})),{cs:r,ls:s}}))}(t,i,e.documentUpdates).next((t=>{a=t.cs,c=t.ls}))),!r.isEqual(Li.min())){const e=n.Qr.getLastRemoteSnapshotVersion(t).next((e=>n.Qr.setTargetsMetadata(t,t.currentSequenceNumber,r)));o.push(e)}return Ki.waitFor(o).next((()=>i.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,a,c))).next((()=>a))})).then((t=>(n.ns=s,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const r=n.Ca.get(e);r&&(gi(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.pa=!0:t.modifiedDocuments.size>0?gi(r.pa):t.removedDocuments.size>0&&(gi(r.pa),r.pa=!1))})),await _h(n,t,e)}catch(t){await zi(t)}}function hh(t,e,n){const r=mi(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const t=[];r.wa.forEach(((n,r)=>{const s=r.view.G_(e);s.snapshot&&t.push(s.snapshot)})),function(t,e){const n=mi(t);n.onlineState=e;let r=!1;n.queries.forEach(((t,n)=>{for(const t of n.Q_)t.G_(e)&&(r=!0)})),r&&Wl(n)}(r.eventManager,e),t.length&&r.ya.u_(t),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function dh(t,e,n){const r=mi(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.Ca.get(e),i=s&&s.key;if(i){let t=new ao(Vi.comparator);t=t.insert(i,$o.newNoDocument(i,Li.min()));const n=qa().add(i),s=new Rc(Li.min(),new Map,new ao(ki),t,n);await lh(r,s),r.Da=r.Da.remove(i),r.Ca.delete(e),Eh(r)}else await Gu(r.localStore,e,!1).then((()=>yh(r,e,n))).catch(zi)}async function fh(t,e){const n=mi(t),r=e.batch.batchId;try{const t=await function(t,e){const n=mi(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const r=e.batch.keys(),s=n.os.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){const s=n.batch,i=s.keys();let o=Ki.resolve();return i.forEach((t=>{o=o.next((()=>r.getEntry(e,t))).next((e=>{const i=n.docVersions.get(t);gi(null!==i),e.version.compareTo(i)<0&&(s.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),r.addEntry(e)))}))})),o.next((()=>t.mutationQueue.removeMutationBatch(e,s)))}(n,t,e,s).next((()=>s.apply(t))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,function(t){let e=qa();for(let n=0;n<t.mutationResults.length;++n)t.mutationResults[n].transformResults.length>0&&(e=e.add(t.batch.mutations[n].key));return e}(e)))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(n.localStore,e);mh(n,r,null),gh(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await _h(n,t)}catch(t){await zi(t)}}async function ph(t,e,n){const r=mi(t);try{const t=await function(t,e){const n=mi(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let r;return n.mutationQueue.lookupMutationBatch(t,e).next((e=>(gi(null!==e),r=e.keys(),n.mutationQueue.removeMutationBatch(t,e)))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,r))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(r.localStore,e);mh(r,e,n),gh(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await _h(r,t)}catch(n){await zi(n)}}function gh(t,e){(t.Ma.get(e)||[]).forEach((t=>{t.resolve()})),t.Ma.delete(e)}function mh(t,e,n){const r=mi(t);let s=r.Fa[r.currentUser.toKey()];if(s){const t=s.get(e);t&&(n?t.reject(n):t.resolve(),s=s.remove(e)),r.Fa[r.currentUser.toKey()]=s}}function yh(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Sa.get(e))t.wa.delete(r),n&&t.ya.La(r,n);t.Sa.delete(e),t.isPrimaryClient&&t.va.Vr(e).forEach((e=>{t.va.containsKey(e)||vh(t,e)}))}function vh(t,e){t.ba.delete(e.path.canonicalString());const n=t.Da.get(e);null!==n&&(ml(t.remoteStore,n),t.Da=t.Da.remove(e),t.Ca.delete(n),Eh(t))}function wh(t,e,n){for(const r of n)r instanceof Zl?(t.va.addReference(r.key,e),bh(t,r)):r instanceof th?(li("SyncEngine","Document no longer in limbo: "+r.key),t.va.removeReference(r.key,e),t.va.containsKey(r.key)||vh(t,r.key)):pi()}function bh(t,e){const n=e.key,r=n.path.canonicalString();t.Da.get(n)||t.ba.has(r)||(li("SyncEngine","New document in limbo: "+n),t.ba.add(r),Eh(t))}function Eh(t){for(;t.ba.size>0&&t.Da.size<t.maxConcurrentLimboResolutions;){const e=t.ba.values().next().value;t.ba.delete(e);const n=new Vi(Mi.fromString(e)),r=t.xa.next();t.Ca.set(r,new rh(n)),t.Da=t.Da.insert(n,r),gl(t.remoteStore,new yu(Ea(ya(n.path)),r,"TargetPurposeLimboResolution",eo._e))}}async function _h(t,e,n){const r=mi(t),s=[],i=[],o=[];r.wa.isEmpty()||(r.wa.forEach(((t,a)=>{o.push(r.Na(a,e,n).then((t=>{if((t||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){s.push(t);const e=Uu.Ki(a.targetId,t);i.push(e)}})))})),await Promise.all(o),r.ya.u_(s),await async function(t,e){const n=mi(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>Ki.forEach(e,(e=>Ki.forEach(e.qi,(r=>n.persistence.referenceDelegate.addReference(t,e.targetId,r))).next((()=>Ki.forEach(e.Qi,(r=>n.persistence.referenceDelegate.removeReference(t,e.targetId,r)))))))))}catch(t){if(!Yi(t))throw t;li("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.ns.get(e),r=t.snapshotVersion,s=t.withLastLimboFreeSnapshotVersion(r);n.ns=n.ns.insert(e,s)}}}(r.localStore,i))}async function Th(t,e){const n=mi(t);if(!n.currentUser.isEqual(e)){li("SyncEngine","User change. New user:",e.toKey());const t=await $u(n.localStore,e);n.currentUser=e,function(t,e){t.Ma.forEach((t=>{t.forEach((t=>{t.reject(new vi(yi.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Ma.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await _h(n,t.us)}}function Sh(t,e){const n=mi(t),r=n.Ca.get(e);if(r&&r.pa)return qa().add(r.key);{let t=qa();const r=n.Sa.get(e);if(!r)return t;for(const e of r){const r=n.wa.get(e);t=t.unionWith(r.view.Ia)}return t}}function Ih(t){const e=mi(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=lh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Sh.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=dh.bind(null,e),e.ya.u_=Hl.bind(null,e.eventManager),e.ya.La=Ql.bind(null,e.eventManager),e}function Ch(t){const e=mi(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=fh.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=ph.bind(null,e),e}class Ah{constructor(){this.synchronizeTabs=!1}async initialize(t){this.serializer=il(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),await this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return function(t,e,n,r){return new ju(t,e,n,r)}(this.persistence,new qu,t.initialUser,this.serializer)}createPersistence(t){return new Pu(Vu.Hr,this.serializer)}createSharedClientState(t){return new Wu}async terminate(){var t,e;null===(t=this.gcScheduler)||void 0===t||t.stop(),null===(e=this.indexBackfillerScheduler)||void 0===e||e.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Dh{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>hh(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=Th.bind(null,this.syncEngine),await async function(t,e){const n=mi(t);e?(n.v_.delete(2),await fl(n)):e||(n.v_.add(2),await pl(n),n.x_.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new Gl}createDatastore(t){const e=il(t.databaseInfo.databaseId),n=function(t){return new rl(t)}(t.databaseInfo);return function(t,e,n,r){return new ll(t,e,n,r)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return function(t,e,n,r,s){return new dl(t,e,n,r,s)}(this.localStore,this.datastore,t.asyncQueue,(t=>hh(this.syncEngine,t,0)),Xu.D()?new Xu:new Yu)}createSyncEngine(t,e){return function(t,e,n,r,s,i,o){const a=new sh(t,e,n,r,s,i);return o&&(a.Oa=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){var t;await async function(t){const e=mi(t);li("RemoteStore","RemoteStore shutting down."),e.v_.add(5),await pl(e),e.M_.shutdown(),e.x_.set("Unknown")}(this.remoteStore),null===(t=this.datastore)||void 0===t||t.terminate()}}class xh{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.qa(this.observer.next,t)}error(t){this.observer.error?this.qa(this.observer.error,t):hi("Uncaught Error in snapshot listener:",t.toString())}Qa(){this.muted=!0}qa(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class kh{constructor(t,e,n,r){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=r,this.user=oi.UNAUTHENTICATED,this.clientId=xi.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{li("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(li("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new vi(yi.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new wi;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=ql(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function Nh(t,e){t.asyncQueue.verifyOperationInProgress(),li("FirestoreClient","Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async t=>{r.isEqual(t)||(await $u(e.localStore,t),r=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function Rh(t,e){t.asyncQueue.verifyOperationInProgress();const n=await async function(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){li("FirestoreClient","Using user provided OfflineComponentProvider");try{await Nh(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(t){return"FirebaseError"===t.name?t.code===yi.FAILED_PRECONDITION||t.code===yi.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(n))throw n;di("Error using user provided cache. Falling back to memory cache: "+n),await Nh(t,new Ah)}}else li("FirestoreClient","Using default OfflineComponentProvider"),await Nh(t,new Ah);return t._offlineComponents}(t);li("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((t=>Fl(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>Fl(e.remoteStore,n))),t._onlineComponents=e}async function Lh(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(li("FirestoreClient","Using user provided OnlineComponentProvider"),await Rh(t,t._uninitializedComponentsProvider._online)):(li("FirestoreClient","Using default OnlineComponentProvider"),await Rh(t,new Dh))),t._onlineComponents}async function Oh(t){const e=await Lh(t),n=e.eventManager;return n.onListen=ih.bind(null,e.syncEngine),n.onUnlisten=ch.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=oh.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=uh.bind(null,e.syncEngine),n}function Mh(t,e,n={}){const r=new wi;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,r,s){const i=new xh({next:n=>{e.enqueueAndForget((()=>async function(t,e){const n=mi(t),r=e.query;let s=3;const i=n.queries.get(r);if(i){const t=i.Q_.indexOf(e);t>=0&&(i.Q_.splice(t,1),0===i.Q_.length?s=e.U_()?0:1:!i.K_()&&e.U_()&&(s=2))}switch(s){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}(t,o))),n.fromCache&&"server"===r.source?s.reject(new vi(yi.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(n)},error:t=>s.reject(t)}),o=new Jl(n,i,{includeMetadataChanges:!0,ta:!0});return async function(t,e){const n=mi(t);let r=3;const s=e.query;let i=n.queries.get(s);i?!i.K_()&&e.U_()&&(r=2):(i=new Kl,r=e.U_()?0:1);try{switch(r){case 0:i.q_=await n.onListen(s,!0);break;case 1:i.q_=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(t){const n=ql(t,`Initialization of query '${Ca(e.query)}' failed`);return void e.onError(n)}n.queries.set(s,i),i.Q_.push(e),e.G_(n.onlineState),i.q_&&e.z_(i.q_)&&Wl(n)}(t,o)}(await Oh(t),t.asyncQueue,e,n,r))),r.promise}function Ph(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const Fh=new Map;function Vh(t,e,n){if(!n)throw new vi(yi.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function Uh(t){if(!Vi.isDocumentKey(t))throw new vi(yi.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Bh(t){if(Vi.isDocumentKey(t))throw new vi(yi.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function qh(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":pi()}function jh(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new vi(yi.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=qh(t);throw new vi(yi.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}class $h{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new vi(yi.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new vi(yi.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,r){if(!0===e&&!0===r)throw new vi(yi.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Ph(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new vi(yi.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new vi(yi.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new vi(yi.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(t,e){return t.timeoutSeconds===e.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class zh{constructor(t,e,n,r){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new $h({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new vi(yi.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new vi(yi.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new $h(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new Ei;switch(t.type){case"firstParty":return new Ii(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new vi(yi.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=Fh.get(t);e&&(li("ComponentProvider","Removing Datastore"),Fh.delete(t),e.terminate())}(this),Promise.resolve()}}class Kh{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new Kh(this.firestore,t,this._query)}}class Gh{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Hh(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Gh(this.firestore,t,this._key)}}class Hh extends Kh{constructor(t,e,n){super(t,e,ya(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Gh(this.firestore,null,new Vi(t))}withConverter(t){return new Hh(this.firestore,t,this._path)}}function Qh(t,e,...n){if(t=g(t),Vh("collection","path",e),t instanceof zh){const r=Mi.fromString(e,...n);return Bh(r),new Hh(t,null,r)}{if(!(t instanceof Gh||t instanceof Hh))throw new vi(yi.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Mi.fromString(e,...n));return Bh(r),new Hh(t.firestore,null,r)}}class Wh{constructor(){this.nu=Promise.resolve(),this.ru=[],this.iu=!1,this.su=[],this.ou=null,this._u=!1,this.au=!1,this.uu=[],this.jo=new ol(this,"async_queue_retry"),this.cu=()=>{const t=sl();t&&li("AsyncQueue","Visibility state changed to "+t.visibilityState),this.jo.Ko()};const t=sl();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.cu)}get isShuttingDown(){return this.iu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.lu(),this.hu(t)}enterRestrictedMode(t){if(!this.iu){this.iu=!0,this.au=t||!1;const e=sl();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.cu)}}enqueue(t){if(this.lu(),this.iu)return new Promise((()=>{}));const e=new wi;return this.hu((()=>this.iu&&this.au?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.ru.push(t),this.Pu())))}async Pu(){if(0!==this.ru.length){try{await this.ru[0](),this.ru.shift(),this.jo.reset()}catch(t){if(!Yi(t))throw t;li("AsyncQueue","Operation failed with retryable error: "+t)}this.ru.length>0&&this.jo.qo((()=>this.Pu()))}}hu(t){const e=this.nu.then((()=>(this._u=!0,t().catch((t=>{this.ou=t,this._u=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw hi("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this._u=!1,t))))));return this.nu=e,e}enqueueAfterDelay(t,e,n){this.lu(),this.uu.indexOf(t)>-1&&(e=0);const r=Bl.createAndSchedule(this,t,e,n,(t=>this.Iu(t)));return this.su.push(r),r}lu(){this.ou&&pi()}verifyOperationInProgress(){}async Tu(){let t;do{t=this.nu,await t}while(t!==this.nu)}Eu(t){for(const e of this.su)if(e.timerId===t)return!0;return!1}du(t){return this.Tu().then((()=>{this.su.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.su)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.Tu()}))}Au(t){this.uu.push(t)}Iu(t){const e=this.su.indexOf(t);this.su.splice(e,1)}}class Yh extends zh{constructor(t,e,n,r){super(t,e,n,r),this.type="firestore",this._queue=new Wh,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Jh(this),this._firestoreClient.terminate()}}function Xh(t){return t._firestoreClient||Jh(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Jh(t){var e,n,r;const s=t._freezeSettings(),i=function(t,e,n,r){return new To(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,Ph(r.experimentalLongPollingOptions),r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,s);t._firestoreClient=new kh(t._authCredentials,t._appCheckCredentials,t._queue,i),(null===(n=s.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=s.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:s.localCache.kind,_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider})}class Zh{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Zh(go.fromBase64String(t))}catch(t){throw new vi(yi.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Zh(go.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class td{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new vi(yi.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Fi(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}function ed(){return new td("__name__")}class nd{constructor(t){this._methodName=t}}class rd{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new vi(yi.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new vi(yi.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return ki(this._lat,t._lat)||ki(this._long,t._long)}}const sd=/^__.*__$/;class id{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new pc(t,this.data,this.fieldMask,e,this.fieldTransforms):new fc(t,this.data,e,this.fieldTransforms)}}class od{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new pc(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function ad(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw pi()}}class cd{constructor(t,e,n,r,s,i){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===s&&this.Ru(),this.fieldTransforms=s||[],this.fieldMask=i||[]}get path(){return this.settings.path}get Vu(){return this.settings.Vu}mu(t){return new cd(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}fu(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.mu({path:n,gu:!1});return r.pu(t),r}yu(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.mu({path:n,gu:!1});return r.Ru(),r}wu(t){return this.mu({path:void 0,gu:!0})}Su(t){return bd(t,this.settings.methodName,this.settings.bu||!1,this.path,this.settings.Du)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}Ru(){if(this.path)for(let t=0;t<this.path.length;t++)this.pu(this.path.get(t))}pu(t){if(0===t.length)throw this.Su("Document fields must not be empty");if(ad(this.Vu)&&sd.test(t))throw this.Su('Document fields cannot begin and end with "__"')}}class ud{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||il(t)}Cu(t,e,n,r=!1){return new cd({Vu:t,methodName:e,Du:n,path:Fi.emptyPath(),gu:!1,bu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ld(t){const e=t._freezeSettings(),n=il(t._databaseId);return new ud(t._databaseId,!!e.ignoreUndefinedProperties,n)}function hd(t,e,n,r,s,i={}){const o=t.Cu(i.merge||i.mergeFields?2:0,e,n,s);md("Data must be an object, but it was:",o,r);const a=pd(r,o);let c,u;if(i.merge)c=new fo(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const t=[];for(const r of i.mergeFields){const s=yd(e,r,n);if(!o.contains(s))throw new vi(yi.INVALID_ARGUMENT,`Field '${s}' is specified in your field mask but missing from your input data.`);Ed(t,s)||t.push(s)}c=new fo(t),u=o.fieldTransforms.filter((t=>c.covers(t.field)))}else c=null,u=o.fieldTransforms;return new id(new qo(a),c,u)}class dd extends nd{_toFieldTransform(t){if(2!==t.Vu)throw 1===t.Vu?t.Su(`${this._methodName}() can only appear at the top level of your update data`):t.Su(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof dd}}function fd(t,e){if(gd(t=g(t)))return md("Unsupported field value:",e,t),pd(t,e);if(t instanceof nd)return function(t,e){if(!ad(e.Vu))throw e.Su(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.Su(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.gu&&4!==e.Vu)throw e.Su("Nested arrays are not supported");return function(t,e){const n=[];let r=0;for(const s of t){let t=fd(s,e.wu(r));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=g(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Ka(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=Ri.fromDate(t);return{timestampValue:Gc(e.serializer,n)}}if(t instanceof Ri){const n=new Ri(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Gc(e.serializer,n)}}if(t instanceof rd)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Zh)return{bytesValue:Hc(e.serializer,t._byteString)};if(t instanceof Gh){const n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e.Su(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Yc(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Su(`Unsupported field value: ${qh(t)}`)}(t,e)}function pd(t,e){const n={};return oo(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):io(t,((t,r)=>{const s=fd(r,e.fu(t));null!=s&&(n[t]=s)})),{mapValue:{fields:n}}}function gd(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Ri||t instanceof rd||t instanceof Zh||t instanceof Gh||t instanceof nd)}function md(t,e,n){if(!gd(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const r=qh(n);throw"an object"===r?e.Su(t+" a custom object"):e.Su(t+" "+r)}}function yd(t,e,n){if((e=g(e))instanceof td)return e._internalPath;if("string"==typeof e)return wd(t,e);throw bd("Field path arguments must be of type string or ",t,!1,void 0,n)}const vd=new RegExp("[~\\*/\\[\\]]");function wd(t,e,n){if(e.search(vd)>=0)throw bd(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new td(...e.split("."))._internalPath}catch(r){throw bd(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function bd(t,e,n,r,s){const i=r&&!r.isEmpty(),o=void 0!==s;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${r}`),o&&(c+=` in document ${s}`),c+=")"),new vi(yi.INVALID_ARGUMENT,a+t+c)}function Ed(t,e){return t.some((t=>t.isEqual(e)))}class _d{constructor(t,e,n,r,s){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Gh(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new Td(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Sd("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class Td extends _d{data(){return super.data()}}function Sd(t,e){return"string"==typeof e?wd(t,e):e instanceof td?e._internalPath:e._delegate._internalPath}class Id{}class Cd extends Id{}function Ad(t,e,...n){let r=[];e instanceof Id&&r.push(e),r=r.concat(n),function(t){const e=t.filter((t=>t instanceof kd)).length,n=t.filter((t=>t instanceof Dd)).length;if(e>1||e>0&&n>0)throw new vi(yi.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const e of r)t=e._apply(t);return t}class Dd extends Cd{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new Dd(t,e,n)}_apply(t){const e=this._parse(t);return Ld(t._query,e),new Kh(t.firestore,t.converter,_a(t._query,e))}_parse(t){const e=ld(t.firestore),n=function(t,e,n,r,s,i,o){let a;if(s.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new vi(yi.INVALID_ARGUMENT,`Invalid Query. You can't perform '${i}' queries on documentId().`);if("in"===i||"not-in"===i){Rd(o,i);const e=[];for(const n of o)e.push(Nd(r,t,n));a={arrayValue:{values:e}}}else a=Nd(r,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||Rd(o,i),a=function(t,e,n,r=!1){return fd(n,t.Cu(r?4:3,e))}(n,"where",o,"in"===i||"not-in"===i);return Yo.create(s,i,a)}(t._query,0,e,t.firestore._databaseId,this._field,this._op,this._value);return n}}function xd(t,e,n){const r=e,s=Sd("where",t);return Dd._create(s,r,n)}class kd extends Id{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new kd(t,e)}_parse(t){const e=this._queryConstraints.map((e=>e._parse(t))).filter((t=>t.getFilters().length>0));return 1===e.length?e[0]:Xo.create(e,this._getOperator())}_apply(t){const e=this._parse(t);return 0===e.getFilters().length?t:(function(t,e){let n=t;const r=e.getFlattenedFilters();for(const t of r)Ld(n,t),n=_a(n,t)}(t._query,e),new Kh(t.firestore,t.converter,_a(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function Nd(t,e,n){if("string"==typeof(n=g(n))){if(""===n)throw new vi(yi.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!wa(e)&&-1!==n.indexOf("/"))throw new vi(yi.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(Mi.fromString(n));if(!Vi.isDocumentKey(r))throw new vi(yi.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Lo(t,new Vi(r))}if(n instanceof Gh)return Lo(t,n._key);throw new vi(yi.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${qh(n)}.`)}function Rd(t,e){if(!Array.isArray(t)||0===t.length)throw new vi(yi.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Ld(t,e){const n=function(t,e){for(const n of t)for(const t of n.getFlattenedFilters())if(e.indexOf(t.op)>=0)return t.op;return null}(t.filters,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==n)throw n===e.op?new vi(yi.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new vi(yi.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class Od{convertValue(t,e="none"){switch(Co(t)){case 0:return null;case 1:return t.booleanValue;case 2:return vo(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(wo(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw pi()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return io(t,((t,r)=>{n[t]=this.convertValue(r,e)})),n}convertGeoPoint(t){return new rd(vo(t.latitude),vo(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=Eo(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(_o(t));default:return null}}convertTimestamp(t){const e=yo(t);return new Ri(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=Mi.fromString(t);gi(mu(n));const r=new So(n.get(1),n.get(3)),s=new Vi(n.popFirst(5));return r.isEqual(e)||hi(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}}class Md{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Pd extends _d{constructor(t,e,n,r,s,i){super(t,e,n,r,i),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Fd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(Sd("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class Fd extends Pd{data(t={}){return super.data(t)}}class Vd{constructor(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Md(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new Fd(this._firestore,this._userDataWriter,n.key,n,new Md(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new vi(yi.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>{const r=new Fd(t._firestore,t._userDataWriter,n.doc.key,n.doc,new Md(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:e++}}))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const r=new Fd(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Md(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let s=-1,i=-1;return 0!==e.type&&(s=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),i=n.indexOf(e.doc.key)),{type:Ud(e.type),doc:r,oldIndex:s,newIndex:i}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function Ud(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return pi()}}class Bd extends Od{constructor(t){super(),this.firestore=t}convertBytes(t){return new Zh(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new Gh(this.firestore,null,e)}}function qd(t){t=jh(t,Kh);const e=jh(t.firestore,Yh),n=Xh(e),r=new Bd(e);return function(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new vi(yi.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(t._query),Mh(n,t._query).then((n=>new Vd(e,r,t,n)))}function jd(t,e,n,...r){t=jh(t,Gh);const s=jh(t.firestore,Yh),i=ld(s);let o;return o="string"==typeof(e=g(e))||e instanceof td?function(t,e,n,r,s,i){const o=t.Cu(1,e,n),a=[yd(e,r,n)],c=[s];if(i.length%2!=0)throw new vi(yi.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<i.length;t+=2)a.push(yd(e,i[t])),c.push(i[t+1]);const u=[],l=qo.empty();for(let t=a.length-1;t>=0;--t)if(!Ed(u,a[t])){const e=a[t];let n=c[t];n=g(n);const r=o.yu(e);if(n instanceof dd)u.push(e);else{const t=fd(n,r);null!=t&&(u.push(e),l.set(e,t))}}const h=new fo(u);return new od(l,h,o.fieldTransforms)}(i,"updateDoc",t._key,e,n,r):function(t,e,n,r){const s=t.Cu(1,e,n);md("Data must be an object, but it was:",s,r);const i=[],o=qo.empty();io(r,((t,r)=>{const a=wd(e,t,n);r=g(r);const c=s.yu(a);if(r instanceof dd)i.push(a);else{const t=fd(r,c);null!=t&&(i.push(a),o.set(a,t))}}));const a=new fo(i);return new od(o,a,s.fieldTransforms)}(i,"updateDoc",t._key,e),zd(s,[o.toMutation(t._key,ic.exists(!0))])}function $d(t,e){const n=jh(t.firestore,Yh),r=function(t,e,...n){if(t=g(t),1===arguments.length&&(e=xi.newId()),Vh("doc","path",e),t instanceof zh){const r=Mi.fromString(e,...n);return Uh(r),new Gh(t,null,new Vi(r))}{if(!(t instanceof Gh||t instanceof Hh))throw new vi(yi.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Mi.fromString(e,...n));return Uh(r),new Gh(t.firestore,t instanceof Hh?t.converter:null,new Vi(r))}}(t),s=function(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}(t.converter,e);return zd(n,[hd(ld(t.firestore),"addDoc",r._key,s,null!==t.converter,{}).toMutation(r._key,ic.exists(!1))]).then((()=>r))}function zd(t,e){return function(t,e){const n=new wi;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const r=Ch(t);try{const t=await function(t,e){const n=mi(t),r=Ri.now(),s=e.reduce(((t,e)=>t.add(e.key)),qa());let i,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>{let a=Ra(),c=qa();return n.os.getEntries(t,s).next((t=>{a=t,a.forEach(((t,e)=>{e.isValidDocument()||(c=c.add(t))}))})).next((()=>n.localDocuments.getOverlayedDocuments(t,a))).next((s=>{i=s;const o=[];for(const t of e){const e=hc(t,i.get(t.key).overlayedDocument);null!=e&&o.push(new pc(t.key,e,jo(e.value.mapValue),ic.exists(!0)))}return n.mutationQueue.addMutationBatch(t,r,o,e)})).next((e=>{o=e;const r=e.applyToLocalDocumentSet(i,c);return n.documentOverlayCache.saveOverlays(t,e.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:Ma(i)})))}(r.localStore,e);r.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let r=t.Fa[t.currentUser.toKey()];r||(r=new ao(ki)),r=r.insert(e,n),t.Fa[t.currentUser.toKey()]=r}(r,t.batchId,n),await _h(r,t.changes),await Dl(r.remoteStore)}catch(t){const e=ql(t,"Failed to persist write");n.reject(e)}}(await function(t){return Lh(t).then((t=>t.syncEngine))}(t),e,n))),n.promise}(Xh(t),e)}new WeakMap,function(t,e=!0){ai="10.10.0",St(new m("firestore",((t,{instanceIdentifier:n,options:r})=>{const s=t.getProvider("app").getImmediate(),i=new Yh(new Ti(t.getProvider("auth-internal")),new Ai(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new vi(yi.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new So(t.options.projectId,e)}(s,n),s);return r=Object.assign({useFetchStreams:e},r),i._setSettings(r),i}),"PUBLIC").setMultipleInstances(!0)),Dt(ii,"4.5.1",t),Dt(ii,"4.5.1","esm2017")}(),Dt("firebase","10.10.0","app");const Kd=function(t,e){const n="string"==typeof t?t:"(default)",r=function(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}("object"==typeof t?t:function(t=vt){const e=bt.get(t);if(!e&&t===vt&&o())return At();if(!e)throw It.create("no-app",{appName:t});return e}(),"firestore").getImmediate({identifier:n});if(!r._initialized){const t=(t=>{const e=(t=>{var e,n;return null===(n=null===(e=i())||void 0===e?void 0:e.emulatorHosts)||void 0===n?void 0:n[t]})(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),r]:[e.substring(0,n),r]})("firestore");t&&function(t,e,n,r={}){var i;const o=(t=jh(t,zh))._getSettings(),a=`${e}:${n}`;if("firestore.googleapis.com"!==o.host&&o.host!==a&&di("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},o),{host:a,ssl:!1})),r.mockUserToken){let e,n;if("string"==typeof r.mockUserToken)e=r.mockUserToken,n=oi.MOCK_USER;else{e=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",r=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},t);return[s(JSON.stringify({alg:"none",type:"JWT"})),s(JSON.stringify(o)),""].join(".")}(r.mockUserToken,null===(i=t._app)||void 0===i?void 0:i.options.projectId);const o=r.mockUserToken.sub||r.mockUserToken.user_id;if(!o)throw new vi(yi.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new oi(o)}t._authCredentials=new _i(new bi(e,n))}}(r,...t)}return r}(At({apiKey:"AIzaSyCzjy4yTM_nuqCyB9B3293ksSgSKB6xofg",authDomain:"masaka-mwana.firebaseapp.com",projectId:"masaka-mwana",storageBucket:"masaka-mwana.appspot.com",messagingSenderId:"824577596739",appId:"1:824577596739:web:9d14b85d6cff62ed7ba3f6"}));function Gd(t){return new Date(t).toUTCString()}const Hd=Qh(Kd,"players"),Qd=Qh(Kd,"sessions");var Wd=n(72),Yd=n.n(Wd),Xd=n(825),Jd=n.n(Xd),Zd=n(659),tf=n.n(Zd),ef=n(56),nf=n.n(ef),rf=n(540),sf=n.n(rf),of=n(113),af=n.n(of),cf=n(256),uf={};uf.styleTagTransform=af(),uf.setAttributes=nf(),uf.insert=tf().bind(null,"head"),uf.domAPI=Jd(),uf.insertStyleElement=sf(),Yd()(cf.A,uf),cf.A&&cf.A.locals&&cf.A.locals;const lf=new class{constructor(){this.currSessionId=null,this.startTime=null,this.durationPlayed=[],this.levelStartedAt=[],this.levelEndedAt=[]}async registerPlayer(t,e){try{const n={name:t,age:e,badges:[]};return await async function(t){try{const e=Ad(Hd,xd("name","==",t.name));if(!(await qd(e)).empty)throw new Error("Player with similar name exists. Please use a different name.");return t.createdAt=t.updatedAt=Gd(Date.now()),{id:(await $d(Hd,t)).id,...t}}catch(t){return console.error("Error adding document: ",t),null}}(n)}catch(t){throw t}}async setLoginInfo(){try{this.setStartTime();const t=this.processSessionForCreation(),e=await async function(t){try{return t.scores&&(t.scores=JSON.stringify(t.scores)),{id:(await $d(Qd,t)).id,...t}}catch(t){return console.error("Error creating session: ",t),null}}(t);!this.currSessionId&&(this.currSessionId=e.id)}catch(t){throw t}}async updateUserSession(){try{const t={badges:hf.badges};await async function(t,e){try{const n=Ad(Hd,xd(ed(),"==",t));let r=await qd(n);if(r.empty)throw new Error("Player not found");return e.updatedAt=Gd(Date.now()),await jd(r.docs[0].ref,e),r=await qd(n),{id:r.docs[0].id,...r.docs[0].data()}}catch(t){return console.error("Error updating document: ",t),null}}(hf.id,t);const e=this.processSessionForUpdate();await async function(t,e){try{const n=Ad(Qd,xd(ed(),"==",t));let r=await qd(n);if(r.empty)throw new Error("Session not found");return e.scores&&(e.scores=JSON.stringify(e.scores)),await jd(r.docs[0].ref,e),r=await qd(n),{id:r.docs[0].id,...r.docs[0].data()}}catch(t){return console.error("Error updating session: ",t),null}}(this.currSessionId,e),window.alert("Points for this level were saved!"),this.resetStartTime()}catch(t){throw t}}setStartTime(){!this.startTime&&(this.startTime=Date.now())}resetStartTime(){this.startTime&&(this.startTime=null)}processSessionForCreation(){return this.levelStartedAt.push(Gd(this.startTime)),{playerId:hf.id,scores:hf.scores,durationPlayed:[],levelEndedAt:[],levelStartedAt:[...this.levelStartedAt]}}processSessionForUpdate(){const t=Date.now();return this.durationPlayed.push(`${((t-this.startTime)/1e3/60).toFixed(2)} mins`),this.levelEndedAt.push(Gd(t)),{durationPlayed:this.durationPlayed,levelEndedAt:this.levelEndedAt,scores:hf.scores}}},hf={id:"",name:"",age:0,badges:[],scores:[[],[],[],[],[]]};document.querySelector(".intro-page form").addEventListener("submit",(async t=>{t.preventDefault(),hf.name=document.getElementById("name").value,hf.age=Number(document.getElementById("age").value);try{const t=await lf.registerPlayer(hf.name,hf.age);hf.id=t.id;try{await lf.setLoginInfo()}catch(t){console.error(t),window.alert("Error setting session.")}}catch(t){console.error(t),window.alert("Error creating player: that name is already taken. Try another one.")}document.querySelector(".intro-page form").setAttribute("disabled","disabled"),document.querySelector(".intro-page").setAttribute("hidden","hidden"),document.querySelector(".game").removeAttribute("hidden")}));const df=document.querySelector(".intro-page form button");df.addEventListener("mouseover",(t=>{df.classList.remove("mouseout"),df.classList.add("mousein")})),df.addEventListener("mouseout",(t=>{df.classList.remove("mousein"),df.classList.add("mouseout"),console.log("hehe")}));const ff=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];let pf={level1:{num:1,letter:[0,1,2,3,4,5],done:[]},level2:{num:2,letter:[6,7,8,9,10],done:[]},level3:{num:3,letter:[11,12,13,14,15],done:[]},level4:{num:4,letter:[16,17,18,19,20],done:[]},level5:{num:5,letter:[21,22,23,24,25],done:[]}},gf={level:0,levelRef:null,clicks:0,passed:0,score:0};const mf=document.querySelector(".game .top .level-div .value div:nth-child(2)"),yf=document.querySelector(".game .top .score-div .value div:nth-child(2)"),vf=document.querySelector(".bottom .letters"),wf=document.querySelector(".game .gif"),bf=document.querySelector(".game .level-progress"),Ef=document.querySelector(".game .score-progress"),_f=document.querySelector("dialog"),Tf=document.querySelector("main .badges.one .award-icons"),Sf=document.querySelector("main .badges.two .award-icons"),If=document.querySelector(".alert");function Cf(t){gf.level=t.num,gf.levelRef=t,gf.clicks=0,gf.passed=0,gf.score=0,gf.levelRef.done=[],Af(vf),Af(bf),Af(Ef),mf.textContent=String(t.num),vf.style.cssText=`grid-template-columns: repeat(${t.letter.length}, 1fr)`,bf.style.cssText=`grid-template-columns: repeat(${t.letter.length}, 1fr);`,Ef.style.cssText=`grid-template-columns: repeat(${t.letter.length}, 1fr);`,xf();for(let e=0;e<t.letter.length;e++){let n=document.createElement("div");n.setAttribute("data-val",`${ff[t.letter[e]]}`),n.textContent=String(ff[t.letter[e]]),vf.appendChild(n),bf.appendChild(document.createElement("div")),Ef.appendChild(document.createElement("div"))}Df(),function(t){let e=Array.from(t.childNodes);for(let t=0;t<e.length;t++)e[t].addEventListener("click",(()=>{gf.clicks++,e[t].textContent==wf.getAttribute("data-val")?gf.passed++:kf(e[t]),xf(),Nf(),wf.querySelector("img").setAttribute("src",""),gf.clicks===gf.levelRef.letter.length?Rf():Df()}))}(vf)}function Af(t){let e=Array.from(t.childNodes);for(let t=0;t<e.length;t++)e[t].remove()}function Df(){let t=gf.levelRef.letter.length-1,e=gf.levelRef.letter[t]-Math.round(Math.random()*t);for(;gf.levelRef.done.includes(e);)e=gf.levelRef.letter[t]-Math.round(Math.random()*t);gf.levelRef.done.push(e),wf.querySelector("img").setAttribute("src",`../assets/gifs/${ff[e]}.webp`),wf.setAttribute("data-val",`${ff[e]}`)}function xf(){gf.score=Math.round(100*gf.passed/gf.levelRef.letter.length),yf.innerHTML=`${gf.score} <span class="small">%</span>`}function kf(t){t.classList.add("fail-animation"),setTimeout((()=>{t.classList.remove("fail-animation")}),1e3);let e=wf.getAttribute("data-val"),n=document.querySelector(`.bottom .letters div[data-val='${e}']`);n.classList.add("correct-animation"),setTimeout((()=>{n.classList.remove("correct-animation")}),1e3),If.querySelector(".text").textContent="Testing mic one two",If.classList.add("action"),setTimeout((()=>{If.classList.remove("action")}),3e3)}function Nf(){if(bf.querySelector(`div:nth-child(${gf.clicks})`).style.cssText="background-color: orange",bf.querySelector(`div:nth-child(${gf.clicks})`).classList.add("move"),gf.passed){if(Ef.querySelector(`div:nth-child(${gf.passed})`).style.cssText="background-color: red",gf.score>=40&&gf.score<75){Ef.style.cssText+="border: 1px solid orange";for(let t=0;t<gf.passed;t++)Ef.childNodes[t].style.cssText+="background-color: orange"}else if(gf.score>=75){Ef.style.cssText+="border: 1px solid green;";for(let t=0;t<gf.passed;t++)Ef.childNodes[t].style.cssText+="background-color: green"}Ef.querySelector(`div:nth-child(${gf.passed})`).classList.add("move")}}function Rf(){hf.scores[gf.level-1].push(gf.score),gf.score>=75?_f.querySelector("h1").textContent="Yeyy! You Win!":_f.querySelector("h1").textContent="Noo! You Lose!",_f.querySelector(".score > h2").textContent=`You got ${gf.score}%`,console.log(" prexvcvdfgdsfgdfgdfgdf "),console.log(gf);let t=_f.querySelector(".award");if(console.log(t),hf.badges.includes(gf.level))t.style.cssText="display: none";else if(console.log("her1"),gf.score>=75){console.log("her333"),t.style.cssText="display: flex",_f.querySelector(".award > img").setAttribute("src",`../assets/badge${gf.level}.png`),hf.badges.push(gf.level);let e=document.createElement("div");e.style.cssText=`background-image: url(../assets/badge${gf.level}.png)`,gf.level>3?Sf.appendChild(e):Tf.appendChild(e)}else t.style.cssText="display: none";console.log(gf),gf.score>=75&&gf.level<5?_f.querySelector(".btns > .next").removeAttribute("disabled"):_f.querySelector(".btns > .next").setAttribute("disabled","true"),_f.addEventListener("close",Lf),_f.querySelector(".again").onclick=function(){_f.removeEventListener("close",Lf),Of(gf.level),_f.close()},_f.querySelector(".next").onclick=function(){_f.removeEventListener("close",Lf),Of(gf.level+1),_f.close()},_f.showModal(),(async()=>{try{await lf.updateUserSession(),console.log("updated player and session info"),lf.setStartTime()}catch(t){console.error(t),window.alert("Error logging out: "+t.message)}})()}function Lf(){5==gf.level?Of(gf.level):gf.score>=75?Of(gf.level+1):Of(gf.level)}function Of(t){switch(t){case 1:Cf(pf.level1);break;case 2:Cf(pf.level2);break;case 3:Cf(pf.level3);break;case 4:Cf(pf.level4);break;case 5:Cf(pf.level5)}}Cf(pf.level1),window.addEventListener("beforeunload",(t=>{t.preventDefault(),t.returnValue="Are you tired of playing?"}))})()})();